{"version":3,"sources":["refinery-prov-vis.min.js"],"names":["refineryProvVis","$","d3","SolrResponse","dagre","DoiComponents","node","this","doiTime","doiLayerDiff","change","wfParams","map","files","topology","relationship","graphMetrics","width","height","doiFiltered","doiSelected","doiHighlighted","neighborhoodDoiFactor","doiMinMax","doiWeightedSum","BaseNode","id","nodeType","parent","hidden","preds","succs","predLinks","succLinks","children","x","y","l","ts","removed","depth","bcOrder","numInstances","autoId","doi","selected","filtered","Node","name","fileType","study","assay","parents","analysis","subanalysis","uuid","fileUrl","call","label","attributes","Analysis","wfUuid","start","end","created","inputs","outputs","links","wfName","wfCode","layer","motif","exaggerated","motifDiff","numIns","numOuts","numSubanalyses","Subanalysis","Motif","file","Layer","Link","source","target","highlighted","ProvVis","parentDiv","zoom","data","url","canvas","rect","margin","radius","color","graph","cell","layerMethod","_parentDiv","_data","_url","ProvGraph","dataset","nodes","aLinks","iNodes","oNodes","aNodes","saNodes","analysisWorkflowMap","nodeMap","analysisData","workflowData","nodeData","bclgNodes","lNodes","lLinks","assignNodeType","n","type","file_url","createNode","replace","analysis_uuid","nodeName","Object","create","extractNodes","datasetJsonObj","values","value","forEach","i","newNode","push","set","createLink","lId","extractLinks","puuid","get","console","log","createNodeLinkMapping","empty","markSubanalyses","traverseDataset","_currentSubAnalysis_","currentSubAnalysis","size","pn","traverseBackSubanalysis","sn","createAnalysisNode","a","initTime","time_start","time_end","creation_date","length","concat","substr","workflow__uuid","extractWorkflows","analysesData","prepareJSON","wfCpy","text","workflow_copy","wfData","JSON","parse","wfObj","extractAnalyses","initDate","time","format","iso","Date","min","d","setSeconds","getSeconds","createSubanalysisNode","sanId","an","createAnalysisNodeMapping","filter","has","san","cn","some","p","inn","s","onn","sain","saon","ll","entries","sani","key","sano","indexOf","psan","ssan","sanl","ain","aon","extractFacetNodeAttributesPrivate","solrResponse","getDocumentList","selNode","rawFacetAttributes","fa","attrNameEndIndex","attrName","toLowerCase","createFacetNodeAttributeList","sampleNode","rawAttrSet","nodeAttributeList","na","style","html","appendTo","find","prop","setAnalysisParent","runInitPrivate","obj","run$1","topSortNodes","startNodes","nodesLength","handleSuccessorNodes","_curNode_","curNode","_succNode_","succNode","predLink","predLinkNode","sortedNodes","layerNodes","tsNodes","col","minLayer","groupNodes","lgNodes","k","reorderSubanalysisNodes","degree","accCoords","usedCoords","delta","colList","j","sort","b","looseSAn","ni","pni","shift","dagreWorkflowLayout","g","graphlib","Graph","setGraph","rankdir","nodesep","edgesep","ranksep","marginx","marginy","setDefaultEdgeLabel","setNode","setEdge","minlen","weight","labelpos","labeloffset","layout","_nodes","parseInt","dagreGraphLayout","dlANodes","toString","runLayoutPrivate","startANodes","tsANodes","Error","al","run$2","hideChildNodes","selectAll","classed","selectedNode","hiddenNode","propagateNodeSelection","selectedChanged","customTimeFormat","date","parseISOTimeFormat","compareMaps","equal","keys","getLayerPredCount","ln","reduce","acc","pls","getLayerSuccCount","createLayerNodes","layers","layerId","motifs","foundMotif","thisMotif","anPreds","anSuccs","pl","sl","m","keyStr","pan","createLayerAnalysisMapping","anl","linkId","layerLink","computeAnalysisMotifDiff","cleanLayerAnalysisMapping","runMotifsPrivate","run$3","showTooltip","tooltip","event","pageY","pageX","hideTooltip","getVisibleNodeCoords","_curN_","curN","getABBoxCoords","_offset_","offset","minX","maxX","max","minY","maxY","concatDomClassElements","domArr","domClassStr","initDoiFilterComponent","filteredChanged","initDoiTimeComponent","vis","doiTimeScale","scale","domain","range","initTimeComponent","mean","getWFBBoxCoords","dagreLayerLayout","updateNodeAndLink","curWidth","curHeight","dlLNodes","select","applyDragBehavior","domDragSet","dragStart","dragging","dragEnd","drag","behavior","origin","on","drawStraightLink","srcX","srcY","tarX","tarY","pathSegment","sourceEvent","stopPropagation","updateLinkFilter","saLink","saNode","each","filteredLink","blendedLink","filterAction","updateNode","dom","transition","duration","draggingActive","nodeLinkTransitionTime","attr","updateNodeFilter","_this","self","sann","updateLink","srcCoords","tarCoords","linkStyle","drawBezierLink","setTimeout","handleCollapseExpandNode","keyStroke","_trigger_","trigger","anBBoxCoords","wfBBoxCoords","siblings","vis$1","every","scaleFactor","dagreDynamicLayerLayout","fitToWindow","fitGraphToWindow","updateNodeDoi","allParentsHidden","cur","domNodeset","maxDoi","hLineSrc","layoutCols","c","deltaY","filterAnalysesByTime","lowerTimeThreshold","upperTimeThreshold","_vis_","lNodesBAK","aNodesBAK","saNodesBAK","nodesBAK","aLinksBAK","lLinksBAK","selAnalyses","cpyLNodes","cpyLLinks","updateAnalysisLinks","updateLayerLinks","doiAutoUpdate","recomputeDOI","drawTimelineView","dragLineStart","getTimeLineThresholds","className","updateTimelineLabels","_this2","tlThreshold","labelStart","labelEnd","draggingLine","tlWidth","timeLineGradientScale","invert","lastX","dragLineEnd","filterMethod","applyTimeLineDragBehavior","dragLine","redrawTimeline","svg","tlHeight","translate","_this3","append","linear","timeColorScale","nice","xAxis","axis","orient","ticks","yAxis","tlTickCoords","timelineZoom","scaleExtent","gradient","fill","stroke","stroke-width","startTime","endTime","timeLineThreshold","enter","computeWeightedSum","drawDoiView","updateDoiView","rectOffset","labelOffset","labelsStart","dComp","innerSvg","gDCompUpdate","doiColorScale","stroke-opacity","gDCompEnter","exit","remove","css","toggleDoiComps","numMaskedComps","DoiFactors","factors","dc","isMasked","accVal","_accVal_","tar","checked","val","_this4","doiFactors","category10","class","href","dcId","click","parentNode","parseFloat","keypress","e","_this5","which","clearHighlighting","hLink","link","highlightedChanged","highlightPredPath","highlightSuccPath","ahl","aLink","createAnalysistimeColorScale","updateLayerNodes","_this6","lEnter","latestDate","earliestDate","lBBox","lln","BBox","hiddenBBox","lDiff","layerNode","lNode","filteredNode","blendedNode","lGlyph","glyph","lLabels","labels","lLink","updateAnalysisNodes","_this7","lAnalysis","anUpdate","analysisBBox","aBBox","analysisNode","aNode","aGlyph","aLabels","anEnter","aDiff","drawSubanalysisLinks","sahl","hiddenLink","sal","drawSubanalysisNodes","_this8","saEnter","saBBoxCoords","subanalysisBBox","saBBox","subanalysisNode","saGlyph","saLabels","drawNodes","_this9","dd","nGlyph","nLabels","ddd","nodeAttrLabel","firstPart","secondPart","exNum","accY","numChildren","accHeight","accWidth","src","ann","handlePathHighlighting","_this10","transitionTime","_this11","anBBox","sidebarOverlap","factor","newScale","newPos","left","top","maxLabelPixelWidth","transform","attrText","selAttrName","trimRatio","getComputedTextLength","clearNodeSelection","_this12","colorStrokes","selectedNodeSet","hover","colorHighlight","handleNodeSelection","_this13","drawColorcodingView","updateStrokesColor","updateHighlightColor","_this14","switchColorScheme","checkedColor","_ret9","wfc","wfColorData","_ret10","nt","t","wfColorScale","wfIndex","wf","code","spectrum","showAlpha","toHexString","updateNodeInfoTab","title","titleLink","nodeDiff","diffNegIns","diffPosIns","diffNegSA","diffPosSA","diffNegOuts","diffPosOuts","aggregation_count","workflow","subanalysis_count","getWfNameByNode","handleTooltips","createHTMLKeyValuePair","_this15","ttStr","sibling","showAllWorkflows","_this16","yOffset","showAllSubanalyses","showAllAnalyses","showAllLayers","_this17","handleToolbar","_this18","runRenderUpdatePrivate","lastSolrResponse","idx","li","item","selAttrNamee","animate","handleEvents","domNodesetClickTimeout","defaultPrevented","clearTimeout","bRectClickTimeout","aBBoxClickTimeout","initDoiLayerDiffComponent","doiDiffMin","doiDiffMax","Math","abs","doiDiffScale","initLayerDiffComponent","anMax","runRenderPrivate","provVis","selNodes","filterPredPath","run$4","update$1","createTimelineView","divId","timelineContainer","margin-top","margin-bottom","padding","createDOIView","doiContainer","margin-left","createChangeLayersView","layerContainer","data-toggle","showProvvisLoaderIcon","hideProvvisLoaderIcon","runProvVisPrivate","studyUuid","studyAnalyses","status","json","error","right","bottom","r","category20","redraw","err","document","getElementById","innerHTML","message","runProvVisUpdatePrivate","getProvVisPrivate","run","update","version","masked","diff","prototype","computeMinMax","toFixed","constructor","index"],"mappings":"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","file":"refinery-prov-vis.min.js","sourcesContent":["/* Copyright Stefan Luger: Refinery's Provenance Visualization */\nvar refineryProvVis = (function ($,d3,SolrResponse,dagre) {\n\t'use strict';\n\n\tvar version = \"1.0.0\";\n\n\t/**\n\t * Module for constructor function declaration.\n\t */\n\tvar DoiFactors = function () {\n\t  var factors = {\n\t    filtered: {\n\t      label: 'filtered',\n\t      value: 0.2,\n\t      masked: true\n\t    },\n\t    selected: {\n\t      label: 'selected',\n\t      value: 0.2,\n\t      masked: true\n\t    },\n\t    highlighted: {\n\t      label: 'highlighted',\n\t      value: 0.2,\n\t      masked: true\n\t    },\n\t    time: {\n\t      label: 'time',\n\t      value: 0.2,\n\t      masked: true\n\t    },\n\t    diff: {\n\t      label: 'diff',\n\t      value: 0.2,\n\t      masked: true\n\t    }\n\t  };\n\n\t  return {\n\t    set: function set(prop, value, masked) {\n\t      factors[prop] = {\n\t        label: prop.toString(),\n\t        value: value,\n\t        masked: masked\n\t      };\n\t    },\n\t    get: function get(prop) {\n\t      return factors[prop].value;\n\t    },\n\t    isMasked: function isMasked(prop) {\n\t      return factors[prop].masked;\n\t    },\n\n\t    factors: factors\n\t  };\n\t}();\n\n\t/**\n\t * Constructor function representing the degree-of-interest (DOI)\n\t * components for BaseNode.\n\t * @param node The encapsulating node.\n\t * @constructor\n\t */\n\tfunction DoiComponents(node) {\n\t  this.node = node;\n\n\t  /* API: General interest. */\n\t  /* ********************** */\n\n\t  /* The latest execution time of a node is more important\n\t   * than earlier executions.\n\t   */\n\t  this.doiTime = 0;\n\n\t  /* For weak layering, analyses are layered without considering the number\n\t   * of subanlayses, inputs or outputs. Therefore a diff in those three\n\t   * categories may occur. The number of nodes carrying a diff in relation\n\t   * to the number of layered nodes.\n\t   */\n\n\t  this.doiLayerDiff = 0;\n\n\t  /* For layered nodes: Workflow parameters, files or topology changes over\n\t   * time.\n\t   */\n\t  this.change = {\n\t    wfParams: d3.map(),\n\t    files: d3.map(),\n\t    topology: d3.map()\n\t  };\n\n\t  /* Corresponds to the node type: Node, subanalysis, analysis.*/\n\t  this.relationship = 0;\n\n\t  /* The overall graph width and height influences node appearances.*/\n\t  this.graphMetrics = {\n\t    width: -1,\n\t    height: -1\n\t  };\n\n\t  /* UI: Interest derived from user actions. */\n\t  /* *************************************** */\n\n\t  /* A node is in the result set of filter actions. */\n\t  this.doiFiltered = 0;\n\n\t  /* A node is selected by user actions. */\n\t  this.doiSelected = 0;\n\n\t  /* A node is part of a node-link path highlighted. */\n\t  this.doiHighlighted = 0;\n\n\t  /* Distance. */\n\t  /* ********* */\n\n\t  /* A node's neighborhood directly influences it's DOI value through\n\t   * link weight and fallout function.\n\t   */\n\t  this.neighborhoodDoiFactor = 1;\n\n\t  /* Computation. */\n\t  /* ************ */\n\n\t  /* A node's dominant component is represented by the minimum or maximum\n\t   * value throughout all components.\n\t   */\n\t  this.doiMinMax = -1;\n\n\t  /* A node's average DOI value is calculated by the sum of all weighted\n\t   * single DOI component values.\n\t   */\n\t  this.doiWeightedSum = -1;\n\t}\n\n\t/**\n\t * Look up filtered attribute for encapsulating node.\n\t * A node is within the filter results.\n\t */\n\tDoiComponents.prototype.filteredChanged = function () {\n\t  this.doiFiltered = this.node.filtered ? 1 : 0.5;\n\t  this.computeWeightedSum();\n\t};\n\n\t/**\n\t * A node can be selected for further actions or detailed information.\n\t */\n\tDoiComponents.prototype.selectedChanged = function () {\n\t  this.doiSelected = this.node.selected ? 1 : 0;\n\t  this.computeWeightedSum();\n\t};\n\n\t/**\n\t * A path containing nodes may be highlighted.\n\t */\n\tDoiComponents.prototype.highlightedChanged = function () {\n\t  this.doiHighlighted = this.node.highlighted ? 1 : 0;\n\t  this.computeWeightedSum();\n\t};\n\n\t/**\n\t * Based on the time frame, calculate component weight.\n\t * @param factor The analysis start time scaled between 0 and 1.\n\t */\n\tDoiComponents.prototype.initTimeComponent = function (factor) {\n\t  this.doiTime = factor;\n\t  this.computeWeightedSum();\n\t};\n\n\t/**\n\t * Based on amount of nodes with a diff within a layer, calculate component\n\t * weight.\n\t * @param factor The accumulated diffs scaled between 0 and 1.\n\t */\n\tDoiComponents.prototype.initLayerDiffComponent = function (factor) {\n\t  this.doiLayerDiff = factor;\n\t  this.computeWeightedSum();\n\t};\n\n\t/**\n\t * Calculates the dominant doi component.\n\t */\n\tDoiComponents.prototype.computeMinMax = function () {\n\t  /* TODO: Based on heuristics, find dominant component.*/\n\t  this.doiMinMax = -1;\n\t};\n\n\t/**\n\t * Calculates a weighted doi value among all doi components considering\n\t * component weights.\n\t */\n\tDoiComponents.prototype.computeWeightedSum = function () {\n\t  this.doiWeightedSum = (this.doiFiltered * DoiFactors.factors.filtered.value + this.doiSelected * DoiFactors.factors.selected.value + this.doiHighlighted * DoiFactors.factors.highlighted.value + this.doiTime * DoiFactors.factors.time.value + this.doiLayerDiff * DoiFactors.factors.diff.value).toFixed(2);\n\t};\n\n\t/**\n\t * Constructor function of the super node inherited by Node, Analysis and\n\t * Subanalysis.\n\t *\n\t * @param id\n\t * @param nodeType\n\t * @param parent\n\t * @param hidden\n\t * @constructor\n\t */\n\tfunction BaseNode(id, nodeType, parent, hidden) {\n\t  this.id = id;\n\t  this.nodeType = nodeType;\n\t  this.parent = parent;\n\t  this.hidden = hidden;\n\n\t  this.preds = d3.map();\n\t  this.succs = d3.map();\n\t  this.predLinks = d3.map();\n\t  this.succLinks = d3.map();\n\t  this.children = d3.map();\n\t  this.x = 0;\n\t  this.y = 0;\n\n\t  /* Layout specific. */\n\t  this.l = {\n\n\t    /* Top sort markings [Kahn 1962]. */\n\t    ts: {\n\t      removed: false\n\t    },\n\n\t    /* Graph attributes. */\n\t    width: 0,\n\t    depth: 0,\n\n\t    bcOrder: -1\n\t  };\n\n\t  BaseNode.numInstances = (BaseNode.numInstances || 0) + 1;\n\t  this.autoId = BaseNode.numInstances;\n\n\t  this.doi = new DoiComponents(this);\n\t  this.selected = false;\n\t  this.filtered = true;\n\t}\n\n\t/**\n\t * Constructor function for the node data structure.\n\t *\n\t * @param id\n\t * @param nodeType\n\t * @param parent\n\t * @param hidden\n\t * @param name\n\t * @param fileType\n\t * @param study\n\t * @param assay\n\t * @param parents\n\t * @param analysis\n\t * @param subanalysis\n\t * @param uuid\n\t * @param fileUrl\n\t * @constructor\n\t */\n\tfunction Node(id, nodeType, parent, hidden, name, fileType, study, assay, parents, analysis, subanalysis, uuid, fileUrl) {\n\t  BaseNode.call(this, id, nodeType, parent, hidden);\n\n\t  this.name = name;\n\t  this.label = '';\n\t  this.fileType = fileType;\n\t  this.study = study;\n\t  this.assay = assay;\n\t  this.parents = parents;\n\t  this.analysis = analysis;\n\t  this.subanalysis = subanalysis;\n\t  this.uuid = uuid;\n\t  this.fileUrl = fileUrl;\n\n\t  this.attributes = d3.map();\n\t}\n\n\tNode.prototype = Object.create(BaseNode.prototype);\n\tNode.prototype.constructor = Node;\n\n\t/**\n\t * Constructor function for the analysis node data structure.\n\t *\n\t * @param id\n\t * @param parent\n\t * @param hidden\n\t * @param uuid\n\t * @param wfUuid\n\t * @param analysis\n\t * @param start\n\t * @param end\n\t * @param created\n\t * @constructor\n\t */\n\tfunction Analysis(id, parent, hidden, uuid, wfUuid, analysis, start, end, created) {\n\t  BaseNode.call(this, id, 'analysis', parent, hidden);\n\n\t  this.uuid = uuid;\n\t  this.wfUuid = wfUuid;\n\t  this.analysis = analysis;\n\t  this.start = start;\n\t  this.end = end;\n\t  this.created = created;\n\n\t  this.inputs = d3.map();\n\t  this.outputs = d3.map();\n\t  this.links = d3.map();\n\n\t  this.wfName = '';\n\t  this.wfCode = '';\n\n\t  this.layer = '';\n\t  this.motif = '';\n\n\t  this.exaggerated = false;\n\n\t  this.motifDiff = {\n\t    numIns: 0,\n\t    numOuts: 0,\n\t    wfUuid: this.wfUuid,\n\t    numSubanalyses: 0\n\t  };\n\t}\n\n\tAnalysis.prototype = Object.create(BaseNode.prototype);\n\tAnalysis.prototype.constructor = Analysis;\n\n\t/**\n\t * Constructor function for the subanalysis node data structure.\n\t *\n\t * @param id\n\t * @param parent\n\t * @param hidden\n\t * @param subanalysis\n\t * @constructor\n\t */\n\tfunction Subanalysis(id, parent, hidden, subanalysis) {\n\t  BaseNode.call(this, id, 'subanalysis', parent, hidden);\n\n\t  this.subanalysis = subanalysis;\n\n\t  this.wfUuid = '';\n\t  this.inputs = d3.map();\n\t  this.outputs = d3.map();\n\t  this.links = d3.map();\n\t}\n\n\tSubanalysis.prototype = Object.create(BaseNode.prototype);\n\tSubanalysis.prototype.constructor = Subanalysis;\n\n\t/**\n\t * Constructor function for the motif data structure.\n\t *\n\t * @constructor\n\t */\n\tfunction Motif() {\n\t  this.preds = d3.map();\n\t  this.succs = d3.map();\n\t  this.numIns = 0;\n\t  this.numOuts = 0;\n\t  this.wfUuid = '';\n\t  this.numSubanalyses = 0;\n\t  this.file = '';\n\n\t  Motif.numInstances = (Motif.numInstances || 0) + 1;\n\t  this.autoId = Motif.numInstances;\n\t}\n\n\t/**\n\t * Constructor function for the provenance layered node data structure.\n\t *\n\t * @param id\n\t * @param parent\n\t * @param hidden\n\t * @constructor\n\t */\n\tfunction Layer(id, motif, parent, hidden) {\n\t  BaseNode.call(this, id, 'layer', parent, hidden);\n\n\t  this.inputs = d3.map();\n\t  this.outputs = d3.map();\n\t  this.links = d3.map();\n\n\t  this.motif = motif;\n\t  this.wfName = '';\n\t}\n\n\tLayer.prototype = Object.create(BaseNode.prototype);\n\tLayer.prototype.constructor = Layer;\n\n\t/**\n\t * Constructor function for the link data structure.\n\t *\n\t * @param id\n\t * @param source\n\t * @param target\n\t * @param hidden\n\t * @constructor\n\t */\n\tfunction Link(id, source, target, hidden) {\n\t  this.id = id;\n\t  this.source = source;\n\t  this.target = target;\n\t  this.hidden = hidden;\n\t  this.highlighted = false;\n\t  this.filtered = true;\n\n\t  /* Layout computation specific flags. */\n\t  this.l = {\n\n\t    /* Top sort markings [Kahn 1962]. */\n\t    ts: {\n\t      removed: false\n\t    }\n\t  };\n\n\t  Link.numInstances = (Link.numInstances || 0) + 1;\n\t  this.autoId = Link.numInstances;\n\t}\n\n\t/**\n\t * Constructor function for the provenance visualization.\n\t *\n\t * @param parentDiv\n\t * @param zoom\n\t * @param data\n\t * @param url\n\t * @param canvas\n\t * @param rect\n\t * @param margin\n\t * @param width\n\t * @param height\n\t * @param radius\n\t * @param color\n\t * @param graph\n\t * @param cell\n\t * @param layerMethod\n\t * @constructor\n\t */\n\tfunction ProvVis(parentDiv, zoom, data, url, canvas, rect, margin, width, height, radius, color, graph, cell, layerMethod) {\n\t  this._parentDiv = parentDiv;\n\t  this.zoom = zoom;\n\t  this._data = data;\n\t  this._url = url;\n\n\t  this.canvas = canvas;\n\t  this.rect = rect;\n\t  this.margin = margin;\n\t  this.width = width;\n\t  this.height = height;\n\t  this.radius = radius;\n\t  this.color = color;\n\t  this.graph = graph;\n\t  this.cell = cell;\n\t  this.layerMethod = layerMethod;\n\t}\n\n\t/**\n\t * Constructor function for the provenance graph.\n\t *\n\t * @param dataset\n\t * @param nodes\n\t * @param links\n\t * @param aLinks\n\t * @param iNodes\n\t * @param oNodes\n\t * @param aNodes\n\t * @param saNodes\n\t * @param analysisWorkflowMap\n\t * @param nodeMap\n\t * @param analysisData\n\t * @param workflowData\n\t * @param nodeData\n\t * @constructor\n\t */\n\tfunction ProvGraph(dataset, nodes, links, aLinks, iNodes, oNodes, aNodes, saNodes, analysisWorkflowMap, nodeMap, analysisData, workflowData, nodeData) {\n\t  this.dataset = dataset;\n\t  this.nodes = nodes;\n\t  this.links = links;\n\t  this.aLinks = aLinks;\n\t  this.iNodes = iNodes;\n\t  this.oNodes = oNodes;\n\t  this.aNodes = aNodes;\n\t  this.saNodes = saNodes;\n\t  this.bclgNodes = [];\n\n\t  this.analysisWorkflowMap = analysisWorkflowMap;\n\t  this.nodeMap = nodeMap;\n\t  this.analysisData = analysisData;\n\t  this.workflowData = workflowData;\n\t  this.nodeData = nodeData;\n\n\t  /* Layout specific. */\n\t  this.l = {\n\t    width: 0,\n\t    depth: 0\n\t  };\n\n\t  this.lNodes = d3.map();\n\t  this.lLinks = d3.map();\n\t}\n\n\t/**\n\t * Module for init.\n\t */\n\n\t/* Initialize node-link arrays. */\n\tvar nodes = [];\n\tvar links = [];\n\tvar aLinks = [];\n\tvar iNodes = [];\n\tvar oNodes = [];\n\tvar aNodes = [];\n\tvar saNodes = [];\n\tvar nodeAttributeList = [];\n\tvar nodeMap = d3.map();\n\tvar analysisWorkflowMap = d3.map();\n\tvar workflowData = d3.map();\n\tvar analysisData = d3.map();\n\tvar nodeData = d3.map();\n\n\tvar dataset = Object.create(null);\n\n\t/**\n\t * Assign node types.\n\t * @param n Current raw node.\n\t * @returns {string} The CSS class corresponding to the type of the node.\n\t */\n\tfunction assignNodeType(n) {\n\t  var nodeType = '';\n\n\t  switch (n.type) {\n\t    case 'Source Name':\n\t    case 'Sample Name':\n\t    case 'Assay Name':\n\t      nodeType = 'special';\n\t      break;\n\t    case 'Data Transformation Name':\n\t      nodeType = 'dt';\n\t      break;\n\t    default:\n\t      if (n.file_url === null) {\n\t        nodeType = 'intermediate';\n\t      } else {\n\t        nodeType = 'stored';\n\t      }\n\t      break;\n\t  }\n\t  return nodeType;\n\t}\n\n\t/**\n\t * Extract node api properties.\n\t * @param n Node object.\n\t * @param type Dataset specified node type.\n\t * @param id Integer identifier for the node.\n\t * @returns {models.Node} New Node object.\n\t */\n\tfunction createNode(n, type, id) {\n\t  var study = n.study !== null ? n.study.replace(/\\/api\\/v1\\/study\\//g, '').replace(/\\//g, '') : '';\n\t  var assay = n.assay !== null ? n.assay.replace(/\\/api\\/v1\\/assay\\//g, '').replace(/\\//g, '') : '';\n\t  var parents = n.parents.map(function (y) {\n\t    return y.replace(/\\/api\\/v1\\/node\\//g, '').replace(/\\//g, '');\n\t  });\n\t  var analysis = n.analysis_uuid !== null ? n.analysis_uuid : 'dataset';\n\n\t  /* Fix for datasets which nodes might not contain a name attribute. */\n\t  var nodeName = 'undefined';\n\t  if (typeof n.name !== 'undefined') {\n\t    nodeName = n.name;\n\t  }\n\n\t  return new Node(id, type, Object.create(null), true, nodeName, n.type, study, assay, parents, analysis, n.subanalysis, n.uuid, n.file_url);\n\t}\n\n\t/**\n\t * Extract nodes.\n\t * @param datasetJsonObj Analysis dataset of type JSON.\n\t */\n\tfunction extractNodes(datasetJsonObj) {\n\t  d3.values(datasetJsonObj.value).forEach(function (n, i) {\n\t    /* Assign class string for node types. */\n\t    var nodeType = assignNodeType(n);\n\n\t    /* Extract node properties from api and create Node. */\n\t    var newNode = createNode(n, nodeType, i);\n\t    nodes.push(newNode);\n\n\t    /* Build node hash. */\n\t    nodeMap.set(n.uuid, newNode);\n\n\t    nodeData.set(n.uuid, n);\n\t  });\n\t}\n\n\t/**\n\t * Extract link properties.\n\t * @param lId Integer identifier for the link.\n\t * @param source Source node object.\n\t * @param target Target node object.\n\t * @returns {models.Link} New Link object.\n\t */\n\tfunction createLink(lId, source, target) {\n\t  return new Link(lId, source, target, true);\n\t}\n\n\t/**\n\t * Extract links.\n\t */\n\tfunction extractLinks() {\n\t  var lId = 0;\n\n\t  nodes.forEach(function (n) {\n\t    if (typeof n.uuid !== 'undefined') {\n\t      if (typeof n.parents !== 'undefined') {\n\t        /* For each parent entry. */\n\t        n.parents.forEach(function (puuid) {\n\t          /* n -> target; p -> source */\n\t          if (typeof nodeMap.get(puuid) !== 'undefined') {\n\t            /* ExtractLinkProperties. */\n\t            links.push(createLink(lId, nodeMap.get(puuid), n));\n\t            lId++;\n\t          } else {\n\t            console.log('ERROR: Dataset might be corrupt - parent: ' + puuid + ' of node with uuid: ' + n.uuid + ' does not exist.');\n\t          }\n\t        });\n\t      } else {\n\t        console.log('Error: Parents array of node with uuid: ' + n.uuid + ' is undefined!');\n\t      }\n\t    } else {\n\t      console.log('Error: Node uuid is undefined!');\n\t    }\n\t  });\n\t}\n\n\t/**\n\t * For each node, set pred nodes, succ nodes, predLinks links as well as\n\t * succLinks links.\n\t */\n\tfunction createNodeLinkMapping() {\n\t  links.forEach(function (l) {\n\t    l.source.succs.set(l.target.autoId, l.target);\n\t    l.source.succLinks.set(l.autoId, l);\n\t    l.target.preds.set(l.source.autoId, l.source);\n\t    l.target.predLinks.set(l.autoId, l);\n\t  });\n\n\t  /* Set input and output nodes. */\n\t  nodes.forEach(function (n) {\n\t    if (n.succs.empty()) {\n\t      /* Set output nodes. */\n\t      oNodes.push(n);\n\t    } else if (n.preds.empty()) {\n\t      /* Set input nodes. */\n\t      iNodes.push(n);\n\t    }\n\t  });\n\t}\n\n\t/**\n\t * Divide analyses into independent subanalyses.\n\t */\n\tfunction markSubanalyses() {\n\t  var subanalysis = 0;\n\n\t  /**\n\t   * Traverse graph back when the node has two or more predecessors.\n\t   * @param n Current node.\n\t   * @param subanalysis Current subanalysis.\n\t   */\n\t  var traverseBackSubanalysis = function traverseBackSubanalysis(n, currentSubAnalysis) {\n\t    n.subanalysis = currentSubAnalysis;\n\t    n.preds.values().forEach(function (pn) {\n\t      if (pn.subanalysis === null) {\n\t        traverseBackSubanalysis(pn, currentSubAnalysis);\n\t      }\n\t    });\n\n\t    n.succs.values().forEach(function (sn) {\n\t      if (sn.subanalysis === null) {\n\t        // Need to disable ESLint here because of a circular dependency\n\t        traverseDataset(sn, currentSubAnalysis); // eslint-disable-line no-use-before-define\n\t      }\n\t    });\n\t  };\n\n\t  /**\n\t   * Traverse graph in a DFS fashion.\n\t   * @param n Current node.\n\t   * @param subanalysis Current subanalysis.\n\t   */\n\t  function traverseDataset(n, _currentSubAnalysis_) {\n\t    var currentSubAnalysis = _currentSubAnalysis_;\n\n\t    n.subanalysis = currentSubAnalysis;\n\n\t    if (n.preds.size() > 1) {\n\t      n.preds.values().forEach(function (pn) {\n\t        if (pn.subanalysis === null) {\n\t          traverseBackSubanalysis(pn, currentSubAnalysis);\n\t        }\n\t      });\n\t    }\n\n\t    n.succs.values().forEach(function (sn) {\n\t      if (sn.analysis !== 'dataset') {\n\t        if (sn.subanalysis === null) {\n\t          if (!sn.succs.empty()) {\n\t            currentSubAnalysis = sn.succs.values()[0].subanalysis;\n\t          }\n\t        } else {\n\t          currentSubAnalysis = sn.subanalysis;\n\t        }\n\t      }\n\t      traverseDataset(sn, currentSubAnalysis);\n\t    });\n\t  }\n\n\t  /* For each subanalysis in the dataset. */\n\t  iNodes.forEach(function (n) {\n\t    /* Processed nodes are set to \"null\" after parsing nodes. */\n\t    if (n.subanalysis === null) {\n\t      traverseDataset(n, subanalysis);\n\t      subanalysis++;\n\t    }\n\t  });\n\t}\n\n\t/**\n\t * Create analysis node.\n\t * @param a Analysis.\n\t * @param i Index.\n\t * @returns {models.Analysis} New Analysis object.\n\t */\n\tfunction createAnalysisNode(a, i) {\n\t  var initTime = {\n\t    start: a.time_start,\n\t    end: a.time_end,\n\t    created: a.creation_date\n\t  };\n\n\t  if (initTime.start.length === 19) {\n\t    initTime.start = initTime.start.concat('.000');\n\t  } else if (initTime.start.length === 26) {\n\t    initTime.start = initTime.start.substr(0, initTime.start.length - 3);\n\t  }\n\t  if (initTime.end.length === 19) {\n\t    initTime.end = initTime.end.concat('.000');\n\t  } else if (initTime.end.length === 26) {\n\t    initTime.end = initTime.end.substr(0, initTime.end.length - 3);\n\t  }\n\t  if (initTime.created.length === 19) {\n\t    initTime.created = initTime.created = initTime.created.concat('.000');\n\t  } else if (initTime.created.length === 26) {\n\t    initTime.created = initTime.created.substr(0, initTime.created.length - 3);\n\t  }\n\n\t  return new Analysis(i, Object.create(null), true, a.uuid, a.workflow__uuid, i, initTime.start, initTime.end, initTime.created);\n\t}\n\n\t/**\n\t * Extracts workflow uuid with its workflow data.\n\t * @param analysesData analyses object extracted from global refinery\n\t * variable.\n\t */\n\tfunction extractWorkflows(analysesData) {\n\t  analysesData.forEach(function (a) {\n\t    /* Prepare for json format. */\n\t    var prepareJSON = function prepareJSON(wfCpy) {\n\t      var text = wfCpy.replace(/u'/g, '\"');\n\t      text = text.replace(/\\'/g, '\"');\n\t      text = text.replace(/\\sNone/g, ' \"None\"');\n\t      text = text.replace(/\\\\n/g, '');\n\t      text = text.replace(/\\\\/g, '');\n\t      text = text.replace(/\\\"{\\\"/g, '{\"');\n\t      text = text.replace(/}\\\"/g, '}');\n\t      text = text.replace(/\\\"\\\"(\\S+)\\\"\\\"/g, '\"$1\"');\n\n\t      /* Eliminate __xxxx__ parameters. */\n\t      text = text.replace(/\\\"__(\\S*)__\\\":\\s{1}\\d*(,\\s{1})?/g, '');\n\t      text = text.replace(/,\\s{1}null/g, '');\n\t      text = text.replace(/null,/g, ''); // TODO: temp fix\n\t      text = text.replace(/,\\s{1}}/g, '}');\n\n\t      return text;\n\t    };\n\n\t    /* Transform to JSON object. */\n\t    var text = prepareJSON(a.workflow_copy);\n\t    var wfData = JSON.parse(text);\n\t    var wfObj = wfData;\n\t    workflowData.set(a.workflow__uuid, wfObj);\n\t  });\n\t}\n\n\t/**\n\t * Extracts analyses nodes as well as maps it to their corresponding\n\t * workflows.\n\t * @param analysesData analyses object extracted from global refinery\n\t * variable.\n\t */\n\tfunction extractAnalyses(analysesData) {\n\t  /* Datasets have no date information. */\n\t  var initDate = d3.time.format.iso(new Date(0));\n\t  if (analysesData.length > 0) {\n\t    initDate = d3.min(analysesData, function (d) {\n\t      return new Date(d.time_start);\n\t    });\n\t    initDate.setSeconds(initDate.getSeconds() - 1);\n\t    initDate = d3.time.format.iso(initDate);\n\t  }\n\n\t  /* Fix to remove Z at the end of the date string. */\n\t  initDate = initDate.substr(0, initDate.length - 1);\n\n\t  /* Create analysis for dataset. */\n\t  dataset = new Analysis(0, Object.create(null), true, 'dataset', 'dataset', 0, initDate, initDate, initDate);\n\t  aNodes.push(dataset);\n\t  analysisWorkflowMap.set('dataset', 'dataset');\n\n\t  /* Create remaining analyses. */\n\t  analysesData.forEach(function (a, i) {\n\t    aNodes.push(createAnalysisNode(a, i + 1));\n\t    analysisWorkflowMap.set(a.uuid, a.workflow__uuid);\n\t    analysisData.set(a.uuid, a);\n\t  });\n\t}\n\n\t/**\n\t * Create subanalysis node.\n\t * @param sanId Subanalysis id.\n\t * @param an Analysis.\n\t * @param subanalysis\n\t * @returns {models.Subanalysis} New Subanalysis object.\n\t */\n\tfunction createSubanalysisNode(sanId, an, subanalysis) {\n\t  return new Subanalysis(sanId, an, true, subanalysis);\n\t}\n\n\t/**\n\t * For each analysis the corresponding nodes as well as specifically in- and\n\t * output nodes are mapped to it.\n\t */\n\tfunction createAnalysisNodeMapping() {\n\t  /* Subanalysis. */\n\n\t  /* Create subanalysis node. */\n\t  var sanId = 0;\n\t  aNodes.forEach(function (an) {\n\t    nodes.filter(function (n) {\n\t      return n.analysis === an.uuid;\n\t    }).forEach(function (n) {\n\t      if (!an.children.has(n.subanalysis)) {\n\t        var san = createSubanalysisNode(sanId, an, n.subanalysis);\n\t        saNodes.push(san);\n\t        an.children.set(n.subanalysis, san);\n\t        sanId++;\n\t      }\n\t    });\n\t  });\n\n\t  saNodes.forEach(function (san) {\n\t    /* Set child nodes for subanalysis. */\n\t    nodes.filter(function (n) {\n\t      return san.parent.uuid === n.analysis && n.subanalysis === san.subanalysis;\n\t    }).forEach(function (cn) {\n\t      return san.children.set(cn.autoId, cn);\n\t    });\n\n\t    /* Set subanalysis parent for nodes. */\n\t    san.children.values().forEach(function (n) {\n\t      n.parent = san;\n\t    });\n\n\t    /* Set input nodes for subanalysis. */\n\t    san.children.values().filter(function (n) {\n\t      return n.preds.values().some(function (p) {\n\t        return p.analysis !== san.parent.uuid;\n\t      }) || n.preds.empty();\n\t    })\n\t    /* If no src analyses exists. */\n\t    .forEach(function (inn) {\n\t      return san.inputs.set(inn.autoId, inn);\n\t    });\n\n\t    /* Set output nodes for subanalysis. */\n\t    san.children.values().filter(function (n) {\n\t      return n.succs.empty() || n.succs.values().some(function (s) {\n\t        return s.analysis !== san.parent.uuid;\n\t      });\n\t    }).forEach(function (onn) {\n\t      san.outputs.set(onn.autoId, onn);\n\t    });\n\t  });\n\n\t  saNodes.forEach(function (san) {\n\t    /* Set predecessor subanalyses. */\n\t    san.inputs.values().forEach(function (n) {\n\t      n.preds.values().forEach(function (pn) {\n\t        if (!san.preds.has(pn.parent.autoId)) {\n\t          san.preds.set(pn.parent.autoId, pn.parent);\n\t        }\n\t      });\n\t    });\n\n\t    /* Set successor subanalyses. */\n\t    san.outputs.values().forEach(function (n) {\n\t      n.succs.values().forEach(function (sn) {\n\t        if (!san.succs.has(sn.parent.autoId)) {\n\t          san.succs.set(sn.parent.autoId, sn.parent);\n\t        }\n\t      });\n\t    });\n\t  });\n\n\t  /* Set link references for subanalyses. */\n\t  saNodes.forEach(function (san) {\n\t    san.inputs.values().forEach(function (sain) {\n\t      sain.predLinks.values().forEach(function (l) {\n\t        san.predLinks.set(l.autoId, l);\n\t      });\n\t    });\n\n\t    san.outputs.values().forEach(function (saon) {\n\t      saon.succLinks.values().forEach(function (l) {\n\t        san.succLinks.set(l.autoId, l);\n\t      });\n\t    });\n\t  });\n\n\t  /* Set links for subanalysis. */\n\t  saNodes.forEach(function (san) {\n\t    links.filter(function (l) {\n\t      return l !== null && san.parent.uuid === l.source.analysis && l.source.subanalysis === san.subanalysis;\n\t    }).forEach(function (ll) {\n\t      if (san.parent.uuid === ll.target.analysis) {\n\t        san.links.set(ll.autoId, ll);\n\t      } else {\n\t        /* Set links between analyses. */\n\t        aLinks.push(ll);\n\t      }\n\t    });\n\t  });\n\n\t  /* Analysis. */\n\t  aNodes.forEach(function (an) {\n\t    /* Children are set already. */\n\t    an.children.values().forEach(function (san) {\n\t      /* Set input nodes. */\n\t      san.inputs.entries().forEach(function (sani) {\n\t        an.inputs.set(sani.key, sani.value);\n\t      });\n\n\t      /* Set output nodes. */\n\t      san.outputs.entries().forEach(function (sano) {\n\t        an.outputs.set(sano.key, sano.value);\n\t      });\n\n\t      /* Set subanalysis wfUuid. */\n\t      san.wfUuid = an.wfUuid;\n\t    });\n\n\t    /* Set workflow name. */\n\t    var wfObj = workflowData.get(an.wfUuid);\n\t    an.wfName = typeof wfObj === 'undefined' ? 'dataset' : wfObj.name;\n\n\t    /*  TODO: Temporary workflow abbreviation. */\n\t    if (an.wfName.substr(0, 15) === 'Test workflow: ') {\n\t      an.wfName = an.wfName.substr(15, an.wfName.length - 15);\n\t    }\n\t    if (an.wfName.indexOf('(') > 0) {\n\t      an.wfName = an.wfName.substr(0, an.wfName.indexOf('('));\n\t    }\n\t    if (an.wfName.indexOf('-') > 0) {\n\t      an.wfName = an.wfName.substr(0, an.wfName.indexOf('-'));\n\t    }\n\t    an.wfCode = an.wfName;\n\t  });\n\n\t  aNodes.forEach(function (an) {\n\t    /* Set predecessor analyses. */\n\t    an.children.values().forEach(function (san) {\n\t      san.preds.values().forEach(function (psan) {\n\t        if (!an.preds.has(psan.parent.autoId)) {\n\t          an.preds.set(psan.parent.autoId, psan.parent);\n\t        }\n\t      });\n\t    });\n\n\t    /* TODO: Bug when deleting a successful analysis\n\t     * through django admin gui. */\n\n\t    /* Set successor analyses. */\n\t    an.children.values().forEach(function (san) {\n\t      san.succs.values().forEach(function (ssan) {\n\t        if (!an.succs.has(ssan.parent.autoId)) {\n\t          an.succs.set(ssan.parent.autoId, ssan.parent);\n\t        }\n\t      });\n\t    });\n\t  });\n\n\t  /* Set analysis links. */\n\t  aNodes.forEach(function (an) {\n\t    an.children.values().forEach(function (san) {\n\t      san.links.values().forEach(function (sanl) {\n\t        an.links.set(sanl.autoId, sanl);\n\t      });\n\t    });\n\t  });\n\n\t  /* Set predLinks and succLinks. */\n\t  aNodes.forEach(function (an) {\n\t    an.inputs.values().forEach(function (ain) {\n\t      ain.predLinks.values().forEach(function (l) {\n\t        an.predLinks.set(l.autoId, l);\n\t      });\n\t    });\n\t    an.outputs.values().forEach(function (aon) {\n\t      aon.succLinks.values().forEach(function (l) {\n\t        an.succLinks.set(l.autoId, l);\n\t      });\n\t    });\n\t  });\n\t}\n\n\t/**\n\t * Temporarily facet node attribute extraction.\n\t * @param solrResponse Facet filter information on node attributes.\n\t */\n\tfunction extractFacetNodeAttributesPrivate(solrResponse) {\n\t  if (solrResponse instanceof SolrResponse) {\n\t    solrResponse.getDocumentList().forEach(function (d) {\n\t      /* Set facet attributes to all nodes for the subanalysis of the selected\n\t       * node.\n\t       */\n\t      var selNode = nodeMap.get(d.uuid);\n\t      var rawFacetAttributes = d3.entries(d);\n\n\t      rawFacetAttributes.forEach(function (fa) {\n\t        var attrNameEndIndex = fa.key.indexOf('_Characteristics_');\n\t        var attrName = '';\n\n\t        if (attrNameEndIndex === -1) {\n\t          attrName = fa.key.replace(/REFINERY_/g, '');\n\t          attrName = attrName.replace(/_([0-9])+_([0-9])+_s/g, '');\n\t          attrName = attrName.toLowerCase();\n\t        } else {\n\t          attrName = fa.key.substr(0, attrNameEndIndex);\n\t        }\n\n\t        selNode.attributes.set(attrName, fa.value);\n\t      });\n\t    });\n\t  }\n\t}\n\n\t/**\n\t * Add face node attributes to dropdown button menu in toolbar.\n\t * @param solrResponse Facet filter information on node attributes.\n\t */\n\tfunction createFacetNodeAttributeList(solrResponse) {\n\t  /* Extract attributes. */\n\t  if (solrResponse instanceof SolrResponse && solrResponse.getDocumentList().length > 0) {\n\t    var sampleNode = solrResponse.getDocumentList()[0];\n\t    var rawAttrSet = d3.entries(sampleNode);\n\n\t    rawAttrSet.forEach(function (fa) {\n\t      var attrNameEndIndex = fa.key.indexOf('_Characteristics_');\n\t      var attrName = '';\n\n\t      if (attrNameEndIndex === -1) {\n\t        attrName = fa.key.replace(/REFINERY_/g, '');\n\t        attrName = attrName.replace(/_([0-9])+_([0-9])+_s/g, '');\n\t        attrName = attrName.toLowerCase();\n\t      } else {\n\t        attrName = fa.key.substr(0, attrNameEndIndex);\n\t      }\n\n\t      nodeAttributeList.push(attrName);\n\t    });\n\t  }\n\n\t  /* Add to button dropdown list. */\n\t  nodeAttributeList.forEach(function (na) {\n\t    $('<li/>', {\n\t      id: 'prov-ctrl-visible-attribute-list-' + na,\n\t      style: 'padding-left: 5px',\n\t      html: '<a href=\"#\" class=\"field-name\"><label class=\"radio\" ' + 'style=\"text-align: start;margin-top: 0px;margin-bottom: 0px;\">' + '<input type=\"radio\">' + na + '</label></a>'\n\t    }).appendTo('#prov-ctrl-visible-attribute-list');\n\t  });\n\n\t  /* Initially set name attribute checked. */\n\t  $('#prov-ctrl-visible-attribute-list-name').find('input').prop('checked', true);\n\t}\n\n\t/**\n\t * Sets the parent objects for analysis nodes.\n\t * @param graph The provenance graph.\n\t */\n\tfunction setAnalysisParent(graph) {\n\t  graph.aNodes.forEach(function (an) {\n\t    an.parent = graph;\n\t  });\n\t}\n\n\t/**\n\t * Main init module function.\n\t * @param data Dataset holding the information for nodes and links.\n\t * @param analysesData Collection holding the information for\n\t * analysis - node mapping.\n\t * @param solrResponse Facet filter information on node attributes.\n\t * @returns {models.ProvGraph} The main graph object of the provenance\n\t * visualization.\n\t */\n\tfunction runInitPrivate(data, analysesData, solrResponse) {\n\t  /* Extract raw objects. */\n\t  var obj = d3.entries(data)[1];\n\n\t  /* Create node collection. */\n\t  extractNodes(obj, solrResponse);\n\n\t  /* Create link collection. */\n\t  extractLinks();\n\n\t  /* Set preds, succs, and predLinks as well as succLinks. */\n\t  createNodeLinkMapping();\n\n\t  /* Create analysis nodes. */\n\t  extractAnalyses(analysesData);\n\n\t  /* Extract workflow information. */\n\t  extractWorkflows(analysesData);\n\n\t  /* Divide dataset and analyses into subanalyses. */\n\t  markSubanalyses();\n\n\t  /* Create analysis node mapping. */\n\t  createAnalysisNodeMapping();\n\n\t  /* Temporarily facet node attribute extraction. */\n\t  extractFacetNodeAttributesPrivate(solrResponse);\n\n\t  /* Create node attribute list. */\n\t  createFacetNodeAttributeList(solrResponse);\n\n\t  /* Create graph. */\n\t  var graph = new ProvGraph(dataset, nodes, links, aLinks, iNodes, oNodes, aNodes, saNodes, analysisWorkflowMap, nodeMap, analysisData, workflowData, nodeData);\n\n\t  /* Set parent objects for analysis nodes. */\n\t  setAnalysisParent(graph);\n\n\t  return graph;\n\t}\n\n\t/**\n\t * Publish module function.\n\t */\n\tfunction run$1(data, analysesData, solrResponse) {\n\t  return runInitPrivate(data, analysesData, solrResponse);\n\t}\n\n\t/**\n\t * Module for layout.\n\t */\n\n\t/**\n\t * Generic implementation for the linear time topology sort [Kahn 1962]\n\t * (http://en.wikipedia.org/wiki/Topological_sorting).\n\t * @param startNodes Array containing the starting nodes.\n\t * @param nodesLength Size of the nodes array.\n\t * @param parent The parent node.\n\t * @returns {Array} Topology sorted array of nodes.\n\t */\n\tfunction topSortNodes(startNodes, nodesLength, parent) {\n\t  var sortedNodes = [];\n\n\t  /* For each successor node. */\n\t  function handleSuccessorNodes(_curNode_) {\n\t    var curNode = _curNode_;\n\n\t    /* When the analysis layout is computed, links occur between Nodes or\n\t     * analyses. */\n\t    if (curNode instanceof Node && parent instanceof ProvGraph) {\n\t      curNode = curNode.parent.parent;\n\t    }\n\n\t    /* Get successors. */\n\t    curNode.succs.values().filter(function (s) {\n\t      return s.parent === null || s.parent === parent;\n\t    }).forEach(function (_succNode_) {\n\t      var succNode = _succNode_;\n\n\t      if (succNode instanceof Node && parent instanceof ProvGraph) {\n\t        succNode = succNode.parent.parent;\n\t      }\n\n\t      /* Mark edge as removed. */\n\t      succNode.predLinks.values().forEach(function (predLink) {\n\t        /* The source node directly is an analysis. */\n\t        var predLinkNode = null;\n\t        if (curNode instanceof Analysis) {\n\t          if (predLink.source instanceof Analysis) {\n\t            predLinkNode = predLink.source;\n\t          } else {\n\t            predLinkNode = predLink.source.parent.parent;\n\t          }\n\t        } else if (curNode instanceof Node) {\n\t          predLinkNode = predLink.source;\n\t        }\n\n\t        if (predLinkNode && predLinkNode.autoId === curNode.autoId) {\n\t          predLink.l.ts.removed = true;\n\t        }\n\t      });\n\n\t      /* When successor node has no other incoming edges,\n\t       insert successor node into result set. */\n\t      if (!succNode.predLinks.values().some(function (predLink) {\n\t        return !predLink.l.ts.removed;\n\t      }) && !succNode.l.ts.removed) {\n\t        startNodes.push(succNode);\n\t        succNode.l.ts.removed = true;\n\t      }\n\t    });\n\t  }\n\n\t  /* While the input set is not empty. */\n\t  var i = 0;\n\t  while (i < startNodes.length && i < nodesLength) {\n\t    /* Remove first item. */\n\t    var curNode = startNodes[i];\n\n\t    /* And push it into result set. */\n\t    sortedNodes.push(curNode);\n\t    curNode.l.ts.removed = true;\n\n\t    /* Get successor nodes for current node. */\n\t    handleSuccessorNodes(curNode);\n\t    i++;\n\t  }\n\n\t  /* Handle cyclic graphs. */\n\t  if (startNodes.length > nodesLength) {\n\t    return null;\n\t  }\n\t  return sortedNodes;\n\t}\n\n\t/**\n\t * Assign layers.\n\t * @param tsNodes Topology sorted nodes.\n\t * @param parent The parent node.\n\t */\n\tfunction layerNodes(tsNodes, parent) {\n\t  var layer = 0;\n\t  var preds = [];\n\n\t  tsNodes.forEach(function (n) {\n\t    /* Get incoming predecessors. */\n\t    n.preds.values().forEach(function (p) {\n\t      if (p.parent === parent) {\n\t        preds.push(p);\n\t      } else if (p instanceof Node && parent instanceof ProvGraph) {\n\t        preds.push(p.parent.parent);\n\t      }\n\t    });\n\n\t    if (preds.length === 0) {\n\t      n.col = layer;\n\t    } else {\n\t      (function () {\n\t        var minLayer = layer;\n\t        preds.forEach(function (p) {\n\t          if (p.col > minLayer) {\n\t            minLayer = p.col;\n\t          }\n\t        });\n\t        n.col = minLayer + 1;\n\t      })();\n\t    }\n\t  });\n\t}\n\n\t/**\n\t * Group nodes by layers into a 2d array.\n\t * @param tsNodes Topology sorted nodes.\n\t * @returns {Array} Layer grouped nodes.\n\t */\n\tfunction groupNodes(tsNodes) {\n\t  var layer = 0;\n\t  var lgNodes = [];\n\n\t  lgNodes.push([]);\n\n\t  var k = 0;\n\t  tsNodes.forEach(function (n) {\n\t    if (n.col === layer) {\n\t      lgNodes[k].push(n);\n\t    } else if (n.col < layer) {\n\t      lgNodes[n.col].push(n);\n\t    } else {\n\t      k++;\n\t      layer++;\n\t      lgNodes.push([]);\n\t      lgNodes[k].push(n);\n\t    }\n\t  });\n\n\t  return lgNodes;\n\t}\n\n\t/**\n\t * Reorder subanalysis layout to minimize edge crossings.\n\t * @param bclgNodes Barcyenter sorted, layered and grouped analysis nodes.\n\t * @param cell Width and height of a workflow node.\n\t */\n\tfunction reorderSubanalysisNodes(bclgNodes, cell) {\n\t  /* Initializations. */\n\t  var degree = 1;\n\t  var accCoords = 0;\n\t  var usedCoords = [];\n\t  var delta = 0;\n\t  var colList = [];\n\n\t  bclgNodes.forEach(function (l) {\n\t    l.forEach(function (an) {\n\t      usedCoords = [];\n\t      an.children.values().forEach(function (san, j) {\n\t        degree = 1;\n\t        accCoords = 0;\n\t        delta = 0;\n\n\t        /* Initialize subanalysis col and row attributes.\n\t         * Only one column does exist in this view. */\n\t        san.x = 0;\n\t        san.y = j * cell.height;\n\n\t        /* The preceding analysis marks the fixed layer. */\n\t        if (!san.preds.empty()) {\n\t          degree = san.preds.size();\n\n\t          /* Accumulate san y-coord as well as an y-coord for each pred. */\n\t          san.preds.values().forEach(function (psan) {\n\t            accCoords += psan.y + psan.parent.y;\n\t          });\n\n\t          /* If any subanalysis within the analysis has the same barycenter\n\t           * value, increase it by a small value. */\n\t          if (usedCoords.indexOf(accCoords / degree) === -1) {\n\t            san.l.bcOrder = accCoords / degree;\n\t            usedCoords.push(accCoords / degree);\n\t          } else {\n\t            delta += 0.01;\n\t            san.l.bcOrder = accCoords / degree + delta;\n\t            usedCoords.push(accCoords / degree + delta);\n\t          }\n\n\t          /* Push into array to reorder afterwards. */\n\t          colList.push(san);\n\t        }\n\t      });\n\n\t      /* Sort and reorder subanalysis nodes. */\n\t      colList.sort(function (a, b) {\n\t        return a.l.bcOrder - b.l.bcOrder;\n\t      }).forEach(function (d, j) {\n\t        d.y = j * cell.height;\n\t      });\n\n\t      /* Reset reorder list. */\n\t      colList = [];\n\t    });\n\t  });\n\n\t  delta = 0;\n\n\t  var looseSAn = [];\n\n\t  /* Reorder most left layer based on the second most left layer. */\n\t  bclgNodes[0][0].children.values().forEach(function (san, j) {\n\t    /* Only one column does exist in this view. */\n\t    san.x = 0;\n\t    san.y = j * cell.height;\n\t    accCoords = 0;\n\t    degree = 0;\n\n\t    /* Accumulate san y-coord as well as an y-coord for each pred.\n\t     * Take analysis, subanalysis and workflow coordinates into account. */\n\t    san.succs.values().forEach(function (ssan) {\n\t      ssan.inputs.values().forEach(function (ni) {\n\t        if (ni.preds.values().some(function (pni) {\n\t          return pni.parent === san;\n\t        })) {\n\t          /* Prioritize subanalysis ordering over workflow node ordering. */\n\t          accCoords += ssan.parent.y + ssan.y + ssan.y / cell.height / 10 + ni.y;\n\t          degree++;\n\t        }\n\t      });\n\t    });\n\n\t    /* Avoid zero division. */\n\t    if (degree !== 0) {\n\t      /* If any subanalysis within the analysis has the same barycenter value,\n\t       * increase it by a small value. */\n\t      if (usedCoords.indexOf(accCoords / degree) === -1) {\n\t        san.l.bcOrder = accCoords / degree;\n\t        usedCoords.push(accCoords / degree);\n\t      } else {\n\t        delta += 0.01;\n\t        san.l.bcOrder = accCoords / degree + delta;\n\t        usedCoords.push(accCoords / degree + delta);\n\t      }\n\t    } else {\n\t      san.l.bcOrder = 0;\n\t      looseSAn.push(san);\n\t    }\n\n\t    /* Push into array to reorder afterwards. */\n\t    colList.push(san);\n\t  });\n\n\t  /* Sort and reorder subanalysis nodes. */\n\t  colList.sort(function (a, b) {\n\t    return a.l.bcOrder - b.l.bcOrder;\n\t  });\n\n\t  for (var i = 0; i < looseSAn.length / 2; i++) {\n\t    colList.push(colList.shift());\n\t  }\n\n\t  colList.forEach(function (d, j) {\n\t    d.y = j * cell.height;\n\t  });\n\t}\n\n\t/**\n\t * Dagre layout for subanalysis.\n\t * @param graph The provenance graph.\n\t * @param cell Width and height of a workflow node.\n\t */\n\tfunction dagreWorkflowLayout(graph, cell) {\n\t  graph.saNodes.forEach(function (san) {\n\t    /* Init graph. */\n\t    var g = new dagre.graphlib.Graph();\n\t    g.setGraph({\n\t      rankdir: 'LR',\n\t      nodesep: 0,\n\t      edgesep: 0,\n\t      ranksep: 0,\n\t      marginx: 0,\n\t      marginy: 0\n\t    });\n\t    g.setDefaultEdgeLabel(function () {\n\t      return {};\n\t    });\n\n\t    /* Add nodes. */\n\t    san.children.values().forEach(function (n) {\n\t      g.setNode(n.autoId, {\n\t        label: n.autoId,\n\t        width: cell.width,\n\t        height: cell.height\n\t      });\n\t    });\n\n\t    /* Add edges. */\n\t    san.links.values().forEach(function (l) {\n\t      g.setEdge(l.source.autoId, l.target.autoId, {\n\t        minlen: 0,\n\t        weight: 1,\n\t        width: 0,\n\t        height: 0,\n\t        labelpos: 'r',\n\t        labeloffset: 10\n\t      });\n\t    });\n\n\t    /* Compute layout. */\n\t    dagre.layout(g);\n\n\t    /* Init workflow node coords. */\n\t    d3.entries(g._nodes).forEach(function (n) {\n\t      /* TODO: Revise potential refinery database bug. */\n\t      if (san.children.has(n.key)) {\n\t        san.children.get(n.key).x = parseInt(n.value.x - cell.width / 2, 10);\n\t        san.children.get(n.key).y = parseInt(n.value.y - cell.height / 2, 10);\n\t      }\n\t    });\n\t  });\n\t}\n\n\t/**\n\t * Dagre layout for analysis.\n\t * @param graph The provenance Graph.\n\t * @param cell Grid cell.\n\t */\n\tfunction dagreGraphLayout(graph, cell) {\n\t  /* Init graph. */\n\t  var g = new dagre.graphlib.Graph();\n\t  g.setGraph({\n\t    rankdir: 'LR',\n\t    nodesep: 0,\n\t    edgesep: 0,\n\t    ranksep: 0,\n\t    marginx: 0,\n\t    marginy: 0\n\t  });\n\n\t  g.setDefaultEdgeLabel(function () {\n\t    return {};\n\t  });\n\n\t  /* Add nodes. */\n\t  graph.aNodes.forEach(function (an) {\n\t    g.setNode(an.autoId, {\n\t      label: an.autoId,\n\t      width: cell.width,\n\t      height: cell.height\n\t    });\n\t  });\n\n\t  /* Add edges. */\n\t  graph.aLinks.forEach(function (l) {\n\t    g.setEdge(l.source.parent.parent.autoId, l.target.parent.parent.autoId, {\n\t      minlen: 1,\n\t      weight: 1,\n\t      width: 0,\n\t      height: 0,\n\t      labelpos: 'r',\n\t      labeloffset: 10\n\t    });\n\t  });\n\n\t  /* Compute layout. */\n\t  dagre.layout(g);\n\n\t  var dlANodes = d3.entries(g._nodes);\n\t  graph.aNodes.forEach(function (an) {\n\t    an.x = parseInt(dlANodes.filter(function (d) {\n\t      return d.key === an.autoId.toString();\n\t    })[0].value.x - cell.width / 2, 10);\n\t    an.y = parseInt(dlANodes.filter(function (d) {\n\t      return d.key === an.autoId.toString();\n\t    })[0].value.y - cell.height / 2, 10);\n\t  });\n\t}\n\n\t/**\n\t * Main layout module function.\n\t * @param graph The main graph object of the provenance visualization.\n\t * @param cell Width and height of a workflow node.\n\t */\n\tfunction runLayoutPrivate(graph, cell) {\n\t  /* Graph layout. */\n\t  dagreGraphLayout(graph, cell);\n\n\t  /* Workflow layout. */\n\t  dagreWorkflowLayout(graph, cell);\n\n\t  /* Analysis layout:\n\t   * Topology sort first, followed by layering and the creation of a 2d-array.\n\t   * Subanalysis may then be reorderd based on their preceding analysis node\n\t   * positions. */\n\t  var bclgNodes = [];\n\t  var startANodes = [];\n\t  startANodes.push(graph.dataset);\n\t  var tsANodes = topSortNodes(startANodes, graph.aNodes.length, graph);\n\n\t  if (tsANodes !== null) {\n\t    layerNodes(tsANodes, graph);\n\n\t    startANodes = [];\n\t    startANodes.push(graph.dataset);\n\t    graph.aNodes.forEach(function (an) {\n\t      an.l.ts.removed = false;\n\t    });\n\t    graph.aLinks.forEach(function (al) {\n\t      al.l.ts.removed = false;\n\t    });\n\t    tsANodes = topSortNodes(startANodes, graph.aNodes.length, graph);\n\t    layerNodes(tsANodes, graph);\n\n\t    bclgNodes = groupNodes(tsANodes);\n\n\t    /* Analysis layout. */\n\t    reorderSubanalysisNodes(bclgNodes, cell);\n\t  } else {\n\t    throw new Error('Graph is not acyclic.');\n\t  }\n\t  return bclgNodes;\n\t}\n\n\t/**\n\t * Publish module function.\n\t */\n\tfunction run$2(graph, cell) {\n\t  return runLayoutPrivate(graph, cell);\n\t}\n\n\t/**\n\t * Helper function collection for the provvis module.\n\t */\n\n\t/**\n\t * Set hidden attribute for object and class for css of BaseNode.\n\t * @param n BaseNode.\n\t */\n\tfunction hideChildNodes(n) {\n\t  if (!n.children.empty()) {\n\t    n.children.values().forEach(function (cn) {\n\t      cn.hidden = true;\n\t      d3.selectAll('#nodeId-' + cn.autoId).classed({\n\t        selectedNode: false,\n\t        hiddenNode: true\n\t      });\n\t      if (!cn.children.empty()) {\n\t        hideChildNodes(cn);\n\t      }\n\t    });\n\t  }\n\t}\n\n\t/**\n\t * Set selected attribute for object of BaseNode.\n\t * @param n BaseNode.\n\t * @param selected Node may be selected or not.\n\t */\n\tfunction propagateNodeSelection(n, selected) {\n\t  if (!n.children.empty()) {\n\t    n.children.values().forEach(function (cn) {\n\t      cn.selected = selected;\n\t      cn.doi.selectedChanged();\n\t      // d3.selectAll(\"#nodeId-\" + cn.autoId).classed({\"selectedNode\":\n\t      // selected});\n\t      if (!cn.children.empty()) {\n\t        propagateNodeSelection(cn, selected);\n\t      }\n\t    });\n\t  }\n\t}\n\n\t/**\n\t * Helper function to parse a date with the declated time format.\n\t * @returns {*} Returns the custom time format.\n\t */\n\tfunction customTimeFormat(date) {\n\t  return d3.time.format('%Y-%m-%d %H:%M:%S %p')(date);\n\t}\n\n\t/**\n\t * Parses a string into the ISO time format.\n\t * @param value The time in the string format.\n\t * @returns {*} The value in the ISO time format.\n\t */\n\tfunction parseISOTimeFormat(value) {\n\t  return d3.time.format('%Y-%m-%dT%H:%M:%S.%L').parse(value);\n\t}\n\n\t/**\n\t * Helper function to compare two d3.map() objects.\n\t * @param a\n\t * @param b\n\t * @returns {boolean}\n\t */\n\tfunction compareMaps(a, b) {\n\t  var equal = true;\n\t  if (a.size() === b.size()) {\n\t    a.keys().forEach(function (k) {\n\t      if (!b.has(k)) {\n\t        equal = false;\n\t      }\n\t    });\n\t  } else {\n\t    equal = false;\n\t  }\n\t  return equal;\n\t}\n\n\t/**\n\t * Get layer child analysis predecessor link count.\n\t * @param ln Layer node.\n\t */\n\tfunction getLayerPredCount(ln) {\n\t  return ln.children.values().map(function (an) {\n\t    return an.predLinks.size();\n\t  }).reduce(function (acc, pls) {\n\t    return acc + pls;\n\t  });\n\t}\n\n\t/**\n\t * Get layer child analysis successor link count.\n\t * @param ln Layer node.\n\t */\n\tfunction getLayerSuccCount(ln) {\n\t  return ln.children.values().map(function (an) {\n\t    return an.succLinks.size();\n\t  }).reduce(function (acc, pls) {\n\t    return acc + pls;\n\t  });\n\t}\n\n\t/**\n\t * Module for motif discovery and injection.\n\t */\n\n\t/* TODO: May refine algorithm. */\n\t/**\n\t * Find and mark sequential and parallel analysis steps.\n\t * @param graph The provenance graph.\n\t * @param layerMethod Strict or weak layering, changing the condition analyses\n\t * are layered together.\n\t * @returns {*} Layered nodes.\n\t */\n\tfunction createLayerNodes(graph, layerMethod) {\n\t  var layers = [];\n\t  var lNodes = d3.map();\n\t  var layerId = 0;\n\n\t  /* Iterate breath first search. */\n\t  graph.bclgNodes.forEach(function (l, i) {\n\t    var motifs = d3.map();\n\n\t    /* For each depth-level. */\n\t    l.sort(function (a, b) {\n\t      return parseISOTimeFormat(a.start) - parseISOTimeFormat(b.start);\n\t    }).forEach(function (an) {\n\t      var foundMotif = false;\n\t      var thisMotif = null;\n\t      var anPreds = d3.map();\n\t      var anSuccs = d3.map();\n\n\t      an.predLinks.values().forEach(function (pl) {\n\t        anPreds.set(pl.source.autoId, pl.source);\n\t      });\n\t      an.succLinks.values().forEach(function (sl) {\n\t        anSuccs.set(sl.target.autoId, sl.target);\n\t      });\n\n\t      /* Check if the current analysis conforms to a motif already created. */\n\t      motifs.values().forEach(function (m) {\n\t        /* Strict or weak layering. */\n\t        if (m.wfUuid === an.wfUuid && layerMethod === 'weak' || m.wfUuid === an.wfUuid && layerMethod === 'strict' && m.numSubanalyses === an.children.size() && an.predLinks.size() === m.numIns && an.succLinks.size() === m.numOuts) {\n\t          if (an.preds.values()[0].uuid === 'dataset' && compareMaps(anPreds, m.preds) || an.preds.values()[0].uuid !== 'dataset') {\n\t            foundMotif = true;\n\t            thisMotif = m;\n\t          }\n\t        }\n\t      });\n\n\t      /* Create new motif. */\n\t      if (!foundMotif) {\n\t        (function () {\n\t          var motif = new Motif();\n\t          an.predLinks.values().forEach(function (pl) {\n\t            motif.preds.set(pl.source.autoId, pl.source);\n\t          });\n\t          an.succLinks.values().forEach(function (sl) {\n\t            motif.succs.set(sl.target.autoId, sl.target);\n\t          });\n\t          motif.numIns = an.predLinks.size();\n\t          motif.numOuts = an.succLinks.size();\n\t          motif.wfUuid = an.wfUuid;\n\t          motif.numSubanalyses = an.children.size();\n\t          motifs.set(motif.autoId, motif);\n\t          an.motif = motif;\n\t        })();\n\t      } else {\n\t        an.motif = thisMotif;\n\t      }\n\t    });\n\n\t    layers.push(d3.map());\n\n\t    /* Group the same motifs into a layer. */\n\t    l.forEach(function (an) {\n\t      var keyStr = an.preds.values().map(function (pan) {\n\t        return pan.motif.autoId;\n\t      });\n\t      var layer = Object.create(null);\n\n\t      /* Check topology of pred motifs and actual motif. */\n\n\t      /* Create new layer. */\n\t      if (!layers[i].has(keyStr + '-' + an.motif.autoId)) {\n\t        layer = new Layer(layerId, an.motif, graph, false);\n\t        layer.children.set(an.autoId, an);\n\t        an.layer = layer;\n\t        lNodes.set(layer.autoId, an.layer);\n\t        layerId++;\n\n\t        layers[i].set(keyStr + '-' + an.motif.autoId, layer.autoId);\n\n\t        /* Add to existing layer. */\n\t      } else {\n\t          layer = lNodes.get(layers[i].get(keyStr + '-' + an.motif.autoId));\n\t          layer.children.set(an.autoId, an);\n\t          an.layer = layer;\n\t        }\n\t    });\n\t  });\n\t  return lNodes;\n\t}\n\n\t/**\n\t * For each layer the corresponding analyses, preceding and succeeding links\n\t * as well as specifically in- and output nodes are mapped to it.\n\t * @param graph The provenance graph.\n\t */\n\tfunction createLayerAnalysisMapping(graph) {\n\t  /* Layer children are set already. */\n\t  graph.lNodes.values().forEach(function (ln) {\n\t    ln.children.values().forEach(function (an) {\n\t      /* Set analysis parent. */\n\t      an.parent = an.layer;\n\n\t      /* Set input nodes. */\n\t      an.inputs.values().forEach(function (n) {\n\t        ln.inputs.set(n.autoId, n);\n\t      });\n\t      /* Set output nodes. */\n\t      an.outputs.values().forEach(function (n) {\n\t        ln.outputs.set(n.autoId, n);\n\t      });\n\t    });\n\n\t    /* Set workflow name. */\n\t    var wfName = 'dataset';\n\t    if (typeof graph.workflowData.get(ln.motif.wfUuid) !== 'undefined') {\n\t      wfName = graph.workflowData.get(ln.motif.wfUuid).name;\n\t    }\n\t    ln.wfName = wfName.toString();\n\t    ln.wfCode = ln.children.values()[0].wfCode;\n\n\t    /* Set layer parent. */\n\t    ln.parent = graph;\n\n\t    /* Set layer visibility. */\n\t    if (ln.children.size() <= 1) {\n\t      ln.hidden = true;\n\t    }\n\t    /* Set child analysis visibility. */\n\t    if (ln.children.size() === 1) {\n\t      ln.children.values()[0].hidden = false;\n\n\t      /* Set link visibility. */\n\t      ln.children.values()[0].predLinks.values().forEach(function (pl) {\n\t        pl.hidden = false;\n\t      });\n\t      ln.children.values()[0].succLinks.values().forEach(function (sl) {\n\t        sl.hidden = false;\n\t      });\n\t    }\n\t  });\n\n\t  graph.lNodes.values().forEach(function (ln) {\n\t    /* Set predecessor layers. */\n\t    ln.children.values().forEach(function (an) {\n\t      an.preds.values().forEach(function (pan) {\n\t        if (!ln.preds.has(pan.layer.autoId)) {\n\t          ln.preds.set(pan.layer.autoId, pan.layer);\n\t        }\n\t      });\n\t    });\n\n\t    /* Set successor layers. */\n\t    ln.children.values().forEach(function (an) {\n\t      an.succs.values().forEach(function (san) {\n\t        if (!ln.succs.has(san.layer.autoId)) {\n\t          ln.succs.set(san.layer.autoId, san.layer);\n\t        }\n\t      });\n\t    });\n\t  });\n\n\t  /* Set layer links. */\n\t  graph.lNodes.values().forEach(function (ln) {\n\t    ln.children.values().forEach(function (an) {\n\t      an.links.values().forEach(function (anl) {\n\t        ln.links.set(anl.autoId, anl);\n\t      });\n\t    });\n\t  });\n\n\t  /* Set layer links. */\n\t  var linkId = 0;\n\t  graph.lNodes.values().forEach(function (pl) {\n\t    pl.succs.values().forEach(function (sl) {\n\t      var layerLink = new Link(linkId, pl, sl, pl.hidden || sl.hidden);\n\t      graph.lLinks.set(layerLink.autoId, layerLink);\n\t      pl.succLinks.set(layerLink.autoId, layerLink);\n\t      sl.predLinks.set(layerLink.autoId, layerLink);\n\t      linkId++;\n\t    });\n\t  });\n\t}\n\n\t/**\n\t * Compute difference between motif and analysis.\n\t * @param graph The provenance graph.\n\t */\n\tfunction computeAnalysisMotifDiff(graph) {\n\t  /* Compute motif analysis change*/\n\t  graph.aNodes.sort(function (a, b) {\n\t    return parseISOTimeFormat(a.start) - parseISOTimeFormat(b.start);\n\t  }).forEach(function (an) {\n\t    /* TODO: Fix as some new layers with a single analysis may have the motif\n\t     * of the last layer created. */\n\t    if (an.parent.children.size() !== 1) {\n\t      an.motifDiff.numSubanalyses = an.children.size() - an.motif.numSubanalyses;\n\t      an.motifDiff.numIns = an.predLinks.size() - an.motif.numIns;\n\t      an.motifDiff.numOuts = an.succLinks.size() - an.motif.numOuts;\n\t    }\n\t  });\n\t}\n\n\t/**\n\t * Clear all layer information from analyses.\n\t * @param graph The provenance graph.\n\t */\n\tfunction cleanLayerAnalysisMapping(graph) {\n\t  graph.aNodes.forEach(function (an) {\n\t    an.layer = Object.create(null);\n\t    an.motif = Object.create(null);\n\t    an.parent = graph;\n\t    an.motifDiff = {\n\t      numIns: 0,\n\t      numOuts: 0,\n\t      wfUuid: an.wfUuid,\n\t      numSubanalyses: 0\n\t    };\n\t  });\n\t  graph.lNodes = d3.map();\n\t  graph.lLinks = d3.map();\n\t}\n\n\t/**\n\t * Main motif discovery and injection module function.\n\t * @param graph The main graph object of the provenance visualization.\n\t * @param layerMethod Strict or weak layering, changing the condition analyses\n\t * are layered together.\n\t */\n\tfunction runMotifsPrivate(graph, layerMethod) {\n\t  cleanLayerAnalysisMapping(graph);\n\t  graph.lNodes = createLayerNodes(graph, layerMethod);\n\t  createLayerAnalysisMapping(graph);\n\t  computeAnalysisMotifDiff(graph);\n\t}\n\n\t/**\n\t * Publish module function.\n\t */\n\tfunction run$3(graph, cell) {\n\t  return runMotifsPrivate(graph, cell);\n\t}\n\n\t/* Simple tooltips by NG. */\n\tvar tooltip = d3.select('body').append('div').attr('class', 'refinery-tooltip').style('position', 'absolute').style('z-index', '10').style('visibility', 'hidden');\n\n\t/**\n\t * Make tooltip visible and align it to the events position.\n\t * @param label Inner html code appended to the tooltip.\n\t * @param event E.g. mouse event.\n\t */\n\tfunction showTooltip(tooltip, label, event) {\n\t  tooltip.html(label);\n\t  tooltip.style('visibility', 'visible');\n\t  tooltip.style('top', event.pageY + 10 + 'px');\n\t  tooltip.style('left', event.pageX + 10 + 'px');\n\t}\n\n\t/**\n\t * Hide tooltip.\n\t */\n\tfunction hideTooltip(tooltip) {\n\t  tooltip.style('visibility', 'hidden');\n\t}\n\n\t/**\n\t * For a node, get first visible parent node coords.\n\t * @param curN Node to start traversing to its parents.\n\t * @returns {{x: number, y: number}} X and y coordinates of the first visible\n\t * parent node.\n\t */\n\tfunction getVisibleNodeCoords(_curN_) {\n\t  var curN = _curN_;\n\t  var x = 0;\n\t  var y = 0;\n\n\t  while (curN.hidden && !(curN instanceof Layer)) {\n\t    curN = curN.parent;\n\t  }\n\n\t  if (curN instanceof Layer) {\n\t    x = curN.x;\n\t    y = curN.y;\n\t  } else {\n\t    while (!(curN instanceof Layer)) {\n\t      x += curN.x;\n\t      y += curN.y;\n\t      curN = curN.parent;\n\t    }\n\t  }\n\n\t  return { x: x, y: y };\n\t}\n\n\t/**\n\t * Compute bounding box for expanded analysis nodes.\n\t * @param an Analysis node.\n\t * @param offset Cell offset.\n\t * @returns {{x: {min: number, max: number}, y: {min: number, max: number}}}\n\t * Min and max x, y coords.\n\t */\n\tfunction getABBoxCoords(an, cell, _offset_) {\n\t  var offset = _offset_;\n\n\t  if (!offset) {\n\t    offset = 0;\n\t  }\n\n\t  var minX = !an.hidden ? an.x : d3.min(an.children.values(), function (san) {\n\t    return !san.hidden ? an.x + san.x : d3.min(san.children.values(), function (cn) {\n\t      return !cn.hidden ? an.x + san.x + cn.x : an.x;\n\t    });\n\t  });\n\t  var maxX = !an.hidden ? an.x : d3.max(an.children.values(), function (san) {\n\t    return !san.hidden ? an.x + san.x : d3.max(san.children.values(), function (cn) {\n\t      return !cn.hidden ? an.x + san.x + cn.x : an.x;\n\t    });\n\t  });\n\t  var minY = !an.hidden ? an.y : d3.min(an.children.values(), function (san) {\n\t    return !san.hidden ? an.y + san.y : d3.min(san.children.values(), function (cn) {\n\t      return !cn.hidden ? an.y + san.y + cn.y : an.y;\n\t    });\n\t  });\n\t  var maxY = !an.hidden ? an.y : d3.max(an.children.values(), function (san) {\n\t    return !san.hidden ? an.y + san.y : d3.max(san.children.values(), function (cn) {\n\t      return !cn.hidden ? an.y + san.y + cn.y : an.y;\n\t    });\n\t  });\n\n\t  return {\n\t    x: {\n\t      min: minX + offset,\n\t      max: maxX + cell.width - offset\n\t    },\n\t    y: {\n\t      min: minY + offset,\n\t      max: maxY + cell.height - offset\n\t    }\n\t  };\n\t}\n\n\t/**\n\t * Concats an array of dom elements.\n\t * @param domArr An array of dom class selector strings.\n\t */\n\tfunction concatDomClassElements(domArr) {\n\t  var domClassStr = '';\n\t  domArr.forEach(function (d) {\n\t    domClassStr += '.' + d + ',';\n\t  });\n\n\t  return d3.selectAll(domClassStr.substr(0, domClassStr.length - 1));\n\t}\n\n\t/**\n\t * Compute doi weight based on nodes initially set as filtered.\n\t * @param lNodes Layer nodes.\n\t */\n\tfunction initDoiFilterComponent(lNodes) {\n\t  lNodes.values().forEach(function (ln) {\n\t    ln.filtered = true;\n\t    ln.doi.filteredChanged();\n\n\t    ln.children.values().forEach(function (an) {\n\t      an.filtered = true;\n\t      an.doi.filteredChanged();\n\n\t      an.children.values().forEach(function (san) {\n\t        san.filtered = true;\n\t        san.doi.filteredChanged();\n\n\t        san.children.values().forEach(function (n) {\n\t          n.filtered = true;\n\t          n.doi.filteredChanged();\n\t        });\n\t      });\n\t    });\n\t  });\n\t}\n\n\t/**\n\t * Compute doi weight based on analysis start time.\n\t * @param aNodes Analysis nodes.\n\t */\n\tfunction initDoiTimeComponent(aNodes, vis) {\n\t  var min = d3.time.format.iso(new Date(0));\n\t  var max = d3.time.format.iso(new Date(0));\n\n\t  if (aNodes.length > 1) {\n\t    min = d3.min(aNodes, function (d) {\n\t      return parseISOTimeFormat(d.start);\n\t    });\n\t    max = d3.max(aNodes, function (d) {\n\t      return parseISOTimeFormat(d.start);\n\t    });\n\t  }\n\n\t  var doiTimeScale = d3.time.scale().domain([min, max]).range([0.0, 1.0]);\n\n\t  aNodes.forEach(function (an) {\n\t    an.doi.initTimeComponent(doiTimeScale(parseISOTimeFormat(an.start)));\n\t    an.children.values().forEach(function (san) {\n\t      san.doi.initTimeComponent(doiTimeScale(parseISOTimeFormat(an.start)));\n\t      san.children.values().forEach(function (n) {\n\t        n.doi.initTimeComponent(doiTimeScale(parseISOTimeFormat(an.start)));\n\t      });\n\t    });\n\t  });\n\n\t  vis.graph.lNodes.values().forEach(function (l) {\n\t    l.doi.initTimeComponent(d3.mean(l.children.values(), function (an) {\n\t      return doiTimeScale(parseISOTimeFormat(an.start));\n\t    }));\n\t  });\n\t}\n\n\t/**\n\t * Compute bounding box for child nodes.\n\t * @param n BaseNode.\n\t * @param offset Cell offset.\n\t * @returns {{x: {min: *, max: *}, y: {min: *, max: *}}} Min and\n\t * max x, y coords.\n\t */\n\tfunction getWFBBoxCoords(n, cell, offset) {\n\t  var minX = void 0;\n\t  var minY = void 0;\n\t  var maxX = void 0;\n\t  var maxY = 0;\n\n\t  if (n.children.empty() || !n.hidden) {\n\t    minX = -cell.width / 2 + offset;\n\t    maxX = cell.width / 2 - offset;\n\t    minY = -cell.width / 2 + offset;\n\t    maxY = cell.width / 2 - offset;\n\t  } else {\n\t    minX = d3.min(n.children.values(), function (d) {\n\t      return d.x - cell.width / 2 + offset;\n\t    });\n\t    maxX = d3.max(n.children.values(), function (d) {\n\t      return d.x + cell.width / 2 - offset;\n\t    });\n\t    minY = d3.min(n.children.values(), function (d) {\n\t      return d.y - cell.height / 2 + offset;\n\t    });\n\t    maxY = d3.max(n.children.values(), function (d) {\n\t      return d.y + cell.height / 2 - offset;\n\t    });\n\t  }\n\n\t  return {\n\t    x: {\n\t      min: minX,\n\t      max: maxX\n\t    },\n\t    y: {\n\t      min: minY,\n\t      max: maxY\n\t    }\n\t  };\n\t}\n\n\t/**\n\t * Dagre layout including layer nodes.\n\t * @param graph The provenance graph.\n\t */\n\tfunction dagreLayerLayout(graph, cell, updateNodeAndLink) {\n\t  var g = new dagre.graphlib.Graph();\n\n\t  g.setGraph({\n\t    rankdir: 'LR',\n\t    nodesep: 0,\n\t    edgesep: 0,\n\t    ranksep: 0,\n\t    marginx: 0,\n\t    marginy: 0\n\t  });\n\n\t  g.setDefaultEdgeLabel({});\n\n\t  var curWidth = 0;\n\t  var curHeight = 0;\n\n\t  graph.lNodes.values().forEach(function (ln) {\n\t    curWidth = cell.width;\n\t    curHeight = cell.height;\n\n\t    g.setNode(ln.autoId, {\n\t      label: ln.autoId,\n\t      width: curWidth,\n\t      height: curHeight\n\t    });\n\t  });\n\n\t  graph.lLinks.values().forEach(function (l) {\n\t    g.setEdge(l.source.autoId, l.target.autoId, {\n\t      minlen: 1,\n\t      weight: 1,\n\t      width: 0,\n\t      height: 0,\n\t      labelpos: 'r',\n\t      labeloffset: 0\n\t    });\n\t  });\n\n\t  dagre.layout(g);\n\n\t  var dlLNodes = d3.entries(g._nodes);\n\t  graph.lNodes.values().forEach(function (ln) {\n\t    curWidth = cell.width;\n\t    curHeight = cell.height;\n\n\t    ln.x = dlLNodes.filter(function (d) {\n\t      return d.key === ln.autoId.toString();\n\t    })[0].value.x - curWidth / 2;\n\n\t    ln.y = dlLNodes.filter(function (d) {\n\t      return d.key === ln.autoId.toString();\n\t    })[0].value.y - curHeight / 2;\n\n\t    updateNodeAndLink(ln, d3.select('#gNodeId-' + ln.autoId));\n\t  });\n\t}\n\n\t/**\n\t * Sets the drag events for nodes.\n\t * @param nodeType The dom nodeset to allow dragging.\n\t */\n\tfunction applyDragBehavior(domDragSet, dragStart, dragging, dragEnd) {\n\t  /* Drag and drop node enabled. */\n\t  var drag = d3.behavior.drag().origin(function (d) {\n\t    return d;\n\t  }).on('dragstart', dragStart).on('drag', dragging).on('dragend', dragEnd);\n\n\t  /* Invoke dragging behavior on nodes. */\n\t  domDragSet.call(drag);\n\t}\n\n\t/**\n\t * Path generator for straight link.\n\t * @param l Link.\n\t * @param srcX Source x coordinate.\n\t * @param srcY Source y coordinate.\n\t * @param tarX Target x coordinate.\n\t * @param tarY Target y coordinate.\n\t * @returns {*} Path for link.\n\t */\n\tfunction drawStraightLink(l, srcX, srcY, tarX, tarY) {\n\t  var pathSegment = ' M' + srcX + ',' + srcY;\n\t  pathSegment = pathSegment.concat(' L' + tarX + ',' + tarY);\n\t  return pathSegment;\n\t}\n\n\t/**\n\t * Drag start listener support for nodes.\n\t */\n\tfunction dragStart() {\n\t  d3.event.sourceEvent.stopPropagation();\n\t}\n\n\t/**\n\t * Module for render.\n\t */\n\tvar vis$1 = Object.create(null);\n\tvar cell = Object.create(null);\n\n\t/* Initialize dom elements. */\n\tvar lNode = Object.create(null);\n\tvar aNode = Object.create(null);\n\tvar saNode = Object.create(null);\n\tvar node = Object.create(null);\n\tvar domNodeset = [];\n\tvar link = Object.create(null);\n\tvar aLink = Object.create(null);\n\tvar saLink = Object.create(null);\n\tvar analysis = Object.create(null);\n\tvar subanalysis = Object.create(null);\n\tvar layer = Object.create(null);\n\tvar hLink = Object.create(null);\n\tvar lLink = Object.create(null);\n\tvar saBBox = Object.create(null);\n\tvar aBBox = Object.create(null);\n\tvar lBBox = Object.create(null);\n\n\tvar timeColorScale = Object.create(null);\n\tvar filterAction = Object.create(null);\n\tvar filterMethod = 'timeline';\n\tvar timeLineGradientScale = Object.create(null);\n\n\tvar lastSolrResponse = Object.create(null);\n\n\tvar selectedNodeSet = d3.map();\n\n\tvar draggingActive = false;\n\n\tvar nodeLinkTransitionTime = 1000;\n\n\tvar aNodesBAK = [];\n\tvar saNodesBAK = [];\n\tvar nodesBAK = [];\n\tvar aLinksBAK = [];\n\tvar lLinksBAK = d3.map();\n\tvar lNodesBAK = d3.map();\n\n\tvar scaleFactor = 0.75;\n\n\tvar layoutCols = d3.map();\n\n\tvar linkStyle = 'bezier1';\n\n\tvar colorStrokes = '#136382';\n\tvar colorHighlight = '#ed7407';\n\n\tvar fitToWindow = true;\n\n\tvar doiDiffScale = Object.create(null);\n\n\tvar doiAutoUpdate = false;\n\n\t/**\n\t * Update filtered links.\n\t */\n\tfunction updateLinkFilter() {\n\t  saLink.classed('filteredLink', false);\n\n\t  saNode.each(function (san) {\n\t    if (!san.filtered) {\n\t      san.links.values().forEach(function (l) {\n\t        d3.selectAll('#linkId-' + l.autoId + ', #hLinkId-' + l.autoId).classed('filteredLink', false);\n\t        if (filterAction === 'blend') {\n\t          d3.selectAll('#linkId-' + l.autoId + ', #hLinkId-' + l.autoId).classed('blendedLink', true);\n\t        } else {\n\t          d3.selectAll('#linkId-' + l.autoId + ', #hLinkId-' + l.autoId).classed('blendedLink', false);\n\t        }\n\t      });\n\t    } else {\n\t      san.links.values().forEach(function (l) {\n\t        d3.selectAll('#linkId-' + l.autoId + ', #hLinkId-' + l.autoId).classed({\n\t          filteredLink: true,\n\t          blendedLink: false\n\t        });\n\t      });\n\t    }\n\t  });\n\t}\n\n\t/**\n\t * Update node coordinates through translation.\n\t * @param dom Node dom element.\n\t * @param n Node object element.\n\t * @param x The current x-coordinate for the node.\n\t * @param y The current y-coordinate for the node.\n\t */\n\tfunction updateNode(dom, n, x, y) {\n\t  /* Set selected node coordinates. */\n\t  dom.transition().duration(draggingActive ? 0 : nodeLinkTransitionTime).attr('transform', 'translate(' + x + ',' + y + ')');\n\t}\n\n\t/* TODO: On facet filter reset button, reset filter as well. */\n\t/**\n\t * Update filtered nodes.\n\t */\n\tfunction updateNodeFilter() {\n\t  var _this = this;\n\n\t  /* Hide or blend (un)selected nodes. */\n\n\t  /* Layers. */\n\t  layer.each(function (ln) {\n\t    var self = d3.select(_this).select('#nodeId-' + ln.autoId);\n\t    if (!ln.filtered) {\n\t      /* Blend/Hide layer node. */\n\t      self.classed('filteredNode', false).classed('blendedNode', filterAction === 'blend');\n\t      d3.select('#BBoxId-' + ln.autoId).classed('hiddenBBox', true);\n\t    } else {\n\t      self.classed('filteredNode', true).classed('blendedNode', false);\n\t      if (!ln.hidden) {\n\t        d3.select('#BBoxId-' + ln.autoId).classed('hiddenBBox', false);\n\t      }\n\t    }\n\t  });\n\n\t  /* Analyses and child nodes. */\n\t  analysis.each(function (an) {\n\t    var self = d3.select(_this).select('#nodeId-' + an.autoId);\n\t    if (!an.filtered) {\n\t      /* Blend/Hide analysis. */\n\t      self.classed('filteredNode', false).classed('blendedNode', filterAction === 'blend');\n\t      d3.select('#BBoxId-' + an.autoId).classed('hiddenBBox', true);\n\n\t      /* Update child nodes. */\n\t      an.children.values().forEach(function (san) {\n\t        d3.select('#nodeId-' + san.autoId).classed('filteredNode', false).classed('blendedNode', filterAction === 'blend');\n\n\t        san.children.values().forEach(function (n) {\n\t          d3.select('#nodeId-' + n.autoId).classed('filteredNode', false).classed('blendedNode', filterAction === 'blend');\n\t        });\n\t      });\n\t    } else {\n\t      /* Update child nodes. */\n\t      an.children.values().forEach(function (san) {\n\t        d3.select('#nodeId-' + san.autoId).classed('filteredNode', true).classed('blendedNode', false);\n\t        san.children.values().forEach(function (n) {\n\t          if (n.filtered) {\n\t            d3.select('#nodeId-' + n.autoId).classed('filteredNode', true).classed('blendedNode', false);\n\t          } else {\n\t            d3.select('#nodeId-' + n.autoId).classed('filteredNode', false).classed('blendedNode', false);\n\t          }\n\t        });\n\n\t        if (an.children.values().some(function (sann) {\n\t          return !sann.hidden;\n\t        }) || an.children.values().some(function (sann) {\n\t          return sann.children.values().some(function (n) {\n\t            return !n.hidden;\n\t          });\n\t        })) {\n\t          d3.select('#BBoxId-' + an.autoId).classed('hiddenBBox', false);\n\t        }\n\t      });\n\n\t      if (!an.hidden) {\n\t        d3.select('#BBoxId-' + an.autoId).classed('hiddenBBox', false);\n\t      }\n\n\t      /* Display analysis. */\n\t      self.classed('filteredNode', true).classed('blendedNode', false);\n\t    }\n\t  });\n\t}\n\n\t/**\n\t * Update link through translation while dragging or on dragend.\n\t * @param n Node object element.\n\t */\n\tfunction updateLink(n) {\n\t  var predLinks = d3.map();\n\t  var succLinks = d3.map();\n\n\t  /* Get layer and/or analysis links. */\n\t  switch (n.nodeType) {\n\t    case 'layer':\n\t      n.predLinks.values().forEach(function (pl) {\n\t        predLinks.set(pl.autoId, pl);\n\t      });\n\t      n.succLinks.values().forEach(function (sl) {\n\t        succLinks.set(sl.autoId, sl);\n\t      });\n\t      n.children.values().forEach(function (an) {\n\t        an.predLinks.values().forEach(function (pl) {\n\t          predLinks.set(pl.autoId, pl);\n\t        });\n\t        an.succLinks.values().forEach(function (sl) {\n\t          succLinks.set(sl.autoId, sl);\n\t        });\n\t      });\n\t      break;\n\t    case 'analysis':\n\t      n.predLinks.values().forEach(function (pl) {\n\t        predLinks.set(pl.autoId, pl);\n\t      });\n\t      n.succLinks.values().forEach(function (sl) {\n\t        succLinks.set(sl.autoId, sl);\n\t      });\n\t      break;\n\t  }\n\n\t  /* Get input links and update coordinates for x2 and y2. */\n\t  predLinks.values().forEach(function (l) {\n\t    d3.selectAll('#linkId-' + l.autoId + ', #hLinkId-' + l.autoId).classed('link-transition', true).transition().duration(draggingActive ? 0 : nodeLinkTransitionTime).attr('d', function (ll) {\n\t      var srcCoords = getVisibleNodeCoords(ll.source);\n\t      var tarCoords = getVisibleNodeCoords(ll.target);\n\n\t      if (linkStyle === 'bezier1') {\n\t        return drawBezierLink(ll, srcCoords.x, srcCoords.y, tarCoords.x, tarCoords.y);\n\t      }\n\t      return drawStraightLink(ll, srcCoords.x, srcCoords.y, tarCoords.x, tarCoords.y);\n\t    });\n\n\t    setTimeout(function () {\n\t      d3.selectAll('#linkId-' + l.autoId + ', #hLinkId-' + l.autoId).classed('link-transition', false);\n\t    }, nodeLinkTransitionTime);\n\t  });\n\n\t  /* Get output links and update coordinates for x1 and y1. */\n\t  succLinks.values().forEach(function (l) {\n\t    d3.selectAll('#linkId-' + l.autoId + ', #hLinkId-' + l.autoId).classed('link-transition', true).transition().duration(draggingActive ? 0 : nodeLinkTransitionTime).attr('d', function (ll) {\n\t      var tarCoords = getVisibleNodeCoords(ll.target);\n\t      var srcCoords = getVisibleNodeCoords(ll.source);\n\n\t      if (linkStyle === 'bezier1') {\n\t        return drawBezierLink(ll, srcCoords.x, srcCoords.y, tarCoords.x, tarCoords.y);\n\t      }\n\t      return drawStraightLink(ll, srcCoords.x, srcCoords.y, tarCoords.x, tarCoords.y);\n\t    });\n\n\t    setTimeout(function () {\n\t      d3.selectAll('#linkId-' + l.autoId + ', #hLinkId-' + l.autoId).classed('link-transition', false);\n\t    }, nodeLinkTransitionTime);\n\t  });\n\t}\n\n\t/* TODO: Code cleanup. */\n\t/* TODO: Add transitions to bounding boxes. */\n\t/**\n\t * Sets the visibility of links and (a)nodes when collapsing or expanding\n\t * analyses.\n\t * @param d Node.\n\t * @param keyStroke Keystroke being pressed at mouse click.\n\t * @param trigger Function triggered by user interaction or automatic\n\t * doi-function.\n\t */\n\tfunction handleCollapseExpandNode(d, keyStroke, _trigger_) {\n\t  var trigger = typeof _trigger_ !== 'undefined' ? _trigger_ : 'user';\n\n\t  var anBBoxCoords = Object.create(null);\n\t  var wfBBoxCoords = Object.create(null);\n\t  var siblings = [];\n\n\t  /* Expand. */\n\t  if (keyStroke === 'e' && (d.nodeType === 'layer' || d.nodeType === 'analysis' || d.nodeType === 'subanalysis')) {\n\t    /* Set node visibility. */\n\t    d3.select('#nodeId-' + d.autoId).classed('hiddenNode', true);\n\t    d.hidden = true;\n\t    d.children.values().forEach(function (cn) {\n\t      d3.select('#nodeId-' + cn.autoId).classed('hiddenNode', false);\n\t      cn.hidden = false;\n\t      hideChildNodes(cn);\n\t    });\n\n\t    /* Set link visibility. */\n\t    if (d.nodeType === 'subanalysis') {\n\t      d.links.values().forEach(function (l) {\n\t        l.hidden = false;\n\t        d3.select('#linkId-' + l.autoId).classed('hiddenLink', false);\n\t        if (l.highlighted) {\n\t          d3.select('#hLinkId-' + l.autoId).classed('hiddenLink', false);\n\t        }\n\t      });\n\t    } else if (d.nodeType === 'analysis') {\n\t      d.children.values().forEach(function (san) {\n\t        san.links.values().forEach(function (l) {\n\t          l.hidden = true;\n\t          d3.select('#linkId-' + l.autoId).classed('hiddenLink', true);\n\t          if (l.highlighted) {\n\t            d3.select('#hLinkId-' + l.autoId).classed('hiddenLink', true);\n\t          }\n\t        });\n\t      });\n\t    } else {\n\t      /* Hide layer links. */\n\t      d.predLinks.values().forEach(function (pl) {\n\t        pl.hidden = true;\n\t        d3.select('#linkId-' + pl.autoId).classed('hiddenLink', true);\n\t        if (pl.highlighted) {\n\t          d3.select('#hLinkId-' + pl.autoId).classed('hiddenLink', true);\n\t        }\n\t      });\n\t      d.succLinks.values().forEach(function (sl) {\n\t        sl.hidden = true;\n\t        d3.select('#linkId-' + sl.autoId).classed('hiddenLink', true);\n\t        if (sl.highlighted) {\n\t          d3.select('#hLinkId-' + sl.autoId).classed('hiddenLink', true);\n\t        }\n\t      });\n\t    }\n\n\t    /* Set analysis/layer connecting links visibility. */\n\t    d.inputs.values().forEach(function (sain) {\n\t      sain.predLinks.values().forEach(function (l) {\n\t        d3.select('#linkId-' + l.autoId).classed('hiddenLink', false);\n\t        if (l.highlighted) {\n\t          d3.select('#hLinkId-' + l.autoId).classed('hiddenLink', false);\n\t        }\n\t        l.hidden = false;\n\t      });\n\t    });\n\t    d.outputs.values().forEach(function (saon) {\n\t      saon.succLinks.values().forEach(function (l) {\n\t        d3.select('#linkId-' + l.autoId).classed('hiddenLink', false);\n\t        if (l.highlighted) {\n\t          d3.select('#hLinkId-' + l.autoId).classed('hiddenLink', false);\n\t        }\n\t        l.hidden = false;\n\t      });\n\t    });\n\n\t    if (d.nodeType === 'subanalysis') {\n\t      /* Set saBBox visibility. */\n\t      d3.select('#BBoxId-' + d.autoId).classed('hiddenBBox', false);\n\n\t      /* Update. */\n\t      wfBBoxCoords = getWFBBoxCoords(d, cell, 0);\n\t      d.x = 0;\n\t      updateLink(d.parent);\n\t      updateNode(d3.select('#gNodeId-' + d.autoId), d, d.x, d.y);\n\n\t      /* Shift sibling subanalyses vertical. */\n\t      siblings = d.parent.children.values().filter(function (san) {\n\t        return san !== d && san.y > d.y;\n\t      });\n\t      siblings.forEach(function (san) {\n\t        san.y += wfBBoxCoords.y.max - wfBBoxCoords.y.min - cell.height;\n\t        updateNode(d3.select('#gNodeId-' + san.autoId), san, san.x, san.y);\n\t      });\n\n\t      /* Adjust analysis bounding box. */\n\t      anBBoxCoords = getABBoxCoords(d.parent, cell, 0);\n\t      d3.selectAll('#BBoxId-' + d.parent.autoId + ', #aBBClipId-' + d.parent.autoId).selectAll('rect').attr('width', anBBoxCoords.x.max - anBBoxCoords.x.min).attr('height', anBBoxCoords.y.max - anBBoxCoords.y.min);\n\n\t      /* Center non-expanded subanalyses horizontally. */\n\t      d.parent.children.values().filter(function (san) {\n\t        return !san.hidden;\n\t      }).forEach(function (san) {\n\t        san.x = (anBBoxCoords.x.max - anBBoxCoords.x.min) / 2 - vis$1.cell.width / 2;\n\t        updateNode(d3.select('#gNodeId-' + san.autoId), san, san.x, san.y);\n\t      });\n\t      updateNode(d3.select('#gNodeId-' + d.autoId), d, d.x, d.y);\n\t    } else if (d.nodeType === 'analysis') {\n\t      /* Adjust analysis bounding box. */\n\t      anBBoxCoords = getABBoxCoords(d, cell, 0);\n\t      d3.select('#BBoxId-' + d.autoId).select('rect').attr('width', anBBoxCoords.x.max - anBBoxCoords.x.min).attr('height', anBBoxCoords.y.max - anBBoxCoords.y.min);\n\n\t      /* Update. */\n\t      updateLink(d);\n\t      updateNode(d3.select('#gNodeId-' + d.autoId), d, d.x, d.y);\n\t    } else {\n\t      d.children.values().filter(function (an) {\n\t        return an.filtered;\n\t      }).forEach(function (an) {\n\t        d3.select('#BBoxId-' + an.autoId).classed('hiddenBBox', false);\n\n\t        /* Hide workflow links. */\n\t        an.links.values().forEach(function (l) {\n\t          d3.selectAll('#linkId-' + l.autoId + ',#hLinkId-' + l.autoId).classed('hiddenLink', true);\n\t        });\n\n\t        /* Hide workflow bounding box. */\n\t        an.children.values().forEach(function (san) {\n\t          d3.select('#BBoxId-' + san.autoId).classed('hiddenBBox', true);\n\t        });\n\n\t        /* Adjust bounding box. */\n\t        anBBoxCoords = getABBoxCoords(an, cell, 0);\n\t        d3.selectAll('#BBoxId-' + an.autoId + ', #aBBClipId-' + an.autoId).select('rect').attr('width', cell.width).attr('height', cell.height);\n\t      });\n\n\t      /* Update. */\n\t      updateLink(d);\n\t      updateNode(d3.select('#gNodeId-' + d.autoId), d, d.x, d.y);\n\t    }\n\t  } else if (keyStroke === 'c' && d.nodeType !== 'layer') {\n\t    /* Collapse. */\n\t    /* Collapse subanalyses. */\n\t    if (d.nodeType === 'subanalysis') {\n\t      d.parent.children.values().forEach(function (san) {\n\t        d3.select('#BBoxId-' + san.autoId).classed('hiddenBBox', true);\n\t      });\n\t    } else if (d.nodeType === 'analysis') {\n\t      d.parent.children.values().forEach(function (an) {\n\t        d3.select('#BBoxId-' + an.autoId).classed('hiddenBBox', true);\n\t        an.exaggerated = false;\n\t      });\n\n\t      /* Set layer label and bounding box. */\n\t      d3.select('#nodeId-' + d.parent.autoId).select('g.labels').select('.lLabel').text(d.children.size() + '/' + d.children.size());\n\n\t      /* Hide bounding boxes. */\n\t      d3.select('#BBoxId-' + d.parent.autoId).classed('hiddenBBox', false);\n\t      d.parent.children.values().forEach(function (an) {\n\t        an.children.values().forEach(function (san) {\n\t          d3.select('#BBoxId-' + san.autoId).classed('hiddenBBox', true);\n\t        });\n\t      });\n\t    } else {\n\t      /* Collapse workflow. */\n\t      if (d.hidden === false) {\n\t        /* Shift sibling subanalyses vertical. */\n\t        wfBBoxCoords = getWFBBoxCoords(d.parent, cell, 0);\n\t        siblings = d.parent.parent.children.values().filter(function (san) {\n\t          return san !== d.parent && san.y > d.parent.y;\n\t        });\n\t        siblings.forEach(function (san) {\n\t          san.y -= wfBBoxCoords.y.max - wfBBoxCoords.y.min - cell.height;\n\t          updateNode(d3.select('#gNodeId-' + san.autoId), san, san.x, san.y);\n\t        });\n\n\t        if (d.parent.parent.children.values().filter(function (san) {\n\t          return san !== d.parent;\n\t        }).some(function (san) {\n\t          return san.hidden;\n\t        })) {\n\t          anBBoxCoords = getABBoxCoords(d.parent.parent, cell, 0);\n\t          d.parent.x = (anBBoxCoords.x.max - anBBoxCoords.x.min) / 2 - vis$1.cell.width / 2;\n\t          updateNode(d3.select('#gNodeId-' + d.parent.autoId), d.parent, d.parent.x, d.parent.y);\n\t        }\n\n\t        if (d.parent.parent.children.values().filter(function (san) {\n\t          return san !== d.parent;\n\t        }).every(function (san) {\n\t          return !san.hidden;\n\t        })) {\n\t          d.parent.parent.children.values().forEach(function (san) {\n\t            san.x = 0;\n\t            updateNode(d3.select('#gNodeId-' + san.autoId), san, san.x, san.y);\n\t          });\n\t        }\n\t      }\n\t    }\n\n\t    /* Set node visibility. */\n\t    d.parent.hidden = false;\n\t    d3.select('#nodeId-' + d.parent.autoId).classed('hiddenNode', false);\n\t    hideChildNodes(d.parent);\n\n\t    /* Set saBBox visibility. */\n\t    if (d.nodeType === 'subanalysis') {\n\t      d3.select('#BBoxId-' + d.autoId).classed('hiddenBBox', true);\n\t    } else if (d.nodeType === 'analysis') {\n\t      if (!d.parent.filtered) {\n\t        d3.select('#BBoxId-' + d.parent.autoId).classed('hiddenBBox', true);\n\t      }\n\t    } else {\n\t      d3.select('#BBoxId-' + d.parent.autoId).classed('hiddenBBox', true);\n\t    }\n\n\t    /* Set link visibility. */\n\t    d.parent.links.values().forEach(function (l) {\n\t      d3.selectAll('#linkId-' + l.autoId + ', #hLinkId-' + l.autoId).classed('hiddenLink', true);\n\t      l.hidden = true;\n\t    });\n\t    d.parent.inputs.values().forEach(function (sain) {\n\t      sain.predLinks.values().forEach(function (l) {\n\t        d3.select('#linkId-' + l.autoId).classed('hiddenLink', false);\n\t        if (l.highlighted) {\n\t          d3.select('#hLinkId-' + l.autoId).classed('hiddenLink', false);\n\t        }\n\t        l.hidden = false;\n\t      });\n\t    });\n\t    d.parent.outputs.values().forEach(function (saon) {\n\t      saon.succLinks.values().forEach(function (l) {\n\t        d3.select('#linkId-' + l.autoId).classed('hiddenLink', false);\n\t        if (l.highlighted) {\n\t          d3.select('#hLinkId-' + l.autoId).classed('hiddenLink', false);\n\t        }\n\t        l.hidden = false;\n\t      });\n\t    });\n\n\t    if (d.nodeType === 'subanalysis') {\n\t      /* Resize analysis bounding box. */\n\t      d3.selectAll('#BBoxId-' + d.parent.autoId + ', #aBBClipId-' + d.parent.autoId).selectAll('rect').attr('width', cell.width).attr('height', cell.height);\n\n\t      /* Update links. */\n\t      updateLink(d.parent);\n\t    } else if (d.nodeType === 'analysis') {\n\t      /* Check layer Links. */\n\t      d.parent.predLinks.values().forEach(function (pl) {\n\t        if (!pl.source.hidden) {\n\t          pl.hidden = false;\n\t        }\n\t      });\n\t      d.parent.succLinks.values().forEach(function (sl) {\n\t        if (!sl.target.hidden) {\n\t          sl.hidden = false;\n\t        }\n\t      });\n\n\t      updateLink(d.parent);\n\t      updateNode(d3.select('#gNodeId-' + d.parent.autoId), d.parent, d.parent.x, d.parent.y);\n\t    } else {\n\t      /* Set saBBox visibility. */\n\t      d3.select('#BBoxId-' + d.parent.autoId).classed('hiddenBBox', true);\n\n\t      /* Update. */\n\t      updateLink(d.parent.parent);\n\t      updateNode(d3.select('#gNodeId-' + d.parent.parent.autoId), d.parent.parent, d.parent.parent.x, d.parent.parent.y);\n\n\t      /* Compute bounding box for analysis child nodes. */\n\t      anBBoxCoords = getABBoxCoords(d.parent.parent, cell, 0);\n\n\t      /* Adjust analysis bounding box. */\n\t      d3.selectAll('#BBoxId-' + d.parent.parent.autoId + ', #aBBClipId-' + d.parent.parent.autoId).selectAll('rect').attr('width', anBBoxCoords.x.max - anBBoxCoords.x.min).attr('height', anBBoxCoords.y.max - anBBoxCoords.y.min);\n\n\t      /* If the selected subanalysis is the last remaining to collapse,\n\t       adjust bounding box and clippath. */\n\t      if (!d.parent.parent.children.values().some(function (san) {\n\t        return san.hidden;\n\t      })) {\n\t        /* Compute bounding box for analysis child nodes. */\n\t        anBBoxCoords = getABBoxCoords(d.parent.parent, cell, 0);\n\n\t        /* Adjust analysis bounding box. */\n\t        d3.select('#BBoxId-' + d.parent.parent.autoId).select('rect').attr('width', anBBoxCoords.x.max - anBBoxCoords.x.min).attr('height', anBBoxCoords.y.max - anBBoxCoords.y.min);\n\n\t        /* Adjust clippath. */\n\t        d3.select('#aBBClipId-' + d.parent.parent.autoId).select('rect').attr('width', cell.width).attr('height', cell.height + 2 * scaleFactor * vis$1.radius).attr('rx', cell.width / 7).attr('ry', cell.height / 7);\n\t      }\n\t      /* Update links. */\n\t      updateLink(d.parent.parent);\n\t    }\n\t  }\n\n\t  if (trigger === 'user') {\n\t    /* Recompute layout. */\n\t    dagreDynamicLayerLayout(vis$1.graph);\n\n\t    if (fitToWindow) {\n\t      fitGraphToWindow(nodeLinkTransitionTime);\n\t    }\n\t  }\n\t}\n\n\t/* TODO: Code cleanup. */\n\t/**\n\t * On doi change, update node doi labels.\n\t */\n\tfunction updateNodeDoi() {\n\t  /**\n\t   * Helper function to check whether every parent node is hidden.\n\t   * @param n BaseNode\n\t   * @returns {boolean} Returns true if any parent node is visible.\n\t   */\n\t  function allParentsHidden(n) {\n\t    var cur = n;\n\n\t    while (!(cur instanceof Layer)) {\n\t      if (!(cur instanceof Layer) && !cur.parent.hidden) {\n\t        return false;\n\t      }\n\t      cur = cur.parent;\n\t    }\n\n\t    return true;\n\t  }\n\n\t  /* Update node doi label. */\n\t  domNodeset.select('.nodeDoiLabel').text(function (d) {\n\t    return d.doi.doiWeightedSum;\n\t  });\n\n\t  /* On layer doi. */\n\t  vis$1.graph.lNodes.values().forEach(function (ln) {\n\t    if (ln.doi.doiWeightedSum >= 1 / 4 && !ln.hidden && ln.filtered) {\n\t      /* Expand. */\n\t      handleCollapseExpandNode(ln, 'e', 'auto');\n\t    }\n\t  });\n\n\t  /* On analysis doi. */\n\t  vis$1.graph.aNodes.forEach(function (an) {\n\t    if (an.doi.doiWeightedSum >= 2 / 4 && !an.hidden && an.filtered) {\n\t      /* Expand. */\n\t      handleCollapseExpandNode(an, 'e', 'auto');\n\t    } else if (an.doi.doiWeightedSum < 1 / 4 && !an.hidden && an.parent.children.size() > 1) {\n\t      /* Collapse. */\n\t      handleCollapseExpandNode(an, 'c', 'auto');\n\n\t      if (an.parent.filtered) {\n\t        /* Only collapse those analysis nodes into the layered node which\n\t         * are below the threshold. */\n\t        an.parent.children.values().forEach(function (d) {\n\t          if (d.doi.doiWeightedSum >= 1 / 4) {\n\t            d.exaggerated = true;\n\n\t            d.hidden = false;\n\t            d3.select('#nodeId-' + d.autoId).classed('hiddenNode', false);\n\t            updateLink(d);\n\n\t            if (d.doi.doiWeightedSum >= 2 / 4 && !d.hidden && d.filtered) {\n\t              /* Expand. */\n\t              handleCollapseExpandNode(d, 'e', 'auto');\n\t            }\n\t          } else {\n\t            d.exaggerated = false;\n\t            d.hidden = true;\n\t            d3.select('#nodeId-' + an.autoId).classed('hiddenNode', true);\n\t          }\n\t        });\n\t      }\n\t    }\n\t  });\n\n\t  /* On node doi. */\n\t  vis$1.graph.saNodes.forEach(function (san) {\n\t    var maxDoi = d3.max(san.children.values(), function (n) {\n\t      return n.doi.doiWeightedSum;\n\t    });\n\t    if (maxDoi < 3 / 4 && (allParentsHidden(san.children.values()[0]) || san.parent.exaggerated)) {\n\t      /* Collapse. */\n\t      handleCollapseExpandNode(san.children.values()[0], 'c', 'auto');\n\t    }\n\t  });\n\n\t  /* On subanalysis doi. */\n\t  vis$1.graph.saNodes.forEach(function (san) {\n\t    var maxDoi = d3.max(san.parent.children.values(), function (cn) {\n\t      return cn.doi.doiWeightedSum;\n\t    });\n\n\t    if (san.doi.doiWeightedSum >= 3 / 4 && !san.hidden && san.filtered) {\n\t      /* Expand. */\n\t      handleCollapseExpandNode(san, 'e', 'auto');\n\t    } else if (maxDoi < 2 / 4 && (allParentsHidden(san) || san.parent.exaggerated)) {\n\t      /* Collapse. */\n\t      handleCollapseExpandNode(san, 'c', 'auto');\n\t    }\n\t  });\n\n\t  /* Recompute layout. */\n\t  dagreDynamicLayerLayout(vis$1.graph);\n\n\t  if (fitToWindow) {\n\t    fitGraphToWindow(nodeLinkTransitionTime);\n\t  }\n\t}\n\n\t/**\n\t * Path generator for bezier link.\n\t * @param l Link.\n\t * @param srcX Source x coordinate.\n\t * @param srcY Source y coordinate.\n\t * @param tarX Target x coordinate.\n\t * @param tarY Target y coordinate.\n\t * @returns {*} Path for link.\n\t */\n\tfunction drawBezierLink(l, srcX, srcY, tarX, tarY) {\n\t  var pathSegment = 'M' + srcX + ',' + srcY;\n\n\t  if (tarX - srcX > vis$1.cell.width * 1.5) {\n\t    (function () {\n\t      /* Extend links in expanded columns. */\n\t      var curN = l.source;\n\t      var hLineSrc = srcX;\n\n\t      if (l.source instanceof Layer || l.target instanceof Layer || l.source.parent !== l.target.parent) {\n\t        while (!(curN instanceof Analysis) && !(curN instanceof Layer)) {\n\t          curN = curN.parent;\n\t        }\n\n\t        if (curN instanceof Analysis && !curN.parent.hidden && l.source.hidden) {\n\t          curN = curN.parent;\n\t        }\n\n\t        /* TODO: Revise. */\n\t        if (l.source instanceof Layer && l.source.hidden) {\n\t          hLineSrc = srcX + vis$1.cell.width / 2;\n\t        } else {\n\t          hLineSrc = getABBoxCoords(curN, cell, 0).x.max - vis$1.cell.width / 2;\n\t        }\n\n\t        /* LayoutCols provides the maximum width of any potential expanded node\n\t         * within the column of the graph. An the width difference is calculated\n\t         * as offset and added as horizontal line to the link. */\n\t        layoutCols.values().forEach(function (c) {\n\t          if (c.nodes.indexOf(curN.autoId) !== -1) {\n\t            var curWidth = getABBoxCoords(curN, cell, 0).x.max - getABBoxCoords(curN, cell, 0).x.min;\n\t            var offset = (c.width - curWidth) / 2 + vis$1.cell.width / 2;\n\t            if (curWidth < c.width) {\n\t              hLineSrc = srcX + offset;\n\t            }\n\t          }\n\t        });\n\n\t        pathSegment = pathSegment.concat(' H' + hLineSrc);\n\t      }\n\n\t      pathSegment = pathSegment.concat(' C' + (hLineSrc + cell.width / 3) + ',' + srcY + ' ' + (hLineSrc + cell.width / 2 - cell.width / 3) + ',' + tarY + ' ' + (hLineSrc + cell.width / 2) + ',' + tarY + ' ' + 'H' + tarX);\n\t    })();\n\t  } else {\n\t    pathSegment = pathSegment.concat(' C' + (srcX + cell.width) + ',' + srcY + ' ' + (tarX - cell.width) + ',' + tarY + ' ' + tarX + ',' + tarY + ' ');\n\t  }\n\n\t  return pathSegment;\n\t}\n\n\t/**\n\t * Drag listener.\n\t * @param n Node object.\n\t */\n\tfunction dragging(n) {\n\t  var self = d3.select(this);\n\n\t  /* While dragging, hide tooltips. */\n\t  hideTooltip(tooltip);\n\n\t  var deltaY = d3.event.y - n.y;\n\n\t  /* Set coords. */\n\t  n.x = d3.event.x;\n\t  n.y = d3.event.y;\n\n\t  /* Drag selected node. */\n\t  updateNode(self, n, d3.event.x, d3.event.y);\n\n\t  /* Drag adjacent links. */\n\t  updateLink(n);\n\n\t  if (n instanceof Layer) {\n\t    n.children.values().forEach(function (an) {\n\t      an.x = n.x - (getABBoxCoords(an, cell, 0).x.max - getABBoxCoords(an, cell, 0).x.min) / 2 + vis$1.cell.width / 2;\n\t      an.y += deltaY;\n\t      updateNode(d3.select('#gNodeId-' + an.autoId), an, an.x, an.y);\n\t      updateLink(an);\n\t    });\n\t  }\n\n\t  draggingActive = true;\n\t}\n\n\t/**\n\t * Update node and link.\n\t * @param n Node.\n\t * @param dom Node as dom object.\n\t */\n\tfunction updateNodeAndLink(n, dom) {\n\t  var self = dom;\n\n\t  /* Align selected node. */\n\t  updateNode(self, n, n.x, n.y);\n\n\t  /* Align adjacent links. */\n\t  updateLink(n);\n\n\t  if (n instanceof Layer) {\n\t    n.children.values().forEach(function (an) {\n\t      updateNode(d3.select('#gNodeId-' + an.autoId), an, an.x, an.y);\n\t      updateLink(an);\n\t    });\n\t  }\n\t}\n\n\t/**\n\t * Drag end listener.\n\t */\n\tfunction dragEnd(n) {\n\t  if (draggingActive) {\n\t    var self = d3.select(this);\n\n\t    /* Update node and adjacent links. */\n\t    updateNodeAndLink(n, self);\n\n\t    /* Prevent other mouseevents during dragging. */\n\t    setTimeout(function () {\n\t      draggingActive = false;\n\t    }, 200);\n\t  }\n\t}\n\n\t/* TODO: Update to incorporate facet filtering and adjust link visibility\n\t * on loose graphs. */\n\t/**\n\t * Filter analyses by time gradient timeline view.\n\t * @param lowerTimeThreshold The point of time where analyses executed before\n\t * are hidden.\n\t * @param upperTimeThreshold The point of time where analyses executed after\n\t * are hidden.\n\t * @param vis The provenance visualization root object.\n\t */\n\tfunction filterAnalysesByTime(lowerTimeThreshold, upperTimeThreshold, _vis_) {\n\t  _vis_.graph.lNodes = lNodesBAK;\n\t  _vis_.graph.aNodes = aNodesBAK;\n\t  _vis_.graph.saNodes = saNodesBAK;\n\t  _vis_.graph.nodes = nodesBAK;\n\t  _vis_.graph.aLinks = aLinksBAK;\n\t  _vis_.graph.lLinks = lLinksBAK;\n\n\t  var selAnalyses = _vis_.graph.aNodes.filter(function (an) {\n\t    upperTimeThreshold.setSeconds(upperTimeThreshold.getSeconds() + 1);\n\t    return parseISOTimeFormat(an.start) >= lowerTimeThreshold && parseISOTimeFormat(an.start) <= upperTimeThreshold;\n\t  });\n\n\t  /* Set (un)filtered analyses. */\n\t  _vis_.graph.aNodes.forEach(function (an) {\n\t    if (selAnalyses.indexOf(an) === -1) {\n\t      an.filtered = false;\n\t      an.children.values().forEach(function (san) {\n\t        san.filtered = false;\n\t        san.children.values().forEach(function (n) {\n\t          n.filtered = false;\n\t        });\n\t      });\n\t    } else {\n\t      an.filtered = true;\n\t      an.children.values().forEach(function (san) {\n\t        san.filtered = true;\n\t        san.children.values().forEach(function (n) {\n\t          n.filtered = true;\n\t        });\n\t      });\n\t    }\n\t  });\n\n\t  /* Update analysis filter attributes. */\n\t  _vis_.graph.aNodes.forEach(function (an) {\n\t    if (an.children.values().some(function (san) {\n\t      return san.filtered;\n\t    })) {\n\t      an.filtered = true;\n\t    } else {\n\t      an.filtered = false;\n\t    }\n\t    an.doi.filteredChanged();\n\t  });\n\n\t  /* Update layer filter attributes. */\n\t  _vis_.graph.lNodes.values().forEach(function (ln) {\n\t    if (ln.children.values().some(function (an) {\n\t      return an.filtered;\n\t    })) {\n\t      ln.filtered = true;\n\t    } else {\n\t      ln.filtered = false;\n\t    }\n\t    ln.doi.filteredChanged();\n\t  });\n\n\t  /* Update analysis link filter attributes. */\n\t  _vis_.graph.aLinks.forEach(function (al) {\n\t    al.filtered = false;\n\t  });\n\t  _vis_.graph.aLinks.filter(function (al) {\n\t    return al.source.parent.parent.filtered && al.target.parent.parent.filtered;\n\t  }).forEach(function (al) {\n\t    al.filtered = true;\n\t  });\n\t  _vis_.graph.lLinks.values().forEach(function (ll) {\n\t    ll.filtered = false;\n\t  });\n\t  _vis_.graph.lLinks.values().filter(function (ll) {\n\t    return ll.source.filtered && ll.target.filtered;\n\t  }).forEach(function (ll) {\n\t    ll.filtered = true;\n\t  });\n\n\t  /* On filter action 'hide', splice and recompute graph. */\n\t  if (filterAction === 'hide') {\n\t    (function () {\n\t      /* Update filtered nodesets. */\n\t      var cpyLNodes = d3.map();\n\t      _vis_.graph.lNodes.entries().forEach(function (ln) {\n\t        if (ln.value.filtered) {\n\t          cpyLNodes.set(ln.key, ln.value);\n\t        }\n\t      });\n\t      _vis_.graph.lNodes = cpyLNodes;\n\t      _vis_.graph.aNodes = _vis_.graph.aNodes.filter(function (an) {\n\t        return an.filtered;\n\t      });\n\t      _vis_.graph.saNodes = _vis_.graph.saNodes.filter(function (san) {\n\t        return san.filtered;\n\t      });\n\t      _vis_.graph.nodes = _vis_.graph.nodes.filter(function (n) {\n\t        return n.filtered;\n\t      });\n\n\t      /* Update filtered linksets. */\n\t      _vis_.graph.aLinks = _vis_.graph.aLinks.filter(function (al) {\n\t        return al.filtered;\n\t      });\n\n\t      /* Update layer links. */\n\t      var cpyLLinks = d3.map();\n\t      _vis_.graph.lLinks.entries().forEach(function (ll) {\n\t        if (ll.value.filtered) {\n\t          cpyLLinks.set(ll.key, ll.value);\n\t        }\n\t      });\n\t      _vis_.graph.lLinks = cpyLLinks;\n\t    })();\n\t  }\n\n\t  dagreDynamicLayerLayout(_vis_.graph);\n\n\t  if (fitToWindow) {\n\t    fitGraphToWindow(nodeLinkTransitionTime);\n\t  }\n\n\t  updateNodeFilter();\n\t  updateLinkFilter();\n\t  updateAnalysisLinks(_vis_.graph);\n\t  updateLayerLinks(_vis_.graph.lLinks);\n\n\t  _vis_.graph.aNodes.forEach(function (an) {\n\t    updateLink(an);\n\t  });\n\t  _vis_.graph.lNodes.values().forEach(function (ln) {\n\t    updateLink(ln);\n\t  });\n\n\t  /* TODO: Temporarily enabled. */\n\t  if (doiAutoUpdate) {\n\t    recomputeDOI();\n\t  }\n\t}\n\n\t/**\n\t * Draws the timeline view.\n\t * @param vis The provenance visualization root object.\n\t */\n\tfunction drawTimelineView(_vis_) {\n\t  var _this3 = this;\n\n\t  var svg = d3.select('#provenance-timeline-view').select('svg').append('g').append('g').attr('transform', 'translate(20,0)');\n\n\t  var tlHeight = 50;\n\t  var tlWidth = 250;\n\n\t  var x = d3.scale.linear().domain([0, tlWidth]).range([0, tlWidth]);\n\n\t  var y = d3.scale.linear().domain([5, 0]).range([0, tlHeight - 10]);\n\n\t  timeLineGradientScale = d3.time.scale().domain([Date.parse(timeColorScale.domain()[0]), Date.parse(timeColorScale.domain()[1])]).range([0, tlWidth]).nice();\n\n\t  var xAxis = d3.svg.axis().scale(timeLineGradientScale).orient('bottom').ticks(5);\n\n\t  var yAxis = d3.svg.axis().scale(y).orient('left').ticks(7);\n\n\t  var tlTickCoords = d3.map();\n\n\t  aNodesBAK.forEach(function (an) {\n\t    tlTickCoords.set(an.autoId, timeLineGradientScale(parseISOTimeFormat(an.start)));\n\t  });\n\n\t  /**\n\t   * Drag start listener support for time lines.\n\t   */\n\t  function dragLineStart() {\n\t    d3.event.sourceEvent.stopPropagation();\n\t  }\n\n\t  /**\n\t   * Get lower and upper date threshold date in timeline view.\n\t   * @param l Time line.\n\t   * @returns {Array} An array of size 2 containing both the lower and upper\n\t   * threshold date.\n\t   */\n\t  function getTimeLineThresholds(l) {\n\t    var lowerTimeThreshold = Object.create(null);\n\t    var upperTimeThreshold = Object.create(null);\n\n\t    if (l.className === 'startTimeline') {\n\t      lowerTimeThreshold = l.time;\n\t      upperTimeThreshold = d3.select('.endTimeline').data()[0].time;\n\t    } else {\n\t      lowerTimeThreshold = d3.select('.startTimeline').data()[0].time;\n\t      upperTimeThreshold = l.time;\n\t    }\n\n\t    return [lowerTimeThreshold, upperTimeThreshold];\n\t  }\n\n\t  /**\n\t   * Update lower and upper date threshold label in timeline view.\n\t   * @param l Time line.\n\t   */\n\t  function updateTimelineLabels(l) {\n\t    var _this2 = this;\n\n\t    var tlThreshold = getTimeLineThresholds(l);\n\t    tlThreshold[1].setSeconds(tlThreshold[1].getSeconds() + 1);\n\n\t    var labelStart = customTimeFormat(tlThreshold[0]);\n\t    var labelEnd = customTimeFormat(tlThreshold[1]);\n\n\t    d3.select('#tlThresholdStart').html('Start: ' + labelStart);\n\t    d3.select('#tlThresholdEnd').html('End: ' + labelEnd);\n\n\t    d3.selectAll('.tlAnalysis').each(function (an) {\n\t      if (parseISOTimeFormat(an.start) < tlThreshold[0] || parseISOTimeFormat(an.start) > tlThreshold[1]) {\n\t        d3.select(_this2).classed('blendedTLAnalysis', true);\n\t      } else {\n\t        d3.select(_this2).classed('blendedTLAnalysis', false);\n\t      }\n\t    });\n\t  }\n\n\t  /**\n\t   * Drag listener.\n\t   * @param l Time line.\n\t   */\n\t  function draggingLine(l) {\n\t    /* Check borders. */\n\t    if (d3.event.x < 0) {\n\t      l.x = 0;\n\t    } else if (d3.event.x > tlWidth) {\n\t      l.x = tlWidth;\n\t    } else {\n\t      l.x = d3.event.x;\n\t    }\n\t    l.time = new Date(timeLineGradientScale.invert(l.x));\n\n\t    /* Update lines. */\n\t    d3.select(this).attr('transform', 'translate(' + x(l.x) + ',0)');\n\n\t    /* Update labels. */\n\t    updateTimelineLabels(l);\n\n\t    /* TODO: Temporarily disabled live filtering as it does not scale\n\t     * well with big graphs. */\n\n\t    /* On hover filter update. */\n\t    /* if (d3.entries(tlTickCoords).some(function (t) {\n\t      if (l.className === \"startTimeline\") {\n\t      */\n\t    /* Left to right. */\n\t    /*\n\t     if (l.x > l.lastX) {\n\t     if (x(l.x) - x(t.value) > 0 && x(l.x) - x(t.value) <= 1) {\n\t     return true;\n\t     } else {\n\t     return false;\n\t     }\n\t     */\n\t    /* Right to left. */\n\t    /*\n\t     } else {\n\t     if (x(l.x) - x(t.value) >= -1 && x(l.x) - x(t.value) < 0) {\n\t     return true;\n\t     } else {\n\t     return false;\n\t     }\n\t     }\n\t     } else {\n\t     */\n\t    /* Right to left. */\n\t    /*\n\t     if (l.x < l.lastX) {\n\t      */\n\t    /* TODO: Small bug, time scale is off by 30 seconds. */\n\t    /*\n\t     if (x(l.x) - x(t.value) >= -5 && x(l.x) - x(t.value) < 0) {\n\t     return true;\n\t     } else {\n\t     return false;\n\t     }\n\t     */\n\t    /* Left to right. */\n\t    /*\n\t     } else {\n\t     if (x(l.x) - x(t.value) > 0 && x(l.x) - x(t.value) <= 1) {\n\t     return true;\n\t     } else {\n\t     return false;\n\t     }\n\t     }\n\t     }\n\t     })) {\n\t     filterAnalysesByTime(getTimeLineThresholds(l)[0],\n\t     getTimeLineThresholds(l)[1], vis);\n\t     }*/\n\n\t    /* Remember last drag x coord. */\n\t    l.lastX = l.x;\n\t  }\n\n\t  /**\n\t   * Drag end listener.\n\t   * @param l Time line.\n\t   */\n\t  function dragLineEnd(l) {\n\t    l.time = new Date(timeLineGradientScale.invert(l.x));\n\n\t    /* Update labels. */\n\t    updateTimelineLabels(l);\n\n\t    /* Filter action. */\n\t    filterAnalysesByTime(getTimeLineThresholds(l)[0], getTimeLineThresholds(l)[1], _vis_);\n\n\t    filterMethod = 'timeline';\n\t  }\n\n\t  /**\n\t   * Sets the drag events for time lines.\n\t   * @param nodeType The dom lineset to allow dragging.\n\t   */\n\t  function applyTimeLineDragBehavior(domDragSet) {\n\t    /* Drag and drop line enabled. */\n\t    var dragLine = d3.behavior.drag().origin(function (d) {\n\t      return d;\n\t    }).on('dragstart', dragLineStart).on('drag', draggingLine).on('dragend', dragLineEnd);\n\n\t    /* Invoke dragging behavior on nodes. */\n\t    domDragSet.call(dragLine);\n\t  }\n\n\t  /* Geometric zoom. */\n\t  function redrawTimeline() {\n\t    /* Translations. */\n\t    svg.selectAll('.tlAnalysis').attr('x1', function (an) {\n\t      return x(timeLineGradientScale(parseISOTimeFormat(an.start)));\n\t    }).attr('x2', function (an) {\n\t      return x(timeLineGradientScale(parseISOTimeFormat(an.start)));\n\t    });\n\n\t    svg.selectAll('.startTimeline, .endTimeline').attr('transform', function (d) {\n\t      return 'translate(' + x(d.x) + ',' + 0 + ')';\n\t    });\n\n\t    svg.select('#timelineView').attr('x', x(0)).attr('width', x(tlWidth) - x(0));\n\n\t    svg.select('#tlxAxis').attr('transform', 'translate(' + x(0) + ',' + tlHeight + ')');\n\n\t    svg.select('#tlxAxis').selectAll('.tick').attr('transform', function (d) {\n\t      return 'translate(' + (x(timeLineGradientScale(d)) - d3.event.translate[0]) + ',' + 0 + ')';\n\t    });\n\n\t    svg.select('#tlxAxis').select('path').attr('d', 'M0,6V0H' + tlWidth * d3.event.scale + 'V6');\n\n\t    svg.select('#tlyAxis').attr('transform', 'translate(' + x(0) + ',' + 10 + ')');\n\t  }\n\n\t  /* Timeline zoom behavior. */\n\t  var timelineZoom = d3.behavior.zoom().x(x).scaleExtent([1, 10]).on('zoom', redrawTimeline);\n\n\t  timelineZoom(svg);\n\n\t  var gradient = svg.append('defs').append('linearGradient').attr('id', 'gradientGrayscale');\n\n\t  gradient.append('stop').attr('offset', '0%').attr('stop-color', '#fff').attr('stop-opacity', 1);\n\n\t  gradient.append('stop').attr('offset', '100%').attr('stop-color', '#000').attr('stop-opacity', 1);\n\n\t  svg.append('rect').attr('id', 'timelineView').attr('x', 0).attr('y', 10).attr('width', tlWidth).attr('height', tlHeight - 10).style({\n\t    fill: 'url(#gradientGrayscale)',\n\t    stroke: 'white',\n\t    'stroke-width': '1px'\n\t  });\n\n\t  svg.append('g').classed({\n\t    x: true,\n\t    axis: true\n\t  }).attr('id', 'tlxAxis').attr('transform', 'translate(0,' + tlHeight + ')').call(xAxis);\n\n\t  svg.append('g').classed({\n\t    y: true,\n\t    axis: true\n\t  }).attr('id', 'tlyAxis').attr('transform', 'translate(0,' + 10 + ')').call(yAxis);\n\n\t  d3.select('#tlyAxis').selectAll('.tick').each(function (d) {\n\t    if (d === 5) {\n\t      d3.select(_this3).select('text').text('>5');\n\t    }\n\t  });\n\n\t  var startTime = {\n\t    className: 'startTimeline',\n\t    x: 0,\n\t    lastX: -1,\n\t    time: new Date(timeLineGradientScale.invert(0))\n\t  };\n\t  var endTime = {\n\t    className: 'endTimeline',\n\t    x: tlWidth,\n\t    lastX: tlWidth + 1,\n\t    time: new Date(timeLineGradientScale.invert(tlWidth))\n\t  };\n\n\t  var timeLineThreshold = svg.selectAll('.line').data([startTime, endTime]).enter().append('g').attr('transform', function (d) {\n\t    return 'translate(' + d.x + ',0)';\n\t  }).attr('class', function (d) {\n\t    return d.className;\n\t  });\n\n\t  timeLineThreshold.append('line').attr('x1', 0).attr('y1', 0).attr('x2', 0).attr('y2', tlHeight);\n\n\t  timeLineThreshold.append('polygon').classed('timeMarker', true).attr('points', '0,50 5,60 -5,60');\n\t  timeLineThreshold.append('polygon').classed('timeMarker', true).attr('points', '0,10 5,0 -5,0');\n\n\t  svg.selectAll('.line').data(_vis_.graph.aNodes).enter().append('line').attr('id', function (an) {\n\t    return 'tlAnalysisId-' + an.autoId;\n\t  }).classed('tlAnalysis', true).attr('x1', function (an) {\n\t    return timeLineGradientScale(parseISOTimeFormat(an.start));\n\t  }).attr('y1', function (an) {\n\t    return an.children.size() >= 5 ? 10 : parseInt(tlHeight - (tlHeight - 10) / 5 * an.children.size(), 10);\n\t  }).attr('x2', function (an) {\n\t    return timeLineGradientScale(parseISOTimeFormat(an.start));\n\t  }).attr('y2', tlHeight);\n\n\t  d3.selectAll('.startTimeline, .endTimeline').on('mouseover', function () {\n\t    d3.select(_this3).classed('mouseoverTimeline', true);\n\t  });\n\n\t  applyTimeLineDragBehavior(d3.selectAll('.startTimeline, .endTimeline'));\n\n\t  updateTimelineLabels(startTime);\n\t}\n\n\t/**\n\t * Recomputes the DOI for every node\n\t */\n\tfunction recomputeDOI() {\n\t  vis$1.graph.lNodes.values().forEach(function (l) {\n\t    l.doi.computeWeightedSum();\n\t    l.children.values().forEach(function (an) {\n\t      an.doi.computeWeightedSum();\n\t      an.children.values().forEach(function (san) {\n\t        san.doi.computeWeightedSum();\n\t        san.children.values().forEach(function (n) {\n\t          n.doi.computeWeightedSum();\n\t        });\n\t      });\n\t    });\n\t  });\n\t  updateNodeDoi();\n\t}\n\n\t/* TODO: Code cleanup. */\n\t/**\n\t * Draws the DOI view.\n\t */\n\tfunction drawDoiView() {\n\t  var _this4 = this;\n\n\t  var innerSvg = d3.select('#provenance-doi-view').select('svg').select('g').select('g').attr('transform', 'translate(0,0)').select('g');\n\n\t  var doiFactors = d3.values(DoiFactors.factors);\n\t  var doiColorScale = d3.scale.category10();\n\n\t  function updateDoiView(data) {\n\t    var rectOffset = 0;\n\t    var labelOffset = 30;\n\t    var labelsStart = (300 - data.length * labelOffset) / 2;\n\n\t    /* Data join. */\n\t    var dComp = innerSvg.selectAll('g').data(data);\n\n\t    /* Update. */\n\t    var gDCompUpdate = dComp.attr('id', function (d, i) {\n\t      return 'doiCompId-' + i;\n\t    }).classed('doiComp', true);\n\n\t    gDCompUpdate.select('.doiCompRect').classed('doiCompRect', true).attr('x', 0).attr('y', function (d) {\n\t      rectOffset += d.value * 300;\n\t      return rectOffset - d.value * 300;\n\t    }).attr('width', 40).attr('height', function (d) {\n\t      return d.value * 300;\n\t    });\n\n\t    gDCompUpdate.select('.doiCompHandle').classed('doiCompHandle', true).attr('x', 40 + labelOffset).attr('y', function (d, i) {\n\t      return labelsStart + labelOffset * i;\n\t    }).attr('width', labelOffset).attr('height', labelOffset).style('fill', function (d, i) {\n\t      return doiColorScale(10 - i);\n\t    });\n\n\t    rectOffset = 0;\n\n\t    gDCompUpdate.select('.doiCompLine', true).attr('x1', 40).attr('y1', function (d) {\n\t      rectOffset += d.value * 300;\n\t      return rectOffset - d.value * 300 / 2;\n\t    }).attr('x2', 40 + labelOffset).attr('y2', function (d, i) {\n\t      return labelsStart + labelOffset * i + labelOffset / 2;\n\t    }).style({\n\t      stroke: function stroke(d, i) {\n\t        return doiColorScale(10 - i);\n\t      },\n\t      'stroke-opacity': 0.7,\n\t      'stroke-width': '2px'\n\t    });\n\n\t    /* Enter. */\n\t    var gDCompEnter = dComp.enter().append('g').attr('id', function (d, i) {\n\t      return 'doiCompId-' + i;\n\t    }).classed('doiComp', true);\n\n\t    gDCompEnter.append('rect').classed('doiCompRect', true).attr('x', 0).attr('y', function (d) {\n\t      rectOffset += d.value * 300;\n\t      return rectOffset - d.value * 300;\n\t    }).attr('width', 40).attr('height', function (d) {\n\t      return d.value * 300;\n\t    }).style('fill', function (d, i) {\n\t      return doiColorScale(10 - i);\n\t    });\n\n\t    rectOffset = 0;\n\n\t    gDCompEnter.append('rect').classed('doiCompHandle', true).attr('x', 40 + labelOffset).attr('y', function (d, i) {\n\t      return labelsStart + labelOffset * i;\n\t    }).attr('width', labelOffset).attr('height', labelOffset).style('fill', function (d, i) {\n\t      return doiColorScale(10 - i);\n\t    });\n\n\t    rectOffset = 0;\n\n\t    gDCompEnter.append('line').classed('doiCompLine', true).attr('x1', 40).attr('y1', function (d) {\n\t      rectOffset += d.value * 300;\n\t      return rectOffset - d.value * 300 / 2;\n\t    }).attr('x2', 40 + labelOffset).attr('y2', function (d, i) {\n\t      return labelsStart + labelOffset * i + labelOffset / 2;\n\t    }).style({\n\t      stroke: function stroke(d, i) {\n\t        return doiColorScale(10 - i);\n\t      },\n\t      'stroke-opacity': 0.7,\n\t      'stroke-width': '2px'\n\t    });\n\n\t    dComp.exit().remove();\n\n\t    $('#doiSpinners').css('padding-top', labelsStart);\n\t  }\n\n\t  updateDoiView(doiFactors);\n\n\t  doiFactors.forEach(function (dc, i) {\n\t    $('<div/>', {\n\t      id: 'dc-form-' + i,\n\t      class: 'form dc-form',\n\t      style: 'height: 30px; position: absolute; left: 75px; top: ' + parseInt((10 - doiFactors.length) / 2 * 30 + (i + 1) * 30 - 1, 10) + 'px;'\n\t    }).appendTo('#' + 'doiVis');\n\n\t    $('<input/>', {\n\t      id: 'dc-checkbox-' + i,\n\t      class: 'dc-checkbox',\n\t      type: 'checkbox',\n\t      checked: 'true',\n\t      style: 'margin-top: 0px; margin-right: 2px; vertical-align: middle;'\n\t    }).appendTo('#' + 'dc-form-' + i);\n\n\t    $('<input/>', {\n\t      id: 'dc-input-' + i,\n\t      type: 'text',\n\t      class: 'form-control dc-input',\n\t      value: dc.value,\n\t      style: 'display: inline; width: 27px; height: 30px; margin-bottom:' + ' 0px;' + 'margin-right: 2px; text-align: left; padding: 0; margin-left: 2px;' + ' border-radius: 0px;'\n\t    }).appendTo('#' + 'dc-form-' + i);\n\n\t    $('<div/>', {\n\t      id: 'btn-group-wrapper-' + i,\n\t      class: 'btn-group',\n\t      style: 'height: 32px'\n\t    }).appendTo('#' + 'dc-form-' + i);\n\n\t    $('<div/>', {\n\t      id: 'dc-btn-group-' + i,\n\t      class: 'input-group-btn-vertical',\n\t      style: 'margin-right: 2px;'\n\t    }).appendTo('#' + 'btn-group-wrapper-' + i);\n\n\t    $('<button/>', {\n\t      id: 'dc-carret-up-' + i,\n\t      class: 'refinery-base btn btn-default',\n\t      html: '<i class=\\'fa fa-caret-up\\'></i>'\n\t    }).appendTo('#' + 'dc-btn-group-' + i);\n\n\t    $('<button/>', {\n\t      id: 'dc-carret-down-' + i,\n\t      class: 'refinery-base btn btn-default',\n\t      html: '<i class=\\'fa fa-caret-down\\'></i>'\n\t    }).appendTo('#' + 'dc-btn-group-' + i);\n\n\t    $('<span/>', {\n\t      id: 'dc-label-' + i,\n\t      class: 'label dc-label',\n\t      html: dc.label,\n\t      style: 'margin-left: 2px; opacity: 0.7; background-color: ' + doiColorScale(10 - i) + ';'\n\t    }).appendTo('#' + 'dc-form-' + i);\n\t  });\n\n\t  $('<a/>', {\n\t    id: 'prov-doi-view-reset',\n\t    href: '#',\n\t    html: 'Redistribute',\n\t    style: 'width: 25px; position: absolute; left: 90px; top: ' + parseInt((10 - doiFactors.length) / 2 * 30 + (doiFactors.length + 1) * 30 + 10, 10) + 'px;'\n\t  }).appendTo('#' + 'doiVis');\n\n\t  /* TODO: Code cleanup. */\n\t  /**\n\t   * Toggle doi components.\n\t   */\n\t  function toggleDoiComps() {\n\t    var numMaskedComps = d3.values(DoiFactors.factors).filter(function (dc) {\n\t      return DoiFactors.isMasked(dc.label);\n\t    }).length;\n\n\t    if (numMaskedComps > 0) {\n\t      (function () {\n\t        var accVal = d3.values(DoiFactors.factors).filter(function (dc) {\n\t          return DoiFactors.isMasked(dc.label);\n\t        }).map(function (dc) {\n\t          return dc.value;\n\t        }).reduce(function (_accVal_, cur) {\n\t          return _accVal_ + cur;\n\t        });\n\n\t        var tar = 1.0;\n\n\t        d3.values(DoiFactors.factors).forEach(function (dc, i) {\n\t          if (DoiFactors.isMasked(dc.label)) {\n\t            var isMasked = $('#dc-checkbox-' + i)[0].checked;\n\t            if (accVal === 0) {\n\t              DoiFactors.set(d3.keys(DoiFactors.factors)[i], 1 / numMaskedComps, isMasked);\n\t              $('#dc-input-' + i).val(1 / numMaskedComps);\n\t            } else {\n\t              DoiFactors.set(d3.keys(DoiFactors.factors)[i], dc.value / accVal * tar, isMasked);\n\t              $('#dc-input-' + i).val(dc.value / accVal * tar);\n\t            }\n\t          }\n\t        });\n\t      })();\n\t    }\n\t    updateDoiView(d3.values(DoiFactors.factors));\n\t  }\n\n\t  /* Toggle component on svg click. */\n\t  d3.selectAll('.doiComp').on('click', function () {\n\t    var dcId = d3.select(_this4).attr('id').substr(d3.select(_this4).attr('id').length - 1, 1);\n\t    var val = 0.0;\n\t    if ($('#dc-checkbox-' + dcId)[0].checked) {\n\t      $('#dc-checkbox-' + dcId).prop('checked', false);\n\t      $('#dc-label-' + dcId).css('opacity', 0.3);\n\t      d3.select('#doiCompId-' + dcId).select('.doiCompHandle').classed('blendedDoiComp', true);\n\t      d3.select('#doiCompId-' + dcId).select('.doiCompLine').style('display', 'none');\n\t      $('#dc-input-' + dcId).val(val);\n\t      DoiFactors.set(d3.keys(DoiFactors.factors)[dcId], val, false);\n\t    } else {\n\t      $($('#dc-checkbox-' + dcId)).prop('checked', true);\n\t      $('#dc-label-' + dcId).css('opacity', 0.7);\n\t      d3.select('#doiCompId-' + dcId).select('.doiCompHandle').classed('blendedDoiComp', false);\n\t      d3.select('#doiCompId-' + dcId).select('.doiCompLine').style('display', 'inline');\n\t      DoiFactors.set(d3.keys(DoiFactors.factors)[dcId], val, true);\n\t    }\n\t    toggleDoiComps();\n\t  });\n\n\t  /* Toggle component on checkbox click. */\n\t  $('.dc-checkbox').click(function () {\n\t    var dcId = $(this)[0].id[$(this)[0].id.length - 1];\n\t    var val = 0.0;\n\t    if ($(this)[0].checked) {\n\t      $(this.parentNode).find('.dc-label').css('opacity', 0.7);\n\t      d3.select('#doiCompId-' + dcId).select('.doiCompHandle').classed('blendedDoiComp', false);\n\t      d3.select('#doiCompId-' + dcId).select('.doiCompLine').style('display', 'inline');\n\t      val = 0.0;\n\t      DoiFactors.set(d3.keys(DoiFactors.factors)[dcId], val, true);\n\t    } else {\n\t      $(this.parentNode).find('.dc-label').css('opacity', 0.3);\n\t      d3.select('#doiCompId-' + dcId).select('.doiCompHandle').classed('blendedDoiComp', true);\n\t      d3.select('#doiCompId-' + dcId).select('.doiCompLine').style('display', 'none');\n\t      val = 0.0;\n\t      $('#dc-input-' + dcId).val(val);\n\t      DoiFactors.set(d3.keys(DoiFactors.factors)[dcId], val, false);\n\t    }\n\n\t    toggleDoiComps();\n\t  });\n\n\t  /* TODO: Clean up code duplication. */\n\n\t  /* Increase component's influence. */\n\t  $('.dc-form .btn:first-of-type').on('click', function () {\n\t    var dcId = $(_this4)[0].id[$(_this4)[0].id.length - 1];\n\t    var val = parseFloat($('#dc-input-' + dcId).val()) + 0.01;\n\t    if ($('#dc-checkbox-' + dcId)[0].checked && val <= 1) {\n\t      (function () {\n\t        $('#dc-input-' + dcId).val(val);\n\t        DoiFactors.set(d3.keys(DoiFactors.factors)[dcId], val, true);\n\n\t        var accVal = d3.values(DoiFactors.factors).filter(function (dc, i) {\n\t          return i !== dcId && DoiFactors.isMasked(dc.label);\n\t        }).map(function (dc) {\n\t          return dc.value;\n\t        }).reduce(function (_accVal_, cur) {\n\t          return _accVal_ + cur;\n\t        });\n\n\t        var tar = parseFloat(1 - val);\n\n\t        d3.values(DoiFactors.factors).forEach(function (dc, i) {\n\t          if (i !== dcId && DoiFactors.isMasked(dc.label)) {\n\t            var isMasked = $('#dc-checkbox-' + i)[0].checked;\n\t            DoiFactors.set(d3.keys(DoiFactors.factors)[i], dc.value / accVal * tar, isMasked);\n\t            $('#dc-input-' + i).val(dc.value / accVal * tar);\n\t          }\n\t        });\n\t        updateDoiView(d3.values(DoiFactors.factors));\n\t      })();\n\t    }\n\t  });\n\n\t  /* Decrease component's influence. */\n\t  $('.dc-form .btn:last-of-type').on('click', function () {\n\t    var dcId = $(_this4)[0].id[$(_this4)[0].id.length - 1];\n\t    var val = parseFloat($('#dc-input-' + dcId).val()) - 0.01;\n\t    if ($('#dc-checkbox-' + dcId)[0].checked && val >= 0) {\n\t      (function () {\n\t        $('#dc-input-' + dcId).val(val);\n\t        DoiFactors.set(d3.keys(DoiFactors.factors)[dcId], val, true);\n\n\t        var accVal = d3.values(DoiFactors.factors).filter(function (dc, i) {\n\t          return i !== dcId && DoiFactors.isMasked(dc.label);\n\t        }).map(function (dc) {\n\t          return dc.value;\n\t        }).reduce(function (_accVal_, cur) {\n\t          return _accVal_ + cur;\n\t        });\n\n\t        var tar = parseFloat(1 - val);\n\n\t        d3.values(DoiFactors.factors).forEach(function (dc, i) {\n\t          if (i !== dcId && DoiFactors.isMasked(dc.label)) {\n\t            var isMasked = $('#dc-checkbox-' + i)[0].checked;\n\t            DoiFactors.set(d3.keys(DoiFactors.factors)[i], dc.value / accVal * tar, isMasked);\n\t            $('#dc-input-' + i).val(dc.value / accVal * tar);\n\t          }\n\t        });\n\t        updateDoiView(d3.values(DoiFactors.factors));\n\t      })();\n\t    }\n\t  });\n\n\t  $('.dc-input').keypress(function (e) {\n\t    var _this5 = this;\n\n\t    if (e.which === 13) {\n\t      (function () {\n\t        var dcId = $(_this5)[0].id[$(_this5)[0].id.length - 1];\n\t        var val = parseFloat($('#dc-input-' + dcId).val());\n\n\t        if (val > 1) {\n\t          val = 1;\n\t        } else if (val < 0) {\n\t          val = 0;\n\t        }\n\n\t        $(_this5).val(val);\n\t        $($('#dc-checkbox-' + dcId)).prop('checked', true);\n\t        $('#doiCompId-' + dcId).find('.dc-label').css('opacity', 0.7);\n\t        d3.select('#doiCompId-' + dcId).select('.doiCompHandle').classed('blendedDoiComp', false);\n\t        d3.select('#doiCompId-' + dcId).select('.doiCompLine').style('display', 'inline');\n\t        DoiFactors.set(d3.keys(DoiFactors.factors)[dcId], val, true);\n\n\t        var accVal = d3.values(DoiFactors.factors).filter(function (dc, i) {\n\t          return i !== dcId && DoiFactors.isMasked(dc.label);\n\t        }).map(function (dc) {\n\t          return dc.value;\n\t        }).reduce(function (_accVal_, cur) {\n\t          return _accVal_ + cur;\n\t        });\n\n\t        var tar = parseFloat(1 - val);\n\n\t        d3.values(DoiFactors.factors).forEach(function (dc, i) {\n\t          if (i !== dcId && DoiFactors.isMasked(dc.label)) {\n\t            var isMasked = $('#dc-checkbox-' + i)[0].checked;\n\t            DoiFactors.set(d3.keys(DoiFactors.factors)[i], dc.value / accVal * tar, isMasked);\n\t            $('#dc-input-' + i).val(dc.value / accVal * tar);\n\t          }\n\t        });\n\t        updateDoiView(d3.values(DoiFactors.factors));\n\t      })();\n\t    }\n\t  });\n\n\t  $('#prov-doi-view-apply').on('click', function () {\n\t    /* Recompute doi. */\n\t    recomputeDOI();\n\t  });\n\n\t  $('#prov-doi-view-reset').on('click', function () {\n\t    var val = parseFloat(1 / d3.values(DoiFactors.factors).filter(function (dc) {\n\t      return DoiFactors.isMasked(dc.label);\n\t    }).length);\n\n\t    d3.values(DoiFactors.factors).forEach(function (dc, i) {\n\t      if (!DoiFactors.isMasked(dc.label)) {\n\t        $('#dc-input-' + i).val(0.0);\n\t        DoiFactors.set(d3.keys(DoiFactors.factors)[i], 0.0, false);\n\t      } else {\n\t        $('#dc-input-' + i).val(val);\n\t        DoiFactors.set(d3.keys(DoiFactors.factors)[i], val, true);\n\t      }\n\t    });\n\t    updateDoiView(d3.values(DoiFactors.factors));\n\t  });\n\n\t  /* Toggle DOI auto update. */\n\t  $('#prov-doi-trigger').click(function () {\n\t    if ($(this).find('input[type=\\'checkbox\\']').prop('checked')) {\n\t      doiAutoUpdate = true;\n\t    } else {\n\t      doiAutoUpdate = false;\n\t    }\n\t  });\n\n\t  /* Show and hide doi labels. */\n\t  $('#prov-doi-view-show').click(function () {\n\t    if ($(this).find('input[type=\\'checkbox\\']').prop('checked')) {\n\t      d3.selectAll('.nodeDoiLabel').style('display', 'inline');\n\t    } else {\n\t      d3.selectAll('.nodeDoiLabel').style('display', 'none');\n\t    }\n\t  });\n\t}\n\n\t/**\n\t * Reset css for all links.\n\t */\n\tfunction clearHighlighting() {\n\t  hLink.classed('hiddenLink', true);\n\t  link.each(function (l) {\n\t    l.highlighted = false;\n\t  });\n\n\t  domNodeset.each(function (n) {\n\t    n.highlighted = false;\n\t    n.doi.highlightedChanged();\n\t  });\n\t}\n\n\t/* TODO: Layer link highlighting. */\n\t/**\n\t * Get predecessing nodes for highlighting the path by the current\n\t * node selection.\n\t * @param n BaseNode extending constructor function.\n\t */\n\tfunction highlightPredPath(n) {\n\t  /* Current node is highlighted. */\n\t  n.highlighted = true;\n\t  n.doi.highlightedChanged();\n\n\t  /* Parent nodes are highlighted too. */\n\t  var pn = n.parent;\n\t  while (pn instanceof BaseNode === true) {\n\t    pn.highlighted = true;\n\t    pn.doi.highlightedChanged();\n\t    pn = pn.parent;\n\t  }\n\n\t  if (n instanceof Layer) {\n\t    n.children.values().forEach(function (an) {\n\t      an.predLinks.values().forEach(function (l) {\n\t        l.highlighted = true;\n\t        l.hidden = false;\n\t        d3.select('#hLinkId-' + l.autoId).classed('hiddenLink', false);\n\n\t        highlightPredPath(l.source);\n\t      });\n\t    });\n\t  } else {\n\t    /* Get svg link element, and for each predecessor call recursively. */\n\t    n.predLinks.values().forEach(function (l) {\n\t      l.highlighted = true;\n\t      if (!l.hidden) {\n\t        d3.select('#hLinkId-' + l.autoId).classed('hiddenLink', false);\n\t      }\n\t      highlightPredPath(l.source);\n\t    });\n\t  }\n\t}\n\n\t/**\n\t * Get succeeding nodes for highlighting the path by the current\n\t * node selection.\n\t * @param n BaseNode extending constructor function.\n\t */\n\tfunction highlightSuccPath(n) {\n\t  /* Current node is highlighted. */\n\t  n.highlighted = true;\n\t  n.doi.highlightedChanged();\n\n\t  /* Parent nodes are highlighted too. */\n\t  var pn = n.parent;\n\t  while (pn instanceof BaseNode === true) {\n\t    pn.highlighted = true;\n\t    pn.doi.highlightedChanged();\n\t    pn = pn.parent;\n\t  }\n\n\t  if (n instanceof Layer) {\n\t    n.children.values().forEach(function (an) {\n\t      an.succLinks.values().forEach(function (l) {\n\t        l.highlighted = true;\n\t        l.hidden = false;\n\t        d3.select('#hLinkId-' + l.autoId).classed('hiddenLink', false);\n\n\t        highlightSuccPath(l.target);\n\t      });\n\t    });\n\t  } else {\n\t    /* Get svg link element, and for each successor call recursively. */\n\t    n.succLinks.values().forEach(function (l) {\n\t      l.highlighted = true;\n\t      if (!l.hidden) {\n\t        d3.select('#hLinkId-' + l.autoId).classed('hiddenLink', false);\n\t      }\n\n\t      highlightSuccPath(l.target);\n\t    });\n\t  }\n\t}\n\n\t/**\n\t * Update analysis links.\n\t * @param graph The provenance graph.\n\t */\n\tfunction updateAnalysisLinks(graph) {\n\t  /* Data join. */\n\t  var ahl = vis$1.canvas.select('g.aHLinks').selectAll('.hLink').data(graph.aLinks);\n\n\t  /* Enter. */\n\t  ahl.enter().append('path').classed({\n\t    hLink: true\n\t  }).classed('blendedLink', filterAction === 'blend').classed('filteredLink', function (l) {\n\t    return l.filtered;\n\t  }).classed('hiddenLink', function (l) {\n\t    return !l.highlighted;\n\t  }).attr('id', function (l) {\n\t    return 'hLinkId-' + l.autoId;\n\t  });\n\n\t  /* Enter and update. */\n\t  ahl.attr('d', function (l) {\n\t    var srcCoords = getVisibleNodeCoords(l.source);\n\t    var tarCoords = getVisibleNodeCoords(l.target);\n\t    if (linkStyle === 'bezier1') {\n\t      return drawBezierLink(l, srcCoords.x, srcCoords.y, tarCoords.x, tarCoords.y);\n\t    }\n\t    return drawStraightLink(l, srcCoords.x, srcCoords.y, tarCoords.x, tarCoords.y);\n\t  }).classed('blendedLink', function (l) {\n\t    return !l.filtered && filterAction === 'blend';\n\t  }).classed('filteredLink', function (l) {\n\t    return l.filtered;\n\t  }).classed('hiddenLink', function (l) {\n\t    return !l.highlighted;\n\t  }).attr('id', function (l) {\n\t    return 'hLinkId-' + l.autoId;\n\t  });\n\n\t  /* Exit. */\n\t  ahl.exit().remove();\n\n\t  /* Set dom elements. */\n\t  hLink = d3.selectAll('.hLink');\n\n\t  /* Data join */\n\t  var al = vis$1.canvas.select('g.aLinks').selectAll('.link').data(graph.aLinks);\n\n\t  /* Enter. */\n\t  al.enter().append('path').classed({\n\t    link: true,\n\t    aLink: true\n\t  }).classed('blendedLink', function (l) {\n\t    return !l.filtered && filterAction === 'blend';\n\t  }).classed('filteredLink', function (l) {\n\t    return l.filtered;\n\t  }).classed('hiddenLink', function (l) {\n\t    return l.hidden;\n\t  }).attr('id', function (l) {\n\t    return 'linkId-' + l.autoId;\n\t  });\n\n\t  /* Enter and update. */\n\t  al.attr('d', function (l) {\n\t    var srcCoords = getVisibleNodeCoords(l.source);\n\t    var tarCoords = getVisibleNodeCoords(l.target);\n\t    if (linkStyle === 'bezier1') {\n\t      return drawBezierLink(l, srcCoords.x, srcCoords.y, tarCoords.x, tarCoords.y);\n\t    }\n\t    return drawStraightLink(l, srcCoords.x, srcCoords.y, tarCoords.x, tarCoords.y);\n\t  }).classed('blendedLink', function (l) {\n\t    return !l.filtered && filterAction === 'blend';\n\t  }).classed('filteredLink', function (l) {\n\t    return l.filtered;\n\t  }).classed('hiddenLink', function (l) {\n\t    return l.hidden;\n\t  }).attr('id', function (l) {\n\t    return 'linkId-' + l.autoId;\n\t  });\n\n\t  /* Exit. */\n\t  al.exit().remove();\n\n\t  /* Set dom elements. */\n\t  aLink = d3.selectAll('.aLink');\n\t  link = d3.selectAll('.link');\n\t}\n\n\t/**\n\t * Creates a linear time scale ranging from the first to the last analysis\n\t * created.\n\t * @param aNodes Analysis nodes.\n\t * @param range Linear color scale for domain values.\n\t */\n\tfunction createAnalysistimeColorScale(aNodes, range) {\n\t  var min = d3.min(aNodes, function (d) {\n\t    return parseISOTimeFormat(d.start);\n\t  });\n\t  var max = d3.max(aNodes, function (d) {\n\t    return parseISOTimeFormat(d.start);\n\t  });\n\n\t  return d3.time.scale().domain([min, max]).range([range[0], range[1]]);\n\t}\n\n\t/**\n\t * Draw layered nodes.\n\t * @param lNodes Layer nodes.\n\t */\n\tfunction updateLayerNodes(lNodes) {\n\t  var _this6 = this;\n\n\t  /* Data join. */\n\t  var ln = vis$1.canvas.select('g.layers').selectAll('.layer').data(lNodes.values());\n\n\t  /* Enter. */\n\t  var lEnter = ln.enter().append('g').classed({\n\t    layer: true\n\t  });\n\n\t  lEnter.attr('id', function (d) {\n\t    return 'gNodeId-' + d.autoId;\n\t  }).attr('transform', function (d) {\n\t    return 'translate(' + d.x + ',' + d.y + ')';\n\t  });\n\n\t  /* Adjust gradient start and stop position as well as steps based on min,\n\t   * max and occurrences of analyses at a specific time. */\n\t  var gradient = lEnter.append('defs').append('linearGradient').attr('id', function (d) {\n\t    return 'layerGradientId-' + d.autoId;\n\t  }).attr('x1', '0%').attr('y1', '100%').attr('x2', '0%').attr('y2', '0%');\n\n\t  gradient.append('stop').attr('offset', '0%').attr('stop-color', function (l) {\n\t    var latestDate = d3.min(l.children.values(), function (d) {\n\t      return d.start;\n\t    });\n\t    return timeColorScale(parseISOTimeFormat(latestDate));\n\t  }).attr('stop-opacity', 1);\n\n\t  gradient.append('stop').attr('offset', '100%').attr('stop-color', function (l) {\n\t    var earliestDate = d3.max(l.children.values(), function (d) {\n\t      return d.start;\n\t    });\n\t    return timeColorScale(parseISOTimeFormat(earliestDate));\n\t  }).attr('stop-opacity', 1);\n\n\t  /* Draw bounding box. */\n\t  lBBox = lEnter.append('g').attr('id', function (lln) {\n\t    return 'BBoxId-' + lln.autoId;\n\t  }).classed({\n\t    lBBox: true,\n\t    BBox: true,\n\t    hiddenBBox: false\n\t  }).attr('transform', 'translate(' + -cell.width / 2 + ',' + -cell.height / 2 + ')');\n\n\t  lBBox.append('rect').attr('y', -0.6 * scaleFactor * vis$1.radius).attr('width', cell.width).attr('height', cell.height).attr('rx', cell.width / 7).attr('ry', cell.height / 7);\n\n\t  /* Add a clip-path to restrict labels within the cell area. */\n\t  lBBox.append('defs').append('clipPath').attr('id', function (lln) {\n\t    return 'lBBClipId-' + lln.autoId;\n\t  }).append('rect').attr('y', -0.6 * scaleFactor * vis$1.radius).attr('width', cell.width).attr('height', cell.height + 2 * scaleFactor * vis$1.radius).attr('rx', cell.width / 7).attr('ry', cell.height / 7);\n\n\t  /* Time as label. */\n\t  lBBox.append('g').classed('labels', true).attr('clip-path', function (lln) {\n\t    return 'url(#lBBClipId-' + lln.autoId + ')';\n\t  }).append('text').attr('transform', 'translate(' + 1 * scaleFactor * vis$1.radius + ',' + 0.5 * scaleFactor * vis$1.radius + ')').text(function (d) {\n\t    return '' + ' ' + d.wfCode;\n\t  }).classed('lBBoxLabel', true).style('font-family', 'FontAwesome');\n\n\t  var lDiff = lBBox.append('g').classed('lDiff', true).attr('transform', 'translate(' + 0 + ',' + 0 + ')');\n\n\t  lDiff.each(function (lln) {\n\t    if (lln.children.values().some(function (an) {\n\t      return an.motifDiff.numIns !== 0 || an.motifDiff.numOuts !== 0 || an.motifDiff.numSubanalyses !== 0;\n\t    })) {\n\t      d3.select(_this6).append('text').text('').classed('diff-node-type-icon', true).style('font-family', 'FontAwesome');\n\t    }\n\t  });\n\n\t  var layerNode = lEnter.append('g').attr('id', function (l) {\n\t    return 'nodeId-' + l.autoId;\n\t  }).classed({\n\t    lNode: true,\n\t    filteredNode: true,\n\t    blendedNode: false,\n\t    selectedNode: false,\n\t    hiddenNode: function hiddenNode(an) {\n\t      return an.hidden;\n\t    }\n\t  });\n\n\t  lEnter.append('g').classed({\n\t    children: true\n\t  });\n\n\t  var lGlyph = layerNode.append('g').classed({\n\t    glyph: true\n\t  });\n\t  var lLabels = layerNode.append('g').classed({\n\t    labels: true\n\t  });\n\n\t  /* TODO: Aggregate hidden analysis nodes into a single layer glyph.\n\t   * Glyph dimensions depend on the amount of analysis children the layer has\n\t   * as well as how many analyses of them are hidden. */\n\n\t  lGlyph.append('defs').append('clipPath').attr('id', function (l) {\n\t    return 'bbClipId-' + l.autoId;\n\t  }).append('rect').attr('x', -2 * scaleFactor * vis$1.radius).attr('y', -2 * scaleFactor * vis$1.radius).attr('rx', 1).attr('ry', 1).attr('width', 4 * scaleFactor * vis$1.radius).attr('height', 4 * scaleFactor * vis$1.radius);\n\n\t  lGlyph.each(function (lln) {\n\t    if (getLayerPredCount(lln) > 0) {\n\t      d3.select(_this6).append('g').classed('glAnchor', true).append('path').attr('d', 'm' + -2 * scaleFactor * vis$1.radius + ' ' + -0.5 * scaleFactor * vis$1.radius + ' ' + 'h' + -0.8 * scaleFactor * vis$1.radius + ' ' + 'a' + -0.5 * scaleFactor * vis$1.radius + ' ' + 0.5 * scaleFactor * vis$1.radius + ' 0 0 0 ' + '0 ' + 1 * scaleFactor * vis$1.radius + ' ' + 'h' + +0.8 * scaleFactor * vis$1.radius + ' ' + 'z').classed('llAnchor', true);\n\t    }\n\t  });\n\n\t  lGlyph.each(function (lln) {\n\t    if (getLayerSuccCount(lln) > 0) {\n\t      d3.select(_this6).append('g').classed('grAnchor', true).append('path').attr('d', 'm' + 2 * scaleFactor * vis$1.radius + ' ' + -0.5 * scaleFactor * vis$1.radius + ' ' + 'h' + 0.8 * scaleFactor * vis$1.radius + ' ' + 'a' + 0.5 * scaleFactor * vis$1.radius + ' ' + 0.5 * scaleFactor * vis$1.radius + ' 0 0 1 ' + '0 ' + 1 * scaleFactor * vis$1.radius + ' ' + 'h' + -0.8 * scaleFactor * vis$1.radius + ' ' + 'z').classed('rlAnchor', true);\n\t    }\n\t  });\n\n\t  lGlyph.each(function (lln) {\n\t    if (getLayerPredCount(lln) > 1) {\n\t      d3.select(_this6).select('g.glAnchor').append('text').attr('transform', 'translate(' + -2.8 * scaleFactor * vis$1.radius + ',' + 0.5 + ')').text(getLayerPredCount(ln)).attr('class', 'lLabel');\n\t    }\n\t  });\n\n\t  lGlyph.each(function (lln) {\n\t    if (getLayerSuccCount(lln) > 1) {\n\t      d3.select(_this6).select('g.grAnchor').append('text').attr('transform', 'translate(' + 2.8 * scaleFactor * vis$1.radius + ',' + 0.5 + ')').text(getLayerSuccCount(ln)).attr('class', 'lLabel');\n\t    }\n\t  });\n\n\t  lGlyph.append('rect').attr('x', -2.25 * scaleFactor * vis$1.radius).attr('y', -1 * scaleFactor * vis$1.radius).attr('rx', 1).attr('ry', 1).attr('width', 4.5 * scaleFactor * vis$1.radius).attr('height', 2 * scaleFactor * vis$1.radius).style('fill', function (d) {\n\t    return 'url(#layerGradientId-' + d.autoId + ')';\n\t  }).classed('lGlyph', true);\n\n\t  /* Add text labels. */\n\t  lLabels.append('text').text(function (d) {\n\t    return d.doi.doiWeightedSum;\n\t  }).attr('class', 'nodeDoiLabel').style('display', 'none');\n\n\t  lLabels.append('g').classed('wfLabel', true).attr('clip-path', function (l) {\n\t    return 'url(#bbClipId-' + l.autoId + ')';\n\t  });\n\n\t  lLabels.append('text').attr('transform', 'translate(' + -1.1 * scaleFactor * vis$1.radius + ',' + 0 * scaleFactor * vis$1.radius + ')').text('').classed('l-node-type-icon', true).style('fill', function (l) {\n\t    var latestDate = d3.min(l.children.values(), function (d) {\n\t      return d.start;\n\t    });\n\t    return timeColorScale(parseISOTimeFormat(latestDate)) < '#888888' ? '#ffffff' : '#000000';\n\t  });\n\n\t  lLabels.append('text').attr('transform', 'translate(' + 0.8 * scaleFactor * vis$1.radius + ',' + '0.25)').text(function (d) {\n\t    return d.children.size();\n\t  }).attr('class', 'lnLabel glyphNumeral').style('fill', function (l) {\n\t    var latestDate = d3.min(l.children.values(), function (d) {\n\t      return d.start;\n\t    });\n\t    return timeColorScale(parseISOTimeFormat(latestDate)) < '#888888' ? '#ffffff' : '#000000';\n\t  });\n\n\t  /* Enter and update. */\n\t  ln.attr('id', function (d) {\n\t    return 'gNodeId-' + d.autoId;\n\t  }).attr('transform', function (d) {\n\t    return 'translate(' + d.x + ',' + d.y + ')';\n\t  });\n\n\t  /* TODO: Implements update parameters. */\n\n\t  /* Exit. */\n\t  ln.exit().remove();\n\n\t  /* Set dom elements. */\n\t  layer = vis$1.canvas.select('g.layers').selectAll('.layer');\n\t  lNode = d3.selectAll('.lNode');\n\t  lBBox = d3.selectAll('.lBBox');\n\t}\n\n\t/**\n\t * Draw layered nodes.\n\t * @param lLinks Layer links.\n\t */\n\tfunction updateLayerLinks(lLinks) {\n\t  /* Data join. */\n\t  var ln = vis$1.canvas.select('g.lLinks').selectAll('.link').data(lLinks.values());\n\n\t  /* Enter. */\n\t  ln.enter().append('path').classed({\n\t    link: true,\n\t    lLink: true\n\t  }).attr('id', function (d) {\n\t    return 'linkId-' + d.autoId;\n\t  }).classed('blendedLink', function (l) {\n\t    return !l.filtered && filterAction === 'blend';\n\t  }).classed('filteredLink', function (l) {\n\t    return l.filtered;\n\t  }).classed('hiddenLink', function (l) {\n\t    return l.hidden;\n\t  }).attr('id', function (l) {\n\t    return 'linkId-' + l.autoId;\n\t  });\n\n\t  /* Enter and update. */\n\t  ln.attr('d', function (l) {\n\t    var srcCoords = getVisibleNodeCoords(l.source);\n\t    var tarCoords = getVisibleNodeCoords(l.target);\n\n\t    if (linkStyle === 'bezier1') {\n\t      return drawBezierLink(l, srcCoords.x, srcCoords.y, tarCoords.x, tarCoords.y);\n\t    }\n\t    return drawStraightLink(l, srcCoords.x, srcCoords.y, tarCoords.x, tarCoords.y);\n\t  }).classed({\n\t    link: true,\n\t    lLink: true\n\t  }).attr('id', function (d) {\n\t    return 'linkId-' + d.autoId;\n\t  }).classed('blendedLink', function (l) {\n\t    return !l.filtered && filterAction === 'blend';\n\t  }).classed('filteredLink', function (l) {\n\t    return l.filtered;\n\t  }).classed('hiddenLink', function (l) {\n\t    return l.hidden;\n\t  }).attr('id', function (l) {\n\t    return 'linkId-' + l.autoId;\n\t  });\n\n\t  /* Exit. */\n\t  ln.exit().remove();\n\n\t  /* Set dom elements. */\n\t  lLink = vis$1.canvas.select('g.lLinks').selectAll('.link');\n\t}\n\n\t/**\n\t * Draw analysis nodes.\n\t */\n\tfunction updateAnalysisNodes() {\n\t  var _this7 = this;\n\n\t  /* Data join. */\n\t  var lAnalysis = d3.select('g.analyses').selectAll('.analysis').data(vis$1.graph.aNodes.sort(function (a, b) {\n\t    return parseISOTimeFormat(a.start) - parseISOTimeFormat(b.start);\n\t  }));\n\n\t  /* Enter and update. */\n\t  var anUpdate = lAnalysis.attr('id', function (d) {\n\t    return 'gNodeId-' + d.autoId;\n\t  });\n\n\t  anUpdate.attr('transform', function (d) {\n\t    return 'translate(' + d.x + ',' + d.y + ')';\n\t  }).style('fill', function (d) {\n\t    return timeColorScale(parseISOTimeFormat(d.start));\n\t  });\n\n\t  /* Add a clip-path to restrict labels within the cell area. */\n\t  anUpdate.select('defs').select('clipPath').attr('id', function (an) {\n\t    return 'bbClipId-' + an.autoId;\n\t  }).select('rect').attr('transform', 'translate(' + -cell.width / 2 + ',' + -cell.height / 2 + ')').attr('y', -scaleFactor * vis$1.radius).attr('width', cell.width).attr('height', cell.height).attr('rx', cell.width / 7).attr('ry', cell.height / 7);\n\n\t  /* Draw bounding box. */\n\t  var analysisBBox = anUpdate.select('g').attr('id', function (an) {\n\t    return 'BBoxId-' + an.autoId;\n\t  }).classed({\n\t    aBBox: true,\n\t    BBox: true,\n\t    hiddenBBox: true\n\t  }).attr('transform', 'translate(' + -cell.width / 2 + ',' + -cell.height / 2 + ')');\n\n\t  analysisBBox.select('rect').attr('y', -0.6 * scaleFactor * vis$1.radius).attr('width', function () {\n\t    return cell.width;\n\t  }).attr('height', function () {\n\t    return cell.height;\n\t  }).attr('rx', cell.width / 7).attr('ry', cell.height / 7);\n\n\t  /* Add a clip-path to restrict labels within the cell area. */\n\t  analysisBBox.select('defs').select('clipPath').attr('id', function (an) {\n\t    return 'aBBClipId-' + an.autoId;\n\t  }).select('rect').attr('y', -scaleFactor * vis$1.radius).attr('width', cell.width).attr('height', cell.height).attr('rx', cell.width / 7).attr('ry', cell.height / 7);\n\n\t  /* Time as label. */\n\t  analysisBBox.select('g').classed('labels', true).attr('clip-path', function (an) {\n\t    return 'url(#aBBClipId-' + an.autoId + ')';\n\t  }).select('text').attr('transform', 'translate(' + 1 * scaleFactor * vis$1.radius + ',' + 0 * scaleFactor * vis$1.radius + ')').text(function (d) {\n\t    return '' + ' ' + d.wfCode;\n\t  }).classed('aBBoxLabel', true).style('font-family', 'FontAwesome');\n\n\t  /* Draw analysis node. */\n\t  analysisNode = anUpdate.select('g').attr('id', function (an) {\n\t    return 'nodeId-' + an.autoId;\n\t  }).classed({\n\t    aNode: true,\n\t    filteredNode: true,\n\t    blendedNode: false,\n\t    selectedNode: false\n\t  }).classed('hiddenNode', function (an) {\n\t    return an.hidden;\n\t  });\n\n\t  anUpdate.select('g').classed('children', true);\n\n\t  aGlyph = analysisNode.select('g.glyph');\n\t  aLabels = analysisNode.select('g.labels').attr('clip-path', function (an) {\n\t    return 'url(#bbClipId-' + an.autoId + ')';\n\t  });\n\n\t  scaleFactor = 0.75;\n\n\t  aGlyph.each(function (an) {\n\t    if (an.predLinks.size() > 0) {\n\t      d3.select(_this7).select('g.glAnchor').select('path').attr('d', 'm' + -2 * scaleFactor * vis$1.radius + ' ' + -0.5 * scaleFactor * vis$1.radius + ' ' + 'h' + -0.8 * scaleFactor * vis$1.radius + ' ' + 'a' + -0.5 * scaleFactor * vis$1.radius + ' ' + 0.5 * scaleFactor * vis$1.radius + ' 0 0 0 ' + '0 ' + 1 * scaleFactor * vis$1.radius + ' ' + 'h' + +0.8 * scaleFactor * vis$1.radius + ' ' + 'z');\n\t    }\n\t  });\n\n\t  aGlyph.each(function (an) {\n\t    if (an.predLinks.size() > 1) {\n\t      aGlyph.select('g.grAnchor').select('text').attr('transform', 'translate(' + -2.8 * scaleFactor * vis$1.radius + ',' + 0.5 + ')').text(function (d) {\n\t        return d.predLinks.size();\n\t      }).attr('class', 'aLabel').style('display', 'inline');\n\t    }\n\t  });\n\n\t  aGlyph.each(function (an) {\n\t    if (an.succLinks.size() > 0) {\n\t      d3.select(_this7).select('path').attr('d', 'm' + 2 * scaleFactor * vis$1.radius + ' ' + -0.5 * scaleFactor * vis$1.radius + ' ' + 'h' + 0.8 * scaleFactor * vis$1.radius + ' ' + 'a' + 0.5 * scaleFactor * vis$1.radius + ' ' + 0.5 * scaleFactor * vis$1.radius + ' 0 0 1 ' + '0 ' + 1 * scaleFactor * vis$1.radius + ' ' + 'h' + -0.8 * scaleFactor * vis$1.radius + ' ' + 'z');\n\t    }\n\t  });\n\n\t  aGlyph.each(function (an) {\n\t    if (an.succLinks.size() > 1) {\n\t      d3.select(_this7).select('text').attr('transform', 'translate(' + 2.8 * scaleFactor * vis$1.radius + ',' + 0.5 + ')').text(function (d) {\n\t        return d.succLinks.size();\n\t      }).attr('class', 'aLabel').style('display', 'inline');\n\t    }\n\t  });\n\n\t  aGlyph.select('rect').attr('x', -2 * scaleFactor * vis$1.radius).attr('y', -1.5 * scaleFactor * vis$1.radius).attr('rx', 1).attr('ry', 1).attr('width', 4 * scaleFactor * vis$1.radius).attr('height', 3 * scaleFactor * vis$1.radius);\n\n\t  /* Add text labels. */\n\t  aLabels.select('text').text(function (d) {\n\t    return d.doi.doiWeightedSum;\n\t  }).attr('class', 'nodeDoiLabel').style('display', 'none');\n\n\t  /* Enter. */\n\t  var anEnter = lAnalysis.enter().append('g').classed('analysis', true).attr('id', function (d) {\n\t    return 'gNodeId-' + d.autoId;\n\t  });\n\n\t  anEnter.attr('transform', function (d) {\n\t    return 'translate(' + d.x + ',' + d.y + ')';\n\t  }).style('fill', function (d) {\n\t    return timeColorScale(parseISOTimeFormat(d.start));\n\t  });\n\n\t  /* Add a clip-path to restrict labels within the cell area. */\n\t  anEnter.append('defs').append('clipPath').attr('id', function (an) {\n\t    return 'bbClipId-' + an.autoId;\n\t  }).append('rect').attr('transform', 'translate(' + -cell.width / 2 + ',' + -cell.height / 2 + ')').attr('y', -scaleFactor * vis$1.radius).attr('width', cell.width).attr('height', cell.height + 2 * scaleFactor * vis$1.radius).attr('rx', cell.width / 7).attr('ry', cell.height / 7);\n\n\t  /* Draw bounding box. */\n\t  analysisBBox = anEnter.append('g').attr('id', function (an) {\n\t    return 'BBoxId-' + an.autoId;\n\t  }).classed({\n\t    aBBox: true,\n\t    BBox: true,\n\t    hiddenBBox: true\n\t  }).attr('transform', 'translate(' + -cell.width / 2 + ',' + -cell.height / 2 + ')');\n\n\t  analysisBBox.append('rect').attr('y', -0.6 * scaleFactor * vis$1.radius).attr('width', function () {\n\t    return cell.width;\n\t  }).attr('height', function () {\n\t    return cell.height;\n\t  }).attr('rx', cell.width / 7).attr('ry', cell.height / 7);\n\n\t  var aDiff = analysisBBox.append('g').classed('aDiff', true).attr('transform', 'translate(' + 0 + ',' + 0 + ')');\n\n\t  aDiff.each(function (an) {\n\t    if (an.motifDiff.numIns !== 0 || an.motifDiff.numOuts !== 0 || an.motifDiff.numSubanalyses !== 0) {\n\t      d3.select(_this7).append('text').text('').classed('diff-node-type-icon', true).style('font-family', 'FontAwesome');\n\t    }\n\t  });\n\n\t  /* Add a clip-path to restrict labels within the cell area. */\n\t  analysisBBox.append('defs').append('clipPath').attr('id', function (an) {\n\t    return 'aBBClipId-' + an.autoId;\n\t  }).append('rect').attr('y', -scaleFactor * vis$1.radius).attr('width', cell.width).attr('height', cell.height).attr('rx', cell.width / 7).attr('ry', cell.height / 7);\n\n\t  /* Workflow as label. */\n\t  analysisBBox.append('g').classed('labels', true).attr('clip-path', function (an) {\n\t    return 'url(#aBBClipId-' + an.autoId + ')';\n\t  }).append('text').attr('transform', 'translate(' + 1 * scaleFactor * vis$1.radius + ',' + 0 * scaleFactor * vis$1.radius + ')').text(function (d) {\n\t    return '' + ' ' + d.wfCode;\n\t  }).classed('aBBoxLabel', true).style('font-family', 'FontAwesome');\n\n\t  /* Draw analysis node. */\n\t  var analysisNode = anEnter.append('g').attr('id', function (an) {\n\t    return 'nodeId-' + an.autoId;\n\t  }).classed({\n\t    aNode: true,\n\t    filteredNode: true,\n\t    blendedNode: false,\n\t    selectedNode: false\n\t  }).classed('hiddenNode', function (an) {\n\t    return an.hidden;\n\t  });\n\n\t  anEnter.append('g').classed('children', true);\n\n\t  var aGlyph = analysisNode.append('g').classed('glyph', true);\n\n\t  var aLabels = analysisNode.append('g').classed('labels', true).attr('clip-path', function (an) {\n\t    return 'url(#bbClipId-' + an.autoId + ')';\n\t  });\n\n\t  aGlyph.each(function (an) {\n\t    if (an.predLinks.size() > 0) {\n\t      d3.select(_this7).append('g').classed('glAnchor', true).append('path').attr('d', 'm' + -2 * scaleFactor * vis$1.radius + ' ' + -0.5 * scaleFactor * vis$1.radius + ' ' + 'h' + -0.8 * scaleFactor * vis$1.radius + ' ' + 'a' + -0.5 * scaleFactor * vis$1.radius + ' ' + 0.5 * scaleFactor * vis$1.radius + ' 0 0 0 ' + '0 ' + 1 * scaleFactor * vis$1.radius + ' ' + 'h' + +0.8 * scaleFactor * vis$1.radius + ' ' + 'z').classed('laAnchor', true);\n\t    }\n\t  });\n\n\t  aGlyph.each(function (an) {\n\t    if (an.predLinks.size() > 1) {\n\t      d3.select(_this7).select('g.glAnchor').append('text').attr('transform', 'translate(' + -2.8 * scaleFactor * vis$1.radius + ',' + 0.5 + ')').text(function (d) {\n\t        return d.predLinks.size();\n\t      }).attr('class', 'aLabel').style('display', 'inline');\n\t    }\n\t  });\n\n\t  aGlyph.each(function (an) {\n\t    if (an.succLinks.size() > 0) {\n\t      d3.select(_this7).append('g').classed('grAnchor', true).append('path').attr('d', 'm' + 2 * scaleFactor * vis$1.radius + ' ' + -0.5 * scaleFactor * vis$1.radius + ' ' + 'h' + 0.8 * scaleFactor * vis$1.radius + ' ' + 'a' + 0.5 * scaleFactor * vis$1.radius + ' ' + 0.5 * scaleFactor * vis$1.radius + ' 0 0 1 ' + '0 ' + 1 * scaleFactor * vis$1.radius + ' ' + 'h' + -0.8 * scaleFactor * vis$1.radius + ' ' + 'z').classed('raAnchor', true);\n\t    }\n\t  });\n\n\t  aGlyph.each(function (an) {\n\t    if (an.succLinks.size() > 1) {\n\t      d3.select(_this7).select('g.grAnchor').append('text').attr('transform', 'translate(' + 2.8 * scaleFactor * vis$1.radius + ',' + 0.5 + ')').text(function (d) {\n\t        return d.succLinks.size();\n\t      }).attr('class', 'aLabel').style('display', 'inline');\n\t    }\n\t  });\n\n\t  aGlyph.append('rect').attr('x', -2.25 * scaleFactor * vis$1.radius).attr('y', -1.0 * scaleFactor * vis$1.radius).attr('rx', 1).attr('ry', 1).attr('width', 4.5 * scaleFactor * vis$1.radius).attr('height', 2 * scaleFactor * vis$1.radius).classed('aGlyph', true);\n\n\t  /* Add text labels. */\n\t  aLabels.append('text').text(function (d) {\n\t    return d.doi.doiWeightedSum;\n\t  }).attr('class', 'nodeDoiLabel').style('display', 'none');\n\n\t  aLabels.append('text').attr('transform', 'translate(' + -1.1 * scaleFactor * vis$1.radius + ',0)').text('').classed('an-node-type-icon', true).style('fill', function (an) {\n\t    return timeColorScale(parseISOTimeFormat(an.start)) < '#888888' ? '#ffffff' : '#000000';\n\t  });\n\n\t  aLabels.append('text').attr('transform', 'translate(' + 1.0 * scaleFactor * vis$1.radius + ',0.25)').text(function (d) {\n\t    return d.children.size();\n\t  }).attr('class', 'anLabel glyphNumeral').style('fill', function (an) {\n\t    return timeColorScale(parseISOTimeFormat(an.start)) < '#888888' ? '#ffffff' : '#000000';\n\t  });\n\n\t  /* Exit. */\n\t  lAnalysis.exit().remove();\n\n\t  /* Set dom elements. */\n\t  analysis = vis$1.canvas.select('g.analyses').selectAll('.analysis');\n\t  aNode = d3.selectAll('.aNode');\n\t  aBBox = d3.selectAll('.aBBox');\n\t}\n\n\t/**\n\t * Draws the subanalalysis containing links.\n\t * @param san Subanalysis node.\n\t */\n\tfunction drawSubanalysisLinks(san) {\n\t  /* Draw highlighting links. */\n\t  /* Data join. */\n\t  var sahl = d3.select('#gNodeId-' + san.autoId).select('g.saHLinks').selectAll('.hLink').data(san.links.values());\n\n\t  /* Enter and update. */\n\t  sahl.attr('d', function (l) {\n\t    if (linkStyle === 'bezier1') {\n\t      return drawBezierLink(l, l.source.x, l.source.y, l.target.x, l.target.y);\n\t    }\n\t    return drawStraightLink(l, l.source.x, l.source.y, l.target.x, l.target.y);\n\t  }).classed({\n\t    hLink: true,\n\t    hiddenLink: true\n\t  }).attr('id', function (l) {\n\t    return 'hLinkId-' + l.autoId;\n\t  });\n\n\t  /* Enter. */\n\t  sahl.enter().append('path').attr('d', function (l) {\n\t    if (linkStyle === 'bezier1') {\n\t      return drawBezierLink(l, l.source.x, l.source.y, l.target.x, l.target.y);\n\t    }\n\t    return drawStraightLink(l, l.source.x, l.source.y, l.target.x, l.target.y);\n\t  }).classed({\n\t    hLink: true,\n\t    hiddenLink: true\n\t  }).attr('id', function (l) {\n\t    return 'hLinkId-' + l.autoId;\n\t  });\n\n\t  /* Exit. */\n\t  sahl.exit().remove();\n\n\t  /* Draw normal links. */\n\t  /* Data join. */\n\t  var sal = d3.select('#gNodeId-' + san.autoId).select('g.saLinks').selectAll('.Link').data(san.links.values());\n\n\t  /* Enter and update. */\n\t  sal.attr('d', function (l) {\n\t    if (linkStyle === 'bezier1') {\n\t      return drawBezierLink(l, l.source.x, l.source.y, l.target.x, l.target.y);\n\t    }\n\t    return drawStraightLink(l, l.source.x, l.source.y, l.target.x, l.target.y);\n\t  }).classed({\n\t    link: true,\n\t    saLink: true,\n\t    hiddenLink: true\n\t  }).attr('id', function (l) {\n\t    return 'linkId-' + l.autoId;\n\t  });\n\n\t  /* Enter. */\n\t  sal.enter().append('path').attr('d', function (l) {\n\t    if (linkStyle === 'bezier1') {\n\t      return drawBezierLink(l, l.source.x, l.source.y, l.target.x, l.target.y);\n\t    }\n\t    return drawStraightLink(l, l.source.x, l.source.y, l.target.x, l.target.y);\n\t  }).classed({\n\t    link: true,\n\t    saLink: true,\n\t    hiddenLink: true\n\t  }).attr('id', function (l) {\n\t    return 'linkId-' + l.autoId;\n\t  });\n\n\t  /* Exit. */\n\t  sal.exit().remove();\n\t}\n\n\t/**\n\t * Draw subanalysis nodes.\n\t * @param saNodes Subanalysis nodes.\n\t */\n\tfunction drawSubanalysisNodes() {\n\t  var _this8 = this;\n\n\t  analysis.each(function (an) {\n\t    /* Data join. */\n\t    subanalysis = d3.select(_this8).select('.children').selectAll('.subanalysis').data(an.children.values());\n\n\t    var saEnter = subanalysis.enter().append('g').classed('subanalysis', true).attr('id', function (d) {\n\t      return 'gNodeId-' + d.autoId;\n\t    }).attr('transform', function (d) {\n\t      return 'translate(' + d.x + ',' + d.y + ')';\n\t    });\n\n\t    saEnter.each(function (san) {\n\t      var self = d3.select(_this8);\n\t      /* Draw links for each subanalysis. */\n\n\t      d3.select('#gNodeId-' + san.autoId).append('g').classed('saHLinks', true);\n\t      d3.select('#gNodeId-' + san.autoId).append('g').classed('saLinks', true);\n\t      drawSubanalysisLinks(san);\n\n\t      /* Compute bounding box for subanalysis child nodes. */\n\t      var saBBoxCoords = getWFBBoxCoords(san, cell, 0);\n\n\t      /* Add a clip-path to restrict labels within the cell area. */\n\t      self.append('defs').append('clipPath').attr('id', 'bbClipId-' + san.autoId).append('rect').attr('transform', 'translate(' + -cell.width / 2 + ',' + -cell.height / 2 + ')').attr('width', cell.width).attr('height', cell.height);\n\n\t      /* Draw bounding box. */\n\t      var subanalysisBBox = self.append('g').attr('id', 'BBoxId-' + san.autoId).classed({\n\t        saBBox: true,\n\t        BBox: true,\n\t        hiddenBBox: true\n\t      }).attr('transform', 'translate(' + -cell.width / 2 + ',' + -cell.height / 2 + ')');\n\n\t      /* Add a clip-path to restrict labels within the cell area. */\n\t      subanalysisBBox.append('defs').attr('x', scaleFactor * vis$1.radius).attr('y', -0.5 * scaleFactor * vis$1.radius).append('clipPath').attr('id', 'saBBClipId-' + san.autoId).append('rect').attr('width', saBBoxCoords.x.max - saBBoxCoords.x.min - scaleFactor * vis$1.radius).attr('height', cell.height);\n\n\t      subanalysisBBox.append('rect').attr('x', scaleFactor * vis$1.radius).attr('y', scaleFactor * vis$1.radius).attr('width', saBBoxCoords.x.max - saBBoxCoords.x.min - 2 * scaleFactor * vis$1.radius).attr('height', saBBoxCoords.y.max - saBBoxCoords.y.min - 2 * scaleFactor * vis$1.radius).attr('rx', cell.width / 7).attr('ry', cell.height / 7);\n\n\t      /* Draw subanalysis node. */\n\t      var subanalysisNode = self.append('g').attr('id', 'nodeId-' + san.autoId).classed({\n\t        saNode: true,\n\t        filteredNode: true,\n\t        blendedNode: false,\n\t        selectedNode: false\n\t      }).classed('hiddenNode', function (sann) {\n\t        return sann.hidden;\n\t      });\n\n\t      self.append('g').classed('children', true);\n\n\t      var saGlyph = subanalysisNode.append('g').classed('glyph', true);\n\t      var saLabels = subanalysisNode.append('g').classed('labels', true).attr('clip-path', 'url(#bbClipId-' + san.autoId + ')');\n\n\t      saGlyph.each(function (sann) {\n\t        if (sann.predLinks.size() > 0) {\n\t          d3.select(_this8).append('g').classed('glAnchor', true).append('path').attr('d', 'm' + -2 * scaleFactor * vis$1.radius + ' ' + -0.5 * scaleFactor * vis$1.radius + ' ' + 'h' + -0.8 * scaleFactor * vis$1.radius + ' ' + 'a' + -0.5 * scaleFactor * vis$1.radius + ' ' + 0.5 * scaleFactor * vis$1.radius + ' 0 0 0 ' + '0 ' + 1 * scaleFactor * vis$1.radius + ' ' + 'h' + +0.8 * scaleFactor * vis$1.radius + ' ' + 'z').classed('lsaAnchor', true);\n\t        }\n\t      });\n\n\t      saGlyph.each(function (sann) {\n\t        if (sann.predLinks.size() > 1) {\n\t          d3.select(_this8).select('g.glAnchor').append('text').attr('transform', 'translate(' + -2.8 * scaleFactor * vis$1.radius + ',' + 0.5 + ')').text(function (d) {\n\t            return d.predLinks.size();\n\t          }).attr('class', 'saLabel').style('display', 'inline');\n\t        }\n\t      });\n\n\t      saGlyph.each(function (sann) {\n\t        if (sann.succLinks.size() > 0) {\n\t          saGlyph.append('g').classed('grAnchor', true).append('path').attr('d', 'm' + 2 * scaleFactor * vis$1.radius + ' ' + -0.5 * scaleFactor * vis$1.radius + ' ' + 'h' + 0.8 * scaleFactor * vis$1.radius + ' ' + 'a' + 0.5 * scaleFactor * vis$1.radius + ' ' + 0.5 * scaleFactor * vis$1.radius + ' 0 0 1 ' + '0 ' + 1 * scaleFactor * vis$1.radius + ' ' + 'h' + -0.8 * scaleFactor * vis$1.radius + ' ' + 'z').classed('rsaAnchor', true);\n\t        }\n\t      });\n\n\t      saGlyph.each(function (sann) {\n\t        if (sann.succLinks.size() > 1) {\n\t          d3.select(_this8).select('g.grAnchor').append('text').attr('transform', 'translate(' + 2.8 * scaleFactor * vis$1.radius + ',' + 0.5 + ')').text(function (d) {\n\t            return d.succLinks.size();\n\t          }).attr('class', 'saLabel').style('display', 'inline');\n\t        }\n\t      });\n\n\t      saGlyph.append('rect').attr('x', -2.25 * scaleFactor * vis$1.radius).attr('y', -1 * scaleFactor * vis$1.radius).attr('rx', 1).attr('ry', 1).attr('width', 4.5 * scaleFactor * vis$1.radius).attr('height', 2 * scaleFactor * vis$1.radius);\n\n\t      /* Add text labels. */\n\t      saLabels.append('text').text(function (d) {\n\t        return d.doi.doiWeightedSum;\n\t      }).attr('class', 'nodeDoiLabel').style('display', 'none');\n\n\t      saLabels.append('text').attr('transform', 'translate(' + -1.1 * scaleFactor * vis$1.radius + ',0)').text('').classed('san-node-type-icon', true).style('fill', function (sann) {\n\t        return timeColorScale(parseISOTimeFormat(sann.parent.start)) < '#888888' ? '#ffffff' : '#000000';\n\t      });\n\n\t      saLabels.append('text').attr('transform', 'translate(' + 1.0 * scaleFactor * vis$1.radius + ',0.25)').text(function (d) {\n\t        return d.wfUuid !== 'dataset' ? d.children.values().filter(function (cn) {\n\t          return cn.nodeType === 'dt';\n\t        }).length : d.children.size();\n\t      }).attr('class', 'sanLabel glyphNumeral').style('fill', function (sann) {\n\t        return timeColorScale(parseISOTimeFormat(sann.parent.start)) < '#888888' ? '#ffffff' : '#000000';\n\t      });\n\t    });\n\t  });\n\n\t  /* Set dom elements. */\n\t  saNode = d3.selectAll('.saNode');\n\t  subanalysis = d3.selectAll('.subanalysis');\n\t  saBBox = d3.selectAll('.saBBox');\n\n\t  saLink = d3.selectAll('.saLink');\n\t  link = d3.selectAll('.link');\n\t  hLink = d3.selectAll('.hLink');\n\t}\n\n\t/**\n\t * Draw nodes.\n\t * @param nodes All nodes within the graph.\n\t */\n\tfunction drawNodes() {\n\t  var _this9 = this;\n\n\t  subanalysis.each(function (san) {\n\t    node = d3.select(_this9).select('.children').selectAll('.node').data(san.children.values()).enter().append('g').classed('node', true).attr('id', function (d) {\n\t      return 'gNodeId-' + d.autoId;\n\t    }).attr('transform', function (d) {\n\t      return 'translate(' + d.x + ',' + d.y + ')';\n\t    });\n\n\t    node.each(function (d) {\n\t      var self = d3.select(_this9);\n\t      self.attr('class', function (dd) {\n\t        return 'node ' + dd.nodeType + 'Node';\n\t      }).attr('id', function (dd) {\n\t        return 'nodeId-' + dd.autoId;\n\t      }).classed('blendedNode', function (l) {\n\t        return !l.filtered && filterAction === 'blend';\n\t      }).classed('filteredNode', function (l) {\n\t        return l.filtered;\n\t      }).classed('hiddenNode', function (l) {\n\t        return l.hidden;\n\t      });\n\n\t      /* Add a clip-path to restrict labels within the cell area. */\n\t      self.append('defs').append('clipPath').attr('id', 'bbClipId-' + d.autoId).append('rect').attr('transform', 'translate(' + -1.5 * scaleFactor * vis$1.radius + ',' + -cell.height * 3 / 4 + ')').attr('width', cell.width - 2 * scaleFactor * vis$1.radius).attr('height', cell.height + 1 * scaleFactor * vis$1.radius);\n\n\t      var nGlyph = self.append('g').classed('glyph', true);\n\t      var nLabels = self.append('g').classed('labels', true).attr('clip-path', 'url(#bbClipId-' + d.autoId + ')');\n\n\t      nGlyph.each(function (n) {\n\t        if (n.predLinks.size() > 0) {\n\t          d3.select(_this9).append('g').classed('glAnchor', true).append('path').attr('d', 'm' + 0 + ' ' + -0.5 * scaleFactor * vis$1.radius + ' ' + 'h' + -1 * scaleFactor * vis$1.radius + ' ' + 'a' + -0.5 * scaleFactor * vis$1.radius + ' ' + 0.5 * scaleFactor * vis$1.radius + ' 0 0 0 ' + '0 ' + 1 * scaleFactor * vis$1.radius + ' ' + 'h' + +1 * scaleFactor * vis$1.radius + ' ' + 'z').classed('lnAnchor', true);\n\t        }\n\t      });\n\n\t      nGlyph.each(function (n) {\n\t        if (n.succLinks.size() > 0) {\n\t          nGlyph.append('g').classed('grAnchor', true).append('path').attr('d', 'm' + 0 + ' ' + -0.5 * scaleFactor * vis$1.radius + ' ' + 'h' + 1 * scaleFactor * vis$1.radius + ' ' + 'a' + 0.5 * scaleFactor * vis$1.radius + ' ' + 0.5 * scaleFactor * vis$1.radius + ' 0 0 1 ' + '0 ' + 1 * scaleFactor * vis$1.radius + ' ' + 'h' + -1 * scaleFactor * vis$1.radius + ' ' + 'z').classed('rnAnchor', true);\n\t        }\n\t      });\n\n\t      if (d.nodeType === 'raw' || d.nodeType === 'intermediate' || d.nodeType === 'stored') {\n\t        nGlyph.append('circle').attr('r', function (dd) {\n\t          return dd.nodeType === 'intermediate' ? 3 * scaleFactor * vis$1.radius / 4 : 5 * scaleFactor * vis$1.radius / 6;\n\t        });\n\t      } else {\n\t        if (d.nodeType === 'special') {\n\t          nGlyph.append('rect').attr('transform', 'translate(' + -3 * scaleFactor * vis$1.radius / 4 + ',' + -3 * scaleFactor * vis$1.radius / 4 + ')').attr('width', 1.5 * scaleFactor * vis$1.radius).attr('height', 1.5 * scaleFactor * vis$1.radius);\n\t        } else if (d.nodeType === 'dt') {\n\t          nGlyph.append('rect').attr('transform', 'translate(' + -1.25 * scaleFactor * vis$1.radius / 2 + ',' + -1.25 * scaleFactor * vis$1.radius / 2 + ')' + 'rotate(45 ' + 1.25 * scaleFactor * vis$1.radius / 2 + ',' + 1.25 * scaleFactor * vis$1.radius / 2 + ')').attr('width', 1.25 * scaleFactor * vis$1.radius).attr('height', 1.25 * scaleFactor * vis$1.radius);\n\t        }\n\t      }\n\n\t      nLabels.append('text').text(function (dd) {\n\t        return dd.doi.doiWeightedSum;\n\t      }).attr('class', 'nodeDoiLabel').style('display', 'none');\n\n\t      nLabels.each(function () {\n\t        d3.select(_this9).append('text').attr('transform', 'translate(' + -1.5 * scaleFactor * vis$1.radius + ',' + -1.5 * scaleFactor * vis$1.radius + ')').text(function (ddd) {\n\t          var nodeAttrLabel = '';\n\n\t          if (ddd.nodeType === 'stored') {\n\t            nodeAttrLabel = ddd.attributes.get('name');\n\t          } else {\n\t            /* Trim data transformation node names for\n\t             testtoolshed repo.*/\n\t            if (ddd.nodeType === 'dt') {\n\t              if (ddd.name.indexOf(': ') > 0) {\n\t                var firstPart = ddd.name.substr(ddd.name.indexOf(': ') + 2, ddd.name.length - ddd.name.indexOf(': ') - 2);\n\t                ddd.label = firstPart;\n\t                var secondPart = ddd.name.substr(0, ddd.name.indexOf(': '));\n\t                ddd.name = firstPart + ' (' + secondPart + ')';\n\t                nodeAttrLabel = ddd.label;\n\t              }\n\t            } else {\n\t              nodeAttrLabel = ddd.name;\n\t            }\n\t          }\n\t          return nodeAttrLabel;\n\t        }).attr('class', 'nodeAttrLabel');\n\t      });\n\n\t      nLabels.each(function (dd) {\n\t        if (dd.nodeType === 'stored') {\n\t          d3.select(_this9).append('text').text('').classed('stored-node-type-icon', true).style('fill', function (n) {\n\t            return timeColorScale(parseISOTimeFormat(n.parent.parent.start)) < '#888888' ? '#ffffff' : '#000000';\n\t          });\n\t        }\n\t      });\n\t    });\n\t  });\n\t  /* Set node dom element. */\n\t  node = d3.selectAll('.node');\n\t}\n\n\t/* TODO: Code cleanup. */\n\t/**\n\t * Dynamic Dagre layout.\n\t * @param graph The provenance Graph.\n\t */\n\tfunction dagreDynamicLayerLayout(graph) {\n\t  /* Initializations. */\n\t  var g = new dagre.graphlib.Graph();\n\t  g.setGraph({\n\t    rankdir: 'LR',\n\t    nodesep: 1 * scaleFactor * vis$1.radius,\n\t    edgesep: 0,\n\t    ranksep: 4 * scaleFactor * vis$1.radius,\n\t    marginx: 0,\n\t    marginy: 0\n\t  });\n\t  g.setDefaultEdgeLabel({});\n\t  var anBBoxCoords = {};\n\t  var curWidth = 0;\n\t  var curHeight = 0;\n\t  var exNum = 0;\n\t  var accY = 0;\n\n\t  /* Add layer or analysis nodes with a dynamic bounding box size\n\t   * (based on visible child nodes). */\n\t  graph.lNodes.values().forEach(function (ln) {\n\t    d3.select('#BBoxId-' + ln.autoId).classed('hiddenBBox', true);\n\t    if (!ln.hidden) {\n\t      (function () {\n\t        if (ln.filtered) {\n\t          d3.select('#BBoxId-' + ln.autoId).classed('hiddenBBox', false);\n\t        }\n\t        curWidth = vis$1.cell.width;\n\t        curHeight = vis$1.cell.height;\n\n\t        /* Check exaggerated layer children. */\n\t        /* Add visible dimensions to layer node without bounding boxes. */\n\t        /* Based on current y-coord order, the stack of nodes will be drawn\n\t         vertically. */\n\t        /* Child nodes inherit x-coord of layer node and y-coord will be\n\t         computed based on the statement above.*/\n\t        /* Layer node number labels may be updated. */\n\t        /* Maybe add a bounding box for layered node and exaggerated nodes.*/\n\n\t        exNum = 0;\n\t        accY = ln.y + vis$1.cell.height;\n\t        ln.children.values().filter(function (an) {\n\t          return an.filtered || filterAction === 'blend';\n\t        }).sort(function (a, b) {\n\t          return a.y - b.y;\n\t        }).forEach(function (an) {\n\t          if (an.exaggerated && an.filtered) {\n\t            exNum++;\n\t            an.x = an.parent.x;\n\t            an.y = accY;\n\t            accY += getABBoxCoords(an, cell, 0).y.max - getABBoxCoords(an, cell, 0).y.min;\n\n\t            updateNodeAndLink(an, d3.select('#gNodeId-' + an.autoId));\n\t            d3.select('#BBoxId-' + ln.autoId).classed('hiddenBBox', false);\n\t            d3.select('#BBoxId-' + an.autoId).classed('hiddenBBox', false);\n\t          } else {\n\t            an.x = an.parent.x;\n\t            an.y = an.parent.y;\n\t          }\n\t        });\n\n\t        /* Set layer label and bounding box. */\n\t        var numChildren = ln.children.values().filter(function (an) {\n\t          return an.filtered || filterAction === 'blend';\n\t        }).length;\n\n\t        d3.select('#nodeId-' + ln.autoId).select('g.labels').select('.lnLabel').text(numChildren - exNum + '/' + ln.children.size());\n\n\t        /* Get potential expanded bounding box size. */\n\t        var accHeight = curHeight;\n\t        var accWidth = curWidth;\n\t        ln.children.values().filter(function (an) {\n\t          return an.filtered || filterAction === 'blend';\n\t        }).forEach(function (an) {\n\t          if (an.exaggerated) {\n\t            anBBoxCoords = getABBoxCoords(an, cell, 0);\n\t            if (anBBoxCoords.x.max - anBBoxCoords.x.min > accWidth) {\n\t              accWidth = anBBoxCoords.x.max - anBBoxCoords.x.min;\n\t            }\n\t            accHeight += anBBoxCoords.y.max - anBBoxCoords.y.min;\n\t          }\n\t        });\n\n\t        d3.select('#lBBClipId-' + ln.autoId).select('rect').attr('width', accWidth).attr('height', accHeight);\n\n\t        d3.select('#BBoxId-' + ln.autoId).attr('transform', 'translate(' + -accWidth / 2 + ',' + -vis$1.cell.height / 2 + ')').select('rect').attr('width', accWidth).attr('height', accHeight);\n\n\t        g.setNode(ln.autoId, {\n\t          label: ln.autoId,\n\t          width: accWidth,\n\t          height: accHeight\n\t        });\n\t      })();\n\t    } else {\n\t      ln.children.values().filter(function (an) {\n\t        return an.filtered || filterAction === 'blend';\n\t      }).forEach(function (an) {\n\t        anBBoxCoords = getABBoxCoords(an, cell, 0);\n\t        curWidth = anBBoxCoords.x.max - anBBoxCoords.x.min;\n\t        curHeight = anBBoxCoords.y.max - anBBoxCoords.y.min;\n\t        g.setNode(an.autoId, {\n\t          label: an.autoId,\n\t          width: curWidth,\n\t          height: curHeight\n\t        });\n\t      });\n\t    }\n\t  });\n\n\t  /* Add layer-to-layer links. */\n\t  graph.lLinks.values().forEach(function (ll) {\n\t    if (!ll.hidden) {\n\t      g.setEdge(ll.source.autoId, ll.target.autoId, {\n\t        minlen: 1,\n\t        weight: 1,\n\t        width: 0,\n\t        height: 0,\n\t        labelpos: 'r',\n\t        labeloffset: 0\n\t      });\n\t    }\n\t  });\n\n\t  /* Add analysis-mixed links. */\n\t  graph.aLinks.forEach(function (l) {\n\t    if (!l.hidden) {\n\t      /* Either the layer or the analysis is visible and therefore\n\t       virtual links are created.*/\n\t      var src = l.source.parent.parent.parent.autoId;\n\t      var tar = l.target.parent.parent.parent.autoId;\n\t      if (l.source.parent.parent.parent.hidden) {\n\t        src = l.source.parent.parent.autoId;\n\t      }\n\t      if (l.target.parent.parent.parent.hidden) {\n\t        tar = l.target.parent.parent.autoId;\n\t      }\n\n\t      g.setEdge(src, tar, {\n\t        minlen: 1,\n\t        weight: 1,\n\t        width: 0,\n\t        height: 0,\n\t        labelpos: 'r',\n\t        labeloffset: 0\n\t      });\n\t    }\n\t  });\n\n\t  /* Compute layout. */\n\t  dagre.layout(g);\n\n\t  /* Set layer and analysis coords. */\n\t  layoutCols = d3.map();\n\t  var accWidth = 0;\n\t  var accHeight = 0;\n\n\t  /* Assign x and y coords for layers or analyses. Check filter action\n\t   as well as exaggerated nodes. */\n\t  d3.map(g._nodes).values().forEach(function (n) {\n\t    if (typeof n !== 'undefined') {\n\t      if (graph.lNodes.has(n.label) && (graph.lNodes.get(n.label).filtered || filterAction === 'blend')) {\n\t        (function () {\n\t          var ln = graph.lNodes.get(n.label);\n\t          accHeight = vis$1.cell.height;\n\t          accWidth = vis$1.cell.width;\n\n\t          ln.children.values().filter(function (an) {\n\t            return an.filtered || filterAction === 'blend';\n\t          }).forEach(function (an) {\n\t            if (an.exaggerated) {\n\t              anBBoxCoords = getABBoxCoords(an, cell, 0);\n\t              if (anBBoxCoords.x.max - anBBoxCoords.x.min > accWidth) {\n\t                accWidth = anBBoxCoords.x.max - anBBoxCoords.x.min;\n\t              }\n\t              accHeight += anBBoxCoords.y.max - anBBoxCoords.y.min;\n\t            }\n\t          });\n\n\t          ln.x = n.x - vis$1.cell.width / 2;\n\t          ln.y = n.y - accHeight / 2;\n\n\t          exNum = 0;\n\t          accY = ln.y + vis$1.cell.height;\n\t          ln.children.values().filter(function (an) {\n\t            return an.filtered || filterAction === 'blend';\n\t          }).sort(function (a, b) {\n\t            return a.y - b.y;\n\t          }).forEach(function (an) {\n\t            anBBoxCoords = getABBoxCoords(an, cell, 0);\n\t            curWidth = anBBoxCoords.x.max - anBBoxCoords.x.min;\n\t            an.x = ln.x - curWidth / 2 + vis$1.cell.width / 2;\n\n\t            if (an.exaggerated) {\n\t              an.y = accY;\n\t              accY += getABBoxCoords(an, cell, 0).y.max - getABBoxCoords(an, cell, 0).y.min;\n\t            } else {\n\t              an.y = an.parent.y;\n\t            }\n\t          });\n\t        })();\n\t      } else {\n\t        var an = graph.aNodes.filter(function (ann) {\n\t          return ann.autoId === n.label && (ann.filtered || filterAction === 'blend');\n\t        })[0];\n\n\t        if (an && typeof an !== 'undefined') {\n\t          anBBoxCoords = getABBoxCoords(an, cell, 0);\n\t          accWidth = anBBoxCoords.x.max - anBBoxCoords.x.min;\n\t          accHeight = anBBoxCoords.y.max - anBBoxCoords.y.min;\n\n\t          an.x = n.x - accWidth / 2;\n\t          an.y = n.y - accHeight / 2;\n\t        }\n\t      }\n\n\t      /* Compute layouted columns. */\n\t      if (layoutCols.has(n.x)) {\n\t        layoutCols.get(n.x).nodes.push(n.label);\n\t      } else {\n\t        layoutCols.set(n.x, {\n\t          nodes: [],\n\t          width: 0\n\t        });\n\t        layoutCols.get(n.x).nodes.push(n.label);\n\t      }\n\t      if (accWidth > layoutCols.get(n.x).width) {\n\t        layoutCols.get(n.x).width = accWidth;\n\t      }\n\t    }\n\t  });\n\n\t  /* Update graph dom elements. */\n\t  vis$1.graph.lNodes.values().forEach(function (ln) {\n\t    updateNodeAndLink(ln, d3.select('#gNodeId-' + ln.autoId));\n\t  });\n\n\t  /* Reorder node columns by y-coords. */\n\t  layoutCols.values().forEach(function (c) {\n\t    c.nodes = c.nodes.sort(function (a, b) {\n\t      return a.y - b.y;\n\t    });\n\t  });\n\t}\n\n\t/**\n\t * Path highlighting.\n\t * @param d Node.\n\t * @param keyStroke Keystroke being pressed at mouse click.\n\t */\n\tfunction handlePathHighlighting(d, keyStroke) {\n\t  var _this10 = this;\n\n\t  /* Clear any highlighting. */\n\t  clearHighlighting();\n\n\t  if (keyStroke === 's') {\n\t    /* Highlight path. */\n\t    highlightSuccPath(d);\n\t  } else if (keyStroke === 'p') {\n\t    /* Highlight path. */\n\t    highlightPredPath(d);\n\t  }\n\n\t  d3.select('.aHLinks').selectAll('.hLink').each(function (l) {\n\t    if (l.highlighted) {\n\t      l.hidden = false;\n\t      d3.select(_this10).classed('hiddenLink', false);\n\t    }\n\t  });\n\n\t  /* TODO: Temporarily enabled. */\n\t  if (doiAutoUpdate) {\n\t    recomputeDOI();\n\t  }\n\t}\n\n\t/* TODO: Revise. */\n\t/**\n\t * Fit visualization onto free windows space.\n\t * @param transitionTime The time in milliseconds for the duration of the\n\t * animation.\n\t */\n\tfunction fitGraphToWindow(transitionTime) {\n\t  var _this11 = this;\n\n\t  var min = [0, 0];\n\t  var max = [0, 0];\n\n\t  vis$1.graph.aNodes.forEach(function (an) {\n\t    var anBBox = getABBoxCoords(an, cell, 0);\n\t    if (anBBox.x.min < min[0]) {\n\t      min[0] = anBBox.x.min;\n\t    }\n\t    if (anBBox.x.max > max[0]) {\n\t      max[0] = anBBox.x.max;\n\t    }\n\t    if (anBBox.y.min < min[1]) {\n\t      min[1] = anBBox.y.min;\n\t    }\n\t    if (anBBox.y.max > max[1]) {\n\t      max[1] = anBBox.y.max;\n\t    }\n\t  });\n\n\t  /* TODO: Fix for temporary sidebar overlap. */\n\t  var sidebarOverlap = $('#provenance-sidebar').width() - $('#solr-facet-view').width() - parseFloat($('#main-area').css('margin-left').replace('px', ''));\n\n\t  var delta = [max[0] - min[0], max[1] - min[1]];\n\t  var factor = [vis$1.width / delta[0], vis$1.height / delta[1]];\n\t  var newScale = d3.min(factor.concat([3])) * 0.9;\n\t  var newPos = [(sidebarOverlap > 0 ? sidebarOverlap : 0) + vis$1.margin.left * 2 * newScale, (vis$1.height - delta[1] * newScale) / 2 + vis$1.margin.top * 2];\n\n\t  vis$1.canvas.transition().duration(transitionTime).attr('transform', 'translate(' + newPos + ')scale(' + newScale + ')');\n\n\t  vis$1.zoom.translate(newPos);\n\t  vis$1.zoom.scale(newScale);\n\n\t  /* Semantic zoom. */\n\t  setTimeout(function () {\n\t    if (newScale < 1) {\n\t      d3.selectAll('.BBox').classed('hiddenNode', true);\n\t      d3.selectAll('.lDiff, .aDiff').classed('hiddenNode', true);\n\t    } else {\n\t      d3.selectAll('.BBox').classed('hiddenNode', false);\n\t      d3.selectAll('.lDiff, .aDiff').classed('hiddenNode', false);\n\t    }\n\n\t    if (newScale < 1.7) {\n\t      vis$1.canvas.selectAll('.anLabel, .sanLabel, .lnLabel, ' + '.nodeAttrLabel, .stored-node-type-icon, .an-node-type-icon, ' + '.san-node-type-icon, .l-node-type-icon, .lBBoxLabel, ' + '.aBBoxLabel, .nodeDoiLabel').classed('hiddenLabel', true);\n\t      d3.selectAll('.glAnchor, .grAnchor').classed('hiddenNode', true);\n\t    } else {\n\t      vis$1.canvas.selectAll('.anLabel, .sanLabel, .lnLabel, ' + '.nodeAttrLabel, .stored-node-type-icon, .an-node-type-icon, ' + '.san-node-type-icon, .l-node-type-icon, .lBBoxLabel, ' + '.aBBoxLabel, .nodeDoiLabel').classed('hiddenLabel', false);\n\t      d3.selectAll('.glAnchor, .grAnchor').classed('hiddenNode', false);\n\t    }\n\t  }, transitionTime);\n\n\t  /* Background rectangle fix. */\n\t  vis$1.rect.attr('transform', 'translate(' + -newPos[0] / newScale + ',' + -newPos[1] / newScale + ')' + ' ' + 'scale(' + 1 / newScale + ')');\n\n\t  /* Quick fix to exclude scale from text labels. */\n\t  vis$1.canvas.selectAll('.lBBoxLabel').transition().duration(transitionTime).attr('transform', 'translate(' + 1 * scaleFactor * vis$1.radius + ',' + 0.5 * scaleFactor * vis$1.radius + ') ' + 'scale(' + 1 / newScale + ')');\n\n\t  vis$1.canvas.selectAll('.aBBoxLabel').transition().duration(transitionTime).attr('transform', 'translate(' + 1 * scaleFactor * vis$1.radius + ',' + 0 * scaleFactor * vis$1.radius + ') ' + 'scale(' + 1 / newScale + ')');\n\n\t  vis$1.canvas.selectAll('.nodeDoiLabel').transition().duration(transitionTime).attr('transform', 'translate(' + 0 + ',' + 1.6 * scaleFactor * vis$1.radius + ') ' + 'scale(' + 1 / newScale + ')');\n\n\t  vis$1.canvas.selectAll('.nodeAttrLabel').transition().duration(transitionTime).attr('transform', 'translate(' + -1.5 * scaleFactor * vis$1.radius + ',' + -1.5 * scaleFactor * vis$1.radius + ') ' + 'scale(' + 1 / newScale + ')');\n\n\t  /* Trim nodeAttrLabel */\n\t  /* Get current node label pixel width. */\n\t  var maxLabelPixelWidth = (cell.width - 2 * scaleFactor * vis$1.radius) * d3.transform(d3.select('.canvas').select('g').select('g').attr('transform')).scale[0];\n\n\t  /* Get label text. */\n\t  d3.selectAll('.node').select('.nodeAttrLabel').each(function (d) {\n\t    var attrText = d.label === '' ? d.name : d.label;\n\t    if (d.nodeType === 'stored') {\n\t      var selAttrName = '';\n\t      $('#prov-ctrl-visible-attribute-list > li').each(function () {\n\t        if ($(this).find('input[type=\\'radio\\']').prop('checked')) {\n\t          selAttrName = $(this).find('label').text();\n\t        }\n\t      });\n\t      attrText = d.attributes.get(selAttrName);\n\t    }\n\n\t    /* Set label text. */\n\t    if (typeof attrText !== 'undefined') {\n\t      d3.select(_this11).text(attrText);\n\t      var trimRatio = parseInt(attrText.length * (maxLabelPixelWidth / _this11.getComputedTextLength()), 10);\n\t      if (trimRatio < attrText.length) {\n\t        d3.select(_this11).text(attrText.substr(0, trimRatio - 3) + '...');\n\t      }\n\t    }\n\t  });\n\t}\n\n\t/**\n\t * Clears node selection.\n\t */\n\tfunction clearNodeSelection() {\n\t  var _this12 = this;\n\n\t  domNodeset.each(function (d) {\n\t    d.selected = false;\n\t    d.doi.selectedChanged();\n\t    d3.select('#nodeId-' + d.autoId).classed('selectedNode', false);\n\t    $('#nodeId-' + d.autoId).find('.glyph').find('rect, circle').css('stroke', colorStrokes);\n\t  });\n\n\t  $('#nodeInfoTitle').html('Select a node: - ');\n\t  $('#nodeInfoTitleLink').html('');\n\t  $('#' + 'provenance-nodeInfo-content').html('');\n\n\t  selectedNodeSet = d3.map();\n\n\t  $('.filteredNode').hover(function () {\n\t    $(this).find('rect, circle').css('stroke', colorHighlight);\n\t  }, function () {\n\t    $(_this12).find('rect, circle').css('stroke', colorStrokes);\n\t  });\n\t}\n\n\t/**\n\t * Left click on a node to select and reveal additional details.\n\t * @param d Node\n\t */\n\tfunction handleNodeSelection(d) {\n\t  var _this13 = this;\n\n\t  clearNodeSelection();\n\t  d.selected = true;\n\t  propagateNodeSelection(d, true);\n\t  selectedNodeSet.set(d.autoId, d);\n\t  d3.select('#nodeId-' + d.autoId).classed('selectedNode', d.selected).select('.glyph').select('rect, circle').style('stroke', colorHighlight);\n\n\t  $('#nodeId-' + d.autoId).hover(function () {\n\t    $(this).find('rect, circle').css('stroke', colorHighlight);\n\t  }, function () {\n\t    $(_this13).find('rect, circle').css('stroke', colorHighlight);\n\t  });\n\n\t  d.doi.selectedChanged();\n\t  if (doiAutoUpdate) {\n\t    recomputeDOI();\n\t  }\n\t}\n\n\t/* TODO: Clean up. */\n\t/* TODO: May add bounding box color. */\n\t/**\n\t * Colorcoding view.\n\t */\n\tfunction drawColorcodingView() {\n\t  var wfColorScale = d3.scale.category10();\n\t  var wfColorData = d3.map();\n\n\t  wfColorData.set('dataset', 0);\n\t  var wfIndex = 1;\n\t  vis$1.graph.workflowData.values().forEach(function (wf) {\n\t    var wfName = wf.name;\n\t    if (wf.name.substr(0, 15) === 'Test workflow: ') {\n\t      wfName = wf.name.substr(15, wf.name.length - 15);\n\t    }\n\t    if (wfName.indexOf('(') > 0) {\n\t      wfName = wfName.substr(0, wfName.indexOf('('));\n\t    }\n\t    if (wfName.indexOf('-') > 0) {\n\t      wfName = wfName.substr(0, wfName.indexOf('-'));\n\t    }\n\t    if (!wfColorData.has(wfName)) {\n\t      wfColorData.set(wfName, wfIndex);\n\t      wfIndex++;\n\t    }\n\t    wf.code = wfName;\n\t  });\n\n\t  wfColorData.entries().forEach(function (wf, i) {\n\t    var wfName = wf.key;\n\n\t    $('<tr/>', {\n\t      id: 'provvis-cc-wf-tr-' + i\n\t    }).appendTo('#prov-ctrl-cc-workflow-content');\n\n\t    $('<td/>', {\n\t      id: 'provvis-cc-wf-td-' + i\n\t    }).appendTo('#provvis-cc-wf-tr-' + i);\n\n\t    $('<label/>', {\n\t      id: 'provvis-cc-wf-label-' + i,\n\t      class: 'provvis-cc-label',\n\t      html: '<input id=\"provvis-cc-wf-color-' + i + '\" type=\"text\">' + wfName\n\t    }).appendTo('#provvis-cc-wf-td-' + i);\n\n\t    $('<em/>', {\n\t      id: 'provvis-cc-wf-hex-' + i,\n\t      class: 'provvis-cc-hide-hex',\n\t      html: wfColorScale(wf.value)\n\t    }).appendTo('#provvis-cc-wf-label-' + i);\n\n\t    /* Change event. */\n\t    $('#provvis-cc-wf-color-' + i).spectrum({\n\t      color: wfColorScale(wf.value),\n\t      showAlpha: false,\n\t      change: function change(color) {\n\t        $('#provvis-cc-wf-hex-' + i).text(color.toHexString());\n\t        switchColorScheme('workflow');\n\t      }\n\t    });\n\t  });\n\n\t  function updateStrokesColor(color) {\n\t    $('#provvis-cc-strokes-hex').text(color);\n\t    link.style({\n\t      stroke: color\n\t    });\n\t    domNodeset.style({\n\t      stroke: color\n\t    });\n\t    $('.glAnchor, .grAnchor').css({\n\t      stroke: color,\n\t      fill: color\n\t    });\n\t  }\n\n\t  function updateHighlightColor(color) {\n\t    var _this14 = this;\n\n\t    $('#provvis-cc-highlight-hex').text(color);\n\t    hLink.style({\n\t      stroke: color\n\t    });\n\n\t    $('.filteredNode').hover(function () {\n\t      $(this).find('rect, circle').css({\n\t        stroke: color\n\t      });\n\t    }, function () {\n\t      $(_this14).find('rect, circle').css({\n\t        stroke: colorStrokes\n\t      });\n\t    });\n\n\t    $('.glAnchor, .grAnchor').hover(function () {\n\t      $(this).css({\n\t        stroke: color,\n\t        fill: color\n\t      });\n\t    }, function () {\n\t      $(_this14).css({\n\t        stroke: colorStrokes,\n\t        fill: colorStrokes\n\t      });\n\t    });\n\t  }\n\n\t  /* Change events. */\n\t  $('#provvis-cc-strokes').spectrum({\n\t    color: '#136382',\n\t    showAlpha: true,\n\t    change: function change(color) {\n\t      colorStrokes = color.toHexString();\n\t      updateStrokesColor(colorStrokes);\n\t      updateHighlightColor(colorHighlight);\n\t    }\n\t  });\n\n\t  $('#provvis-cc-highlight').spectrum({\n\t    color: '#ed7407',\n\t    showAlpha: true,\n\t    change: function change(color) {\n\t      colorHighlight = color.toHexString();\n\t      updateHighlightColor(colorHighlight);\n\t    }\n\t  });\n\n\t  $('#provvis-cc-layer').spectrum({\n\t    color: '#1f77b4',\n\t    showAlpha: true,\n\t    change: function change(color) {\n\t      $('#provvis-cc-layer-hex').text(color.toHexString());\n\t      switchColorScheme('nodetype');\n\t    }\n\t  });\n\n\t  $('#provvis-cc-analysis').spectrum({\n\t    color: '#2ca02c',\n\t    showAlpha: true,\n\t    change: function change(color) {\n\t      $('#provvis-cc-analysis-hex').text(color.toHexString());\n\t      switchColorScheme('nodetype');\n\t    }\n\t  });\n\n\t  $('#provvis-cc-subanalysis').spectrum({\n\t    color: '#d62728',\n\t    showAlpha: true,\n\t    change: function change(color) {\n\t      $('#provvis-cc-subanalysis-hex').text(color.toHexString());\n\t      switchColorScheme('nodetype');\n\t    }\n\t  });\n\n\t  $('#provvis-cc-special').spectrum({\n\t    color: '#17becf',\n\t    showAlpha: true,\n\t    change: function change(color) {\n\t      $('#provvis-cc-special-hex').text(color.toHexString());\n\t      switchColorScheme('nodetype');\n\t    }\n\t  });\n\n\t  $('#provvis-cc-dt').spectrum({\n\t    color: '#7f7f7f',\n\t    showAlpha: true,\n\t    change: function change(color) {\n\t      $('#provvis-cc-dt-hex').text(color.toHexString());\n\t      switchColorScheme('nodetype');\n\t    }\n\t  });\n\n\t  $('#provvis-cc-intermediate').spectrum({\n\t    color: '#bcbd22',\n\t    showAlpha: true,\n\t    change: function change(color) {\n\t      $('#provvis-cc-intermediate-hex').text(color.toHexString());\n\t      switchColorScheme('nodetype');\n\t    }\n\t  });\n\n\t  $('#provvis-cc-stored').spectrum({\n\t    color: '#8c564b',\n\t    showAlpha: true,\n\t    change: function change(color) {\n\t      $('#provvis-cc-stored-hex').text(color.toHexString());\n\t      switchColorScheme('nodetype');\n\t    }\n\t  });\n\n\t  /* On accordion header click. */\n\t  $('[id^=prov-ctrl-cc-none-]').on('click', function () {\n\t    switchColorScheme('none');\n\t  });\n\n\t  $('[id^=prov-ctrl-cc-time-]').on('click', function () {\n\t    switchColorScheme('time');\n\t  });\n\n\t  $('[id^=prov-ctrl-cc-workflow-]').on('click', function () {\n\t    switchColorScheme('workflow');\n\t  });\n\n\t  $('[id^=prov-ctrl-cc-nodetype-]').on('click', function () {\n\t    switchColorScheme('nodetype');\n\t  });\n\n\t  /**\n\t   * Helper function to switch color scheme.\n\t   * @param checkedColor Color scheme.\n\t   */\n\t  function switchColorScheme(checkedColor) {\n\t    switch (checkedColor) {\n\t      case 'none':\n\t        domNodeset.select('.glyph').selectAll('rect, circle').style('fill', '#ffffff');\n\t        domNodeset.selectAll('.anLabel, .sanLabel, .anwfLabel, ' + '.sanwfLabel, .an-node-type-icon, .san-node-type-icon').style('fill', '#000000');\n\t        lNode.selectAll('.lnLabel, .wfLabel, .l-node-type-icon').style('fill', '#000000');\n\t        break;\n\t      case 'time':\n\t        lNode.each(function (l) {\n\t          d3.select('#nodeId-' + l.autoId).select('.glyph').selectAll('rect').style('fill', 'url(#layerGradientId-' + l.autoId + ')');\n\t        });\n\t        lNode.selectAll('.lnLabel, .wfLabel, .l-node-type-icon').style('fill', function (l) {\n\t          var latestDate = d3.min(l.children.values(), function (d) {\n\t            return d.start;\n\t          });\n\t          return timeColorScale(parseISOTimeFormat(latestDate)) < '#888888' ? '#ffffff' : '#000000';\n\t        });\n\n\t        aNode.select('.glyph').selectAll('rect, circle').style('fill', function (d) {\n\t          return timeColorScale(parseISOTimeFormat(d.start));\n\t        });\n\t        aNode.selectAll('.anLabel, .anwfLabel, .an-node-type-icon').style('fill', function (an) {\n\t          return timeColorScale(parseISOTimeFormat(an.start)) < '#888888' ? '#ffffff' : '#000000';\n\t        });\n\n\t        saNode.select('.glyph').selectAll('rect, circle').style('fill', function (d) {\n\t          return timeColorScale(parseISOTimeFormat(d.parent.start));\n\t        });\n\n\t        saNode.selectAll('.sanLabel, .sanwfLabel, .san-node-type-icon').style('fill', function (san) {\n\t          return timeColorScale(parseISOTimeFormat(san.parent.start)) < '#888888' ? '#ffffff' : '#000000';\n\t        });\n\n\t        node.select('.glyph').selectAll('rect, circle').style('fill', function (d) {\n\t          return timeColorScale(parseISOTimeFormat(d.parent.parent.start));\n\t        });\n\n\t        node.selectAll('.stored-node-type-icon').style('fill', function (n) {\n\t          return timeColorScale(parseISOTimeFormat(n.parent.parent.start)) < '#888888' ? '#ffffff' : '#000000';\n\t        });\n\t        break;\n\t      case 'workflow':\n\t        {\n\t          var _ret9 = function () {\n\t            var wfc = function wfc(i) {\n\t              return $('#provvis-cc-wf-hex-' + i).text();\n\t            };\n\n\t            domNodeset.each(function (d) {\n\t              var cur = d;\n\t              while (!(cur instanceof Layer)) {\n\t                cur = cur.parent;\n\t              }\n\t              d3.select('#nodeId-' + d.autoId).select('.glyph').selectAll('rect, circle').style('fill', wfc(wfColorData.get(cur.wfCode)));\n\t            });\n\t            domNodeset.selectAll('.anLabel, .sanLabel, .anwfLabel, ' + '.sanwfLabel, .an-node-type-icon, .san-node-type-icon').style('fill', '#000000');\n\t            lNode.selectAll('.lnLabel, .wfLabel, .l-node-type-icon').style('fill', '#000000');\n\t            return 'break';\n\t          }();\n\n\t          if (_ret9 === 'break') break;\n\t        }\n\t      case 'nodetype':\n\t        {\n\t          var _ret10 = function () {\n\t            var nt = function nt(t) {\n\t              return $('#provvis-cc-' + t + '-hex').text();\n\t            };\n\n\t            domNodeset.each(function (d) {\n\t              d3.select('#nodeId-' + d.autoId).select('.glyph').selectAll('rect, circle').style('fill', nt(d.nodeType));\n\t            });\n\t            domNodeset.selectAll('.anLabel, .sanLabel, .anwfLabel, ' + '.sanwfLabel, .an-node-type-icon, .san-node-type-icon').style('fill', '#000000');\n\t            lNode.selectAll('.lnLabel, .wfLabel, .l-node-type-icon').style('fill', '#000000');\n\t            node.selectAll('.stored-node-type-icon').style('fill', '#ffffff');\n\t            return 'break';\n\t          }();\n\n\t          if (_ret10 === 'break') break;\n\t        }\n\t    }\n\t  }\n\t}\n\n\t/* TODO: Left clicking on href links doesn't trigger the download. */\n\t/**\n\t * Update node info tab on node selection.\n\t * @param selNode Selected node.\n\t */\n\tfunction updateNodeInfoTab(selNode) {\n\t  var title = ' - ';\n\t  var titleLink = ' - ';\n\t  var data = Object.create(null);\n\t  var nodeDiff = d3.map();\n\t  var diffNegIns = 0;\n\t  var diffPosIns = 0;\n\t  var diffNegSA = 0;\n\t  var diffPosSA = 0;\n\t  var diffNegOuts = 0;\n\t  var diffPosOuts = 0;\n\n\t  switch (selNode.nodeType) {\n\t    case 'raw':\n\t    case 'special':\n\t    case 'intermediate':\n\t    case 'stored':\n\t      data = vis$1.graph.nodeData.get(selNode.uuid);\n\t      if (typeof data !== 'undefined') {\n\t        title = '<i class=\"fa fa-sitemap rotate-icon-90\"></i>&nbsp;' + selNode.fileType;\n\t        if (data.file_url !== null) {\n\t          /* TODO: Trigger download without window.open. */\n\t          titleLink = '<a title=\"Download linked file\" href=\"' + data.file_url + '\" onclick=window.open(\"' + data.file_url + '\")>' + '<i class=\"fa fa-arrow-circle-o-down\"></i>&nbsp;' + data.name + '</a>';\n\t        } else {\n\t          titleLink = ' - ';\n\t        }\n\t      }\n\t      break;\n\n\t    case 'dt':\n\t      /* TODO: Add tool_state parameters column. */\n\t      /* From parent workflow steps attribute, extract step by id.\n\t       * let steps = vis.graph.workflowData\n\t       * .get(selNode.parent.wfUuid).steps; */\n\n\t      data = vis$1.graph.nodeData.get(selNode.uuid);\n\t      if (typeof data !== 'undefined') {\n\t        title = '<i class=\"fa fa-sitemap rotate-icon-90\"></i>&nbsp;' + selNode.fileType;\n\t        if (data.file_url !== null) {\n\t          /* TODO: Trigger download without window.open. */\n\t          titleLink = '<a title=\"Download linked file\" href=\"' + data.file_url + '\" onclick=window.open(\"' + data.file_url + '\")>' + '<i class=\"fa fa-arrow-circle-o-down\"></i>&nbsp;' + data.name + '</a>';\n\t        }\n\t      }\n\t      break;\n\n\t    case 'subanalysis':\n\t      data = vis$1.graph.workflowData.get(selNode.parent.wfUuid);\n\t      if (typeof data !== 'undefined') {\n\t        title = '<i class=\"fa fa-cog\"></i>&nbsp; Analysis Group';\n\t        titleLink = '<a href=/workflows/' + selNode.wfUuid + ' target=\"_blank\">' + selNode.parent.wfName + '</a>';\n\t      } else {\n\t        title = '<i class=\"fa fa-cog\"></i>&nbsp; Dataset';\n\t      }\n\n\t      if (selNode.parent.motifDiff.numIns !== 0 || selNode.parent.motifDiff.numOuts !== 0 || selNode.parent.motifDiff.numSubanalyses !== 0) {\n\t        if (selNode.parent.motifDiff.numIns < 0) {\n\t          diffNegIns += selNode.parent.motifDiff.numIns;\n\t        } else {\n\t          diffPosIns += selNode.parent.motifDiff.numIns;\n\t        }\n\t        if (selNode.parent.motifDiff.numSubanalyses < 0) {\n\t          diffNegSA += selNode.parent.motifDiff.numSubanalyses;\n\t        } else {\n\t          diffPosSA += selNode.parent.motifDiff.numSubanalyses;\n\t        }\n\t        if (selNode.parent.motifDiff.numOuts < 0) {\n\t          diffNegOuts += selNode.parent.motifDiff.numOuts;\n\t        } else {\n\t          diffPosOuts += selNode.parent.motifDiff.numOuts;\n\t        }\n\t      }\n\t      break;\n\n\t    case 'analysis':\n\t      data = vis$1.graph.analysisData.get(selNode.uuid);\n\t      if (typeof data !== 'undefined') {\n\t        title = '<i class=\"fa fa-cogs\"></i>&nbsp; Analysis';\n\t        titleLink = '<a href=/workflows/' + selNode.wfUuid + ' target=\"_blank\">' + selNode.wfName + '</a>';\n\t      } else {\n\t        title = '<i class=\"fa fa-cogs\"></i>&nbsp; Dataset';\n\t      }\n\t      if (selNode.motifDiff.numIns !== 0 || selNode.motifDiff.numOuts !== 0 || selNode.motifDiff.numSubanalyses !== 0) {\n\t        if (selNode.motifDiff.numIns < 0) {\n\t          diffNegIns += selNode.motifDiff.numIns;\n\t        } else {\n\t          diffPosIns += selNode.motifDiff.numIns;\n\t        }\n\t        if (selNode.motifDiff.numSubanalyses < 0) {\n\t          diffNegSA += selNode.motifDiff.numSubanalyses;\n\t        } else {\n\t          diffPosSA += selNode.motifDiff.numSubanalyses;\n\t        }\n\t        if (selNode.motifDiff.numOuts < 0) {\n\t          diffNegOuts += selNode.motifDiff.numOuts;\n\t        } else {\n\t          diffPosOuts += selNode.motifDiff.numOuts;\n\t        }\n\t      }\n\t      break;\n\n\t    case 'layer':\n\t      data = {\n\t        aggregation_count: selNode.children.size(),\n\t        workflow: selNode.wfName,\n\t        subanalysis_count: selNode.motif.numSubanalyses,\n\t        wfUuid: selNode.motif.wfUuid\n\t      };\n\n\t      if (typeof data !== 'undefined') {\n\t        title = '<i class=\"fa fa-bars\"></i>&nbsp; Layer';\n\t        titleLink = '<a href=/workflows/' + data.wfUuid + ' target=\"_blank\">' + data.workflow + '</a>';\n\t      }\n\t      if (selNode.children.values().some(function (an) {\n\t        return an.motifDiff.numIns !== 0 || an.motifDiff.numOuts !== 0 || an.motifDiff.numSubanalyses !== 0;\n\t      })) {\n\t        selNode.children.values().forEach(function (an) {\n\t          if (an.motifDiff.numIns < 0) {\n\t            diffNegIns += an.motifDiff.numIns;\n\t          } else {\n\t            diffPosIns += an.motifDiff.numIns;\n\t          }\n\t          if (an.motifDiff.numSubanalyses < 0) {\n\t            diffNegSA += an.motifDiff.numSubanalyses;\n\t          } else {\n\t            diffPosSA += an.motifDiff.numSubanalyses;\n\t          }\n\t          if (an.motifDiff.numOuts < 0) {\n\t            diffNegOuts += an.motifDiff.numOuts;\n\t          } else {\n\t            diffPosOuts += an.motifDiff.numOuts;\n\t          }\n\t        });\n\t      }\n\t      break;\n\t  }\n\n\t  /* Add diff info to data. */\n\t  if (diffNegIns !== 0 || diffPosIns !== 0) {\n\t    nodeDiff.set('Diff: Inputs', diffNegIns + ' ' + diffPosIns);\n\t  }\n\t  if (diffNegSA !== 0 || diffPosSA !== 0) {\n\t    nodeDiff.set('Diff: Subanalyses', diffNegSA + ' ' + diffPosSA);\n\t  }\n\t  if (diffNegOuts !== 0 || diffPosOuts !== 0) {\n\t    nodeDiff.set('Diff: Outputs', diffNegOuts + ' ' + diffPosOuts);\n\t  }\n\n\t  $('#nodeInfoTitle').html(title);\n\t  $('#nodeInfoTitleLink').html(titleLink);\n\n\t  $('#' + 'provenance-nodeInfo-content').html('');\n\t  nodeDiff.entries().forEach(function (d) {\n\t    $('<div/>', {\n\t      class: 'refinery-subheader',\n\t      html: '<h4>' + d.key + '</h4>'\n\t    }).appendTo('#' + 'provenance-nodeInfo-content');\n\t    $('<p/>', {\n\t      class: 'provvisNodeInfoValue provvisNodeInfoDiff',\n\t      html: '<i><b>' + d.value + '</b></i>'\n\t    }).appendTo('#' + 'provenance-nodeInfo-content');\n\t  });\n\n\t  d3.entries(data).forEach(function (d) {\n\t    $('<div/>', {\n\t      class: 'refinery-subheader',\n\t      html: '<h4>' + d.key + '</h4>'\n\t    }).appendTo('#' + 'provenance-nodeInfo-content');\n\t    $('<p/>', {\n\t      class: 'provvisNodeInfoValue',\n\t      html: '<i>' + d.value + '</i>'\n\t    }).appendTo('#' + 'provenance-nodeInfo-content');\n\t  });\n\t}\n\n\t/**\n\t * Get workflow name string.\n\t * @param n Node of type BaseNode.\n\t * @returns {string} The name string.\n\t */\n\tfunction getWfNameByNode(n) {\n\t  var wfName = 'dataset';\n\t  var an = n;\n\t  while (!(an instanceof Analysis)) {\n\t    an = an.parent;\n\t  }\n\t  if (typeof vis$1.graph.workflowData.get(an.wfUuid) !== 'undefined') {\n\t    wfName = vis$1.graph.workflowData.get(an.wfUuid).name;\n\t  }\n\t  return wfName.toString();\n\t}\n\n\t/**\n\t * Adds tooltips to nodes.\n\t */\n\tfunction handleTooltips() {\n\t  var _this15 = this;\n\n\t  /**\n\t   * Helper function for tooltip creation.\n\t   * @param key Property name.\n\t   * @param value Property value.\n\t   * @returns {string} Inner html code.\n\t   */\n\t  function createHTMLKeyValuePair(key, value) {\n\t    return '<b>' + key + ': ' + '</b>' + value;\n\t  }\n\n\t  /* Node tooltips. */\n\t  node.on('mouseover', function (d) {\n\t    var self = d3.select(_this15);\n\t    var ttStr = createHTMLKeyValuePair('Name', d.name) + '<br>' + createHTMLKeyValuePair('Type', d.fileType) + '<br>' + createHTMLKeyValuePair('File Url', d.fileUrl) + '<br>' + createHTMLKeyValuePair('UUID', d.uuid) + '<br>';\n\t    d.attributes.forEach(function (key, value) {\n\t      ttStr += createHTMLKeyValuePair(key, value) + '<br>';\n\t    });\n\t    showTooltip(tooltip, ttStr, event);\n\n\t    d.parent.parent.parent.children.values().forEach(function (sibling) {\n\t      d3.select('#BBoxId-' + sibling.autoId).style('stroke-opacity', 0.3);\n\t    });\n\t    d3.select('#BBoxId-' + d.parent.autoId).classed('mouseoverBBox', true);\n\t    self.select('.labels').attr('clip-path', '');\n\n\t    /* Get current node label pixel width. */\n\t    var attrText = d.label === '' ? d.name : d.label;\n\t    if (d.nodeType === 'stored') {\n\t      var selAttrName = '';\n\t      $('#prov-ctrl-visible-attribute-list > li').each(function () {\n\t        if ($(_this15).find('input[type=\\'radio\\']').prop('checked')) {\n\t          selAttrName = $(_this15).find('label').text();\n\t        }\n\t      });\n\t      attrText = d.attributes.get(selAttrName);\n\t    }\n\n\t    /* Set label text. */\n\t    self.select('.nodeAttrLabel').text(attrText);\n\n\t    d3.selectAll('.node:not(#nodeId-' + d.autoId + ')').selectAll('.nodeAttrLabel').transition().duration(nodeLinkTransitionTime).attr('opacity', 0);\n\t  }).on('mousemove', function (d) {\n\t    var ttStr = createHTMLKeyValuePair('Name', d.name) + '<br>' + createHTMLKeyValuePair('Type', d.fileType) + '<br>' + createHTMLKeyValuePair('File Url', d.fileUrl) + '<br>' + createHTMLKeyValuePair('UUID', d.uuid) + '<br>';\n\t    d.attributes.forEach(function (key, value) {\n\t      ttStr += createHTMLKeyValuePair(key, value) + '<br>';\n\t    });\n\t    d3.select('#BBoxId-' + d.parent.autoId).classed('mouseoverBBox', true);\n\t    showTooltip(tooltip, ttStr, event);\n\t  }).on('mouseout', function (d) {\n\t    var self = d3.select(_this15);\n\t    hideTooltip(tooltip);\n\n\t    d.parent.parent.parent.children.values().forEach(function (sibling) {\n\t      d3.select('#BBoxId-' + sibling.autoId).style('stroke-opacity', 0.0);\n\t    });\n\t    d3.select('#BBoxId-' + d.parent.autoId).classed('mouseoverBBox', false);\n\t    self.select('.labels').attr('clip-path', 'url(#bbClipId-' + d.autoId + ')');\n\n\t    /* Get current node label pixel width. */\n\t    var maxLabelPixelWidth = (cell.width - 2 * scaleFactor * vis$1.radius) * d3.transform(d3.select('.canvas').select('g').select('g').attr('transform')).scale[0];\n\t    var attrText = d.label === '' ? d.name : d.label;\n\t    if (d.nodeType === 'stored') {\n\t      var selAttrName = '';\n\t      $('#prov-ctrl-visible-attribute-list > li').each(function () {\n\t        if ($(_this15).find('input[type=\\'radio\\']').prop('checked')) {\n\t          selAttrName = $(_this15).find('label').text();\n\t        }\n\t      });\n\t      attrText = d.attributes.get(selAttrName);\n\t    }\n\n\t    /* Set label text. */\n\t    if (typeof attrText !== 'undefined') {\n\t      self.select('.nodeAttrLabel').text(attrText);\n\t      var trimRatio = parseInt(attrText.length * (maxLabelPixelWidth / self.select('.nodeAttrLabel').node().getComputedTextLength()), 10);\n\t      if (trimRatio < attrText.length) {\n\t        self.select('.nodeAttrLabel').text(attrText.substr(0, trimRatio - 3) + '...');\n\t      }\n\t    }\n\n\t    d3.selectAll('.nodeAttrLabel').transition().duration(nodeLinkTransitionTime).attr('opacity', 1);\n\t  });\n\n\t  /* Subanalysis tooltips. */\n\t  saNode.on('mouseover', function (d) {\n\t    var self = d3.select(_this15);\n\t    self.select('.labels').attr('clip-path', '');\n\t    d.parent.parent.children.values().forEach(function (sibling) {\n\t      d3.select('#BBoxId-' + sibling.autoId).style('stroke-opacity', 0.3);\n\t    });\n\t  }).on('mouseout', function (d) {\n\t    var self = d3.select(_this15);\n\t    self.select('.labels').attr('clip-path', 'url(#bbClipId-' + d.autoId + ')');\n\t    d.parent.parent.children.values().forEach(function (sibling) {\n\t      d3.select('#BBoxId-' + sibling.autoId).style('stroke-opacity', 0.0);\n\t    });\n\t  });\n\n\t  /* Analysis tolltips. */\n\t  aNode.on('mouseover', function (d) {\n\t    var self = d3.select(_this15);\n\t    self.select('.labels').attr('clip-path', '');\n\t    d.parent.children.values().forEach(function (sibling) {\n\t      d3.select('#BBoxId-' + sibling.autoId).style('stroke-opacity', 0.3);\n\t    });\n\t  }).on('mouseout', function (d) {\n\t    var self = d3.select(_this15);\n\t    self.select('.labels').attr('clip-path', 'url(#bbClipId-' + d.autoId + ')');\n\t    d.parent.children.values().forEach(function (sibling) {\n\t      d3.select('#BBoxId-' + sibling.autoId).style('stroke-opacity', 0.0);\n\t    });\n\t  });\n\n\t  /* Layer . */\n\t  lNode.on('mouseover', function () {\n\t    var self = d3.select(_this15);\n\t    self.select('.labels').select('.wfLabel').attr('clip-path', '');\n\t  }).on('mouseout', function (d) {\n\t    var self = d3.select(_this15);\n\t    self.select('.labels').select('.wfLabel').attr('clip-path', 'url(#bbClipId-' + d.autoId + ')');\n\t  });\n\n\t  /* On mouseover subanalysis bounding box. */\n\t  saBBox.on('mouseover', function (d) {\n\t    var self = d3.select(_this15);\n\t    self.classed('mouseoverBBox', true);\n\t    d.parent.parent.children.values().forEach(function (sibling) {\n\t      d3.select('#BBoxId-' + sibling.autoId).style('stroke-opacity', 0.3);\n\t    });\n\t    self.select('.labels').attr('clip-path', '');\n\t  }).on('mouseout', function (d) {\n\t    var self = d3.select(_this15);\n\t    self.classed('mouseoverBBox', false);\n\t    d.parent.parent.children.values().forEach(function (sibling) {\n\t      d3.select('#BBoxId-' + sibling.autoId).style('stroke-opacity', 0.0);\n\t    });\n\t    self.select('.labels').attr('clip-path', 'url(#saBBClipId-' + d.autoId + ')');\n\t  });\n\n\t  /* On mouseover analysis bounding box. */\n\t  aBBox.on('mouseover', function (an) {\n\t    var self = d3.select(_this15);\n\t    self.select('.labels').attr('clip-path', '');\n\t    an.parent.children.values().forEach(function (sibling) {\n\t      d3.select('#BBoxId-' + sibling.autoId).style('stroke-opacity', 0.3);\n\t    });\n\t  }).on('mouseout', function (an) {\n\t    var self = d3.select(_this15);\n\t    self.select('.labels').attr('clip-path', 'url(#aBBClipId-' + an.autoId + ')');\n\t    an.parent.children.values().forEach(function (sibling) {\n\t      d3.select('#BBoxId-' + sibling.autoId).style('stroke-opacity', 0.0);\n\t    });\n\t  });\n\n\t  /* On mouseover layer bounding box. */\n\t  lBBox.on('mouseover', function () {\n\t    var self = d3.select(_this15);\n\t    self.select('.labels').attr('clip-path', '');\n\t  }).on('mouseout', function (ln) {\n\t    var self = d3.select(_this15);\n\t    self.select('.labels').attr('clip-path', 'url(#lBBClipId-' + ln.autoId + ')');\n\t  });\n\n\t  /* On mouseover timeline analysis lines. */\n\t  d3.selectAll('.tlAnalysis').on('mouseover', function (an) {\n\t    showTooltip(tooltip, createHTMLKeyValuePair('Created', parseISOTimeFormat(an.start)) + '<br>' + createHTMLKeyValuePair('Workflow', getWfNameByNode(an)) + '<br>', event);\n\t    d3.select('#BBoxId-' + an.autoId).classed('mouseoverTlBBox', true);\n\t  }).on('mousemove', function (an) {\n\t    showTooltip(tooltip, createHTMLKeyValuePair('Created', parseISOTimeFormat(an.start)) + '<br>' + createHTMLKeyValuePair('Workflow', getWfNameByNode(an)) + '<br>', event);\n\t  }).on('mouseout', function (an) {\n\t    hideTooltip(tooltip);\n\t    d3.select('#BBoxId-' + an.autoId).classed('mouseoverTlBBox', false);\n\t  });\n\t}\n\n\t/**\n\t * Expand all analsyes into workflow nodes.\n\t */\n\tfunction showAllWorkflows() {\n\t  var _this16 = this;\n\n\t  /* Set node visibility. */\n\t  lNode.each(function (ln) {\n\t    ln.hidden = true;\n\t  });\n\t  lNode.classed('hiddenNode', true);\n\t  aNode.each(function (an) {\n\t    an.hidden = true;\n\t  });\n\t  aNode.classed('hiddenNode', true);\n\t  saNode.each(function (san) {\n\t    san.hidden = true;\n\t  });\n\t  saNode.classed('hiddenNode', true);\n\t  node.each(function (n) {\n\t    n.hidden = false;\n\t  });\n\t  node.classed('hiddenNode', false);\n\n\t  /* Bounding box visibility. */\n\t  saBBox.each(function (san) {\n\t    if (san.filtered && san.children.values().some(function (cn) {\n\t      return !cn.hidden;\n\t    })) {\n\t      d3.select(_this16).classed('hiddenBBox', false);\n\t    } else {\n\t      d3.select(_this16).classed('hiddenBBox', true);\n\t    }\n\t  });\n\n\t  /* Layer exaggeration label control. */\n\t  aBBox.each(function (an) {\n\t    if (an.filtered && an.parent.hidden) {\n\t      d3.select(_this16).classed('hiddenBBox', false);\n\t      d3.select(_this16).select('text').classed('hiddenLabel', false);\n\t    }\n\t  });\n\n\t  aNode.each(function (an) {\n\t    /* Adjust dataset subanalysis coords. */\n\t    if (an.uuid === 'dataset') {\n\t      (function () {\n\t        var yOffset = 0;\n\t        an.children.values().sort(function (a, b) {\n\t          return a.y - b.y;\n\t        }).forEach(function (san) {\n\t          var wfBBoxCoords = getWFBBoxCoords(san, cell, 0);\n\t          san.y = yOffset;\n\t          yOffset += wfBBoxCoords.y.max - wfBBoxCoords.y.min;\n\t          san.x = 0;\n\t          /* TODO: May cause problems. Revise! */\n\t          updateNode(d3.select('#gNodeId-' + san.autoId), san, san.x, san.y);\n\t        });\n\t      })();\n\t    } else {\n\t      (function () {\n\t        /* Adjust subanalysis coords. */\n\t        var wfBBoxCoords = getWFBBoxCoords(an.children.values()[0], cell, 0);\n\t        an.children.values().sort(function (a, b) {\n\t          return a.y - b.y;\n\t        }).forEach(function (san, i) {\n\t          san.y = i * (wfBBoxCoords.y.max - wfBBoxCoords.y.min);\n\t          san.x = 0;\n\t          /* TODO: May cause problems. Revise! */\n\t          updateNode(d3.select('#gNodeId-' + san.autoId), san, san.x, san.y);\n\t        });\n\t      })();\n\t    }\n\n\t    /* Adjust analysis bounding box. */\n\t    var anBBoxCoords = getABBoxCoords(an, cell, 0);\n\t    d3.selectAll('#BBoxId-' + an.autoId + ', #aBBClipId-' + an.autoId).selectAll('rect').attr('width', anBBoxCoords.x.max - anBBoxCoords.x.min).attr('height', anBBoxCoords.y.max - anBBoxCoords.y.min);\n\t    d3.select('#BBoxId-' + an.autoId).classed('hiddenBBox', false);\n\n\t    if (!an.filtered) {\n\t      d3.select('#BBoxId-' + an.autoId).classed('hiddenBBox', true);\n\t    }\n\t  });\n\n\t  /* Set link visibility. */\n\t  link.each(function (l) {\n\t    l.hidden = false;\n\t  });\n\t  link.classed('hiddenLink', false);\n\n\t  link.each(function (l) {\n\t    if (l.filtered) {\n\t      l.hidden = false;\n\t      if (l.highlighted) {\n\t        d3.select('#hLinkId-' + l.autoId).classed('hiddenLink', false);\n\t      }\n\t    } else {\n\t      if (filterAction === 'hide') {\n\t        l.hidden = true;\n\t        d3.select('#hLinkId-' + l.autoId).classed('hiddenLink', true);\n\t      } else {\n\t        l.hidden = false;\n\t        if (l.highlighted) {\n\t          d3.select('#hLinkId-' + l.autoId).classed('hiddenLink', false);\n\t        }\n\t      }\n\t    }\n\t  });\n\n\t  lLink.each(function (l) {\n\t    l.hidden = true;\n\t  });\n\t  lLink.classed('hiddenLink', true);\n\t}\n\n\t/**\n\t * Collapse all analyses into single subanalysis nodes.\n\t */\n\tfunction showAllSubanalyses() {\n\t  /* Set node visibility. */\n\t  lNode.each(function (ln) {\n\t    ln.hidden = true;\n\t  });\n\t  lNode.classed('hiddenNode', true);\n\t  aNode.each(function (an) {\n\t    an.hidden = true;\n\t  });\n\t  aNode.classed('hiddenNode', true);\n\t  saNode.each(function (san) {\n\t    san.hidden = false;\n\t  });\n\t  saNode.classed('hiddenNode', false);\n\t  node.each(function (n) {\n\t    n.hidden = true;\n\t  });\n\t  node.classed('hiddenNode', true);\n\n\t  /* Bounding box visibility. */\n\t  saBBox.classed('hiddenBBox', true);\n\n\t  aNode.each(function (an) {\n\t    /* Adjust subanalysis coords. */\n\t    an.children.values().sort(function (a, b) {\n\t      return a.y - b.y;\n\t    }).forEach(function (san, i) {\n\t      san.y = i * vis$1.cell.height;\n\t      san.x = 0;\n\t      updateNode(d3.select('#gNodeId-' + san.autoId), san, san.x, san.y);\n\t    });\n\n\t    /* Adjust analysis bounding box. */\n\t    var anBBoxCoords = getABBoxCoords(an, cell, 0);\n\t    d3.selectAll('#BBoxId-' + an.autoId + ', #aBBClipId-' + an.autoId).selectAll('rect').attr('width', vis$1.cell.width).attr('height', anBBoxCoords.y.max - anBBoxCoords.y.min);\n\t    d3.select('#BBoxId-' + an.autoId).classed('hiddenBBox', false);\n\n\t    if (!an.filtered) {\n\t      d3.select('#BBoxId-' + an.autoId).classed('hiddenBBox', true);\n\t    }\n\t  });\n\n\t  /* Link visibility. */\n\t  aNode.each(function (an) {\n\t    an.links.values().forEach(function (l) {\n\t      d3.selectAll('#linkId-' + l.autoId + ', #hLinkId-' + l.autoId).classed('hiddenLink', true);\n\t      l.hidden = true;\n\t    });\n\t    an.inputs.values().forEach(function (ain) {\n\t      ain.predLinks.values().forEach(function (l) {\n\t        d3.select('#linkId-' + l.autoId).classed('hiddenLink', false);\n\t        l.hidden = false;\n\t      });\n\t    });\n\t  });\n\n\t  lLink.each(function (l) {\n\t    l.hidden = true;\n\t  });\n\t  lLink.classed('hiddenLink', true);\n\t}\n\n\t/**\n\t * Collapse all analyses into single analysis nodes.\n\t */\n\tfunction showAllAnalyses() {\n\t  /* Node visibility. */\n\t  lNode.each(function (ln) {\n\t    ln.hidden = true;\n\t  });\n\t  lNode.classed('hiddenNode', true);\n\n\t  aNode.each(function (an) {\n\t    an.hidden = false;\n\t    hideChildNodes(an);\n\n\t    /* Filtered visibility. */\n\t    if (an.filtered) {\n\t      d3.select('#BBoxId-' + an.autoId).classed('hiddenBBox', false);\n\t    }\n\n\t    /* Bounding box size. */\n\t    d3.selectAll('#BBoxId-' + an.autoId + ', #aBBClipId-' + an.autoId).select('rect').attr('width', vis$1.cell.width).attr('height', vis$1.cell.height);\n\n\t    /* Adjust subanalysis coords. */\n\t    an.children.values().sort(function (a, b) {\n\t      return a.y - b.y;\n\t    }).forEach(function (san, i) {\n\t      san.y = i * vis$1.cell.height;\n\t      san.x = 0;\n\t      updateNode(d3.select('#gNodeId-' + san.autoId), san, san.x, san.y);\n\t    });\n\t  });\n\t  aNode.classed('hiddenNode', false);\n\n\t  /* Bounding box visibility. */\n\t  saBBox.classed('hiddenBBox', true);\n\n\t  /* Link visibility. */\n\t  aNode.each(function (an) {\n\t    an.links.values().forEach(function (l) {\n\t      d3.selectAll('#linkId-' + l.autoId + ', #hLinkId-' + l.autoId).classed('hiddenLink', true);\n\t      l.hidden = true;\n\t    });\n\t    an.inputs.values().forEach(function (ain) {\n\t      ain.predLinks.values().forEach(function (l) {\n\t        d3.select('#linkId-' + l.autoId).classed('hiddenLink', false);\n\t        l.hidden = false;\n\t      });\n\t    });\n\t  });\n\n\t  lLink.each(function (l) {\n\t    l.hidden = true;\n\t  });\n\t  lLink.classed('hiddenLink', true);\n\t}\n\n\t/**\n\t * Collapse all nodes into single layer nodes.\n\t */\n\tfunction showAllLayers() {\n\t  var _this17 = this;\n\n\t  /* Node visibility. */\n\t  lNode.each(function (ln) {\n\t    ln.hidden = false;\n\t    hideChildNodes(ln);\n\n\t    /* Layer exaggeration reset. */\n\t    ln.children.values().forEach(function (an) {\n\t      an.exaggerated = false;\n\t    });\n\n\t    /* Filtered visibility. */\n\t    if (ln.filtered) {\n\t      d3.select('BBoxId-' + ln.autoId).classed('hiddenBBox', false);\n\t    }\n\t  });\n\t  lNode.classed('hiddenNode', false);\n\n\t  /* Bounding box visibility. */\n\t  saBBox.classed('hiddenBBox', true);\n\t  aBBox.classed('hiddenBBox', true);\n\n\t  /* Link visibility. */\n\t  aNode.each(function (an) {\n\t    an.links.values().forEach(function (l) {\n\t      d3.selectAll('#linkId-' + l.autoId + ', #hLinkId-' + l.autoId).classed('hiddenLink', true);\n\t      l.hidden = true;\n\t    });\n\n\t    /* Adjust subanalysis coords. */\n\t    an.children.values().sort(function (a, b) {\n\t      return a.y - b.y;\n\t    }).forEach(function (san, i) {\n\t      san.y = i * vis$1.cell.height;\n\t      san.x = 0;\n\t      updateNode(d3.select('#gNodeId-' + san.autoId), san, san.x, san.y);\n\t    });\n\t  });\n\n\t  aLink.each(function (l) {\n\t    l.hidden = true;\n\t  });\n\t  aLink.classed('hiddenLink', true);\n\n\t  lLink.each(function (l) {\n\t    l.hidden = false;\n\t  });\n\t  lLink.classed('hiddenLink', false);\n\n\t  /* Show highlighted alinks. */\n\t  d3.select('.aHLinks').selectAll('.hLink').each(function (l) {\n\t    if (l.highlighted) {\n\t      l.hidden = false;\n\t      d3.select(_this17).classed('hiddenLink', false);\n\t    }\n\t  });\n\t}\n\n\t/**\n\t * Handle interaction controls.\n\t * @param graph Provenance graph object.\n\t */\n\tfunction handleToolbar(graph) {\n\t  var _this18 = this;\n\n\t  $('#prov-ctrl-layers-click').click(function () {\n\t    showAllLayers();\n\t    dagreDynamicLayerLayout(graph);\n\t    if (fitToWindow) {\n\t      fitGraphToWindow(nodeLinkTransitionTime);\n\t    }\n\t  });\n\n\t  $('#prov-ctrl-analyses-click').click(function () {\n\t    showAllAnalyses();\n\t    dagreDynamicLayerLayout(graph);\n\t    if (fitToWindow) {\n\t      fitGraphToWindow(nodeLinkTransitionTime);\n\t    }\n\t  });\n\n\t  $('#prov-ctrl-subanalyses-click').click(function () {\n\t    showAllSubanalyses();\n\t    dagreDynamicLayerLayout(graph);\n\t    if (fitToWindow) {\n\t      fitGraphToWindow(nodeLinkTransitionTime);\n\t    }\n\t  });\n\n\t  $('#prov-ctrl-workflows-click').click(function () {\n\t    showAllWorkflows();\n\t    dagreDynamicLayerLayout(graph);\n\t    if (fitToWindow) {\n\t      fitGraphToWindow(nodeLinkTransitionTime);\n\t    }\n\t  });\n\n\t  /* Switch filter action. */\n\t  $('#prov-ctrl-filter-action > label').click(function () {\n\t    filterAction = $(_this18).find('input[type=\\'radio\\']').prop('value');\n\t    if (filterMethod === 'timeline') {\n\t      filterAnalysesByTime(d3.select('.startTimeline').data()[0].time, d3.select('.endTimeline').data()[0].time, vis$1);\n\t    } else {\n\t      runRenderUpdatePrivate(vis$1, lastSolrResponse);\n\t    }\n\t  });\n\n\t  /* Choose visible node attribute. */\n\t  $('[id^=prov-ctrl-visible-attribute-list-]').click(function () {\n\t    /* Set and get chosen attribute as active. */\n\t    $(_this18).find('input[type=\\'radio\\']').prop('checked', true);\n\t    var selAttrName = $(_this18).find('label').text();\n\n\t    /* On click, set current to active and unselect others. */\n\t    $('#prov-ctrl-visible-attribute-list > li').each(function (idx, li) {\n\t      var item = $(li);\n\t      if (item[0].id !== 'prov-ctrl-visible-attribute-list-' + selAttrName) {\n\t        item.find('input[type=\\'radio\\']').prop('checked', false);\n\t      }\n\t    });\n\n\t    /* Change attribute label on every node. */\n\t    graph.nodes.filter(function (d) {\n\t      return d.nodeType === 'stored';\n\t    }).forEach(function (n) {\n\t      var self = d3.select('#nodeId-' + n.autoId);\n\n\t      var maxLabelPixelWidth = (cell.width - 2 * scaleFactor * vis$1.radius) * d3.transform(d3.select('.canvas').select('g').select('g').attr('transform')).scale[0];\n\t      var attrText = n.name;\n\t      if (n.nodeType === 'stored') {\n\t        var selAttrNamee = '';\n\t        $('#prov-ctrl-visible-attribute-list > li').each(function () {\n\t          if ($(_this18).find('input[type=\\'radio\\']').prop('checked')) {\n\t            selAttrNamee = $(_this18).find('label').text();\n\t          }\n\t        });\n\t        attrText = n.attributes.get(selAttrNamee);\n\t      }\n\n\t      /* Set label text. */\n\t      if (typeof attrText !== 'undefined') {\n\t        self.select('.nodeAttrLabel').text(attrText);\n\t        var trimRatio = parseInt(attrText.length * (maxLabelPixelWidth / self.select('.nodeAttrLabel').node().getComputedTextLength()), 10);\n\t        if (trimRatio < attrText.length) {\n\t          self.select('.nodeAttrLabel').text(attrText.substr(0, trimRatio - 3) + '...');\n\t        }\n\t      }\n\t    });\n\t  });\n\n\t  /* Switch sidebar on or off. */\n\t  $('#prov-ctrl-toggle-sidebar').click(function () {\n\t    if (!$('#prov-ctrl-toggle-sidebar')[0].checked) {\n\t      $('#provenance-sidebar').animate({\n\t        left: '-355'\n\t      }, nodeLinkTransitionTime);\n\t    } else {\n\t      $('#provenance-sidebar').animate({\n\t        left: '20'\n\t      }, nodeLinkTransitionTime);\n\n\t      /* TODO: Temporary fix for sidbear div. */\n\t      $('#provvis-sidebar-content').css('height', vis$1.canvas.height);\n\t    }\n\t  });\n\n\t  /* Switch fit to screen on or off. */\n\t  $('#prov-ctrl-toggle-fit').click(function () {\n\t    if (!$('#prov-ctrl-toggle-fit')[0].checked) {\n\t      fitToWindow = false;\n\t    } else {\n\t      fitToWindow = true;\n\t    }\n\t  });\n\t}\n\n\t/* TODO: Recompute layout only after all nodes were collapsed/expanded. */\n\n\t/**\n\t * Handle events.\n\t * @param graph Provenance graph object.\n\t */\n\tfunction handleEvents(graph) {\n\t  handleToolbar(graph);\n\n\t  /* Handle click separation on nodes. */\n\t  var domNodesetClickTimeout = void 0;\n\t  domNodeset.on('mousedown', function (d) {\n\t    if (d3.event.defaultPrevented) {\n\t      return;\n\t    }\n\t    clearTimeout(domNodesetClickTimeout);\n\n\t    /* Click event is executed after 100ms unless the double click event\n\t     below clears the click event timeout.*/\n\t    domNodesetClickTimeout = setTimeout(function () {\n\t      if (!draggingActive) {\n\t        handleNodeSelection(d);\n\t        updateNodeInfoTab(d);\n\t      }\n\t    }, 200);\n\t  });\n\n\t  domNodeset.on('dblclick', function (d) {\n\t    if (d3.event.defaultPrevented) {\n\t      return;\n\t    }\n\t    clearTimeout(domNodesetClickTimeout);\n\n\t    /* Double click event is executed when this event is triggered before\n\t     the click timeout has finished. */\n\t    handleCollapseExpandNode(d, 'e');\n\t  });\n\n\t  /* Handle click separation on other dom elements. */\n\t  var bRectClickTimeout = void 0;\n\t  d3.selectAll('.brect, .link, .hLink, .vLine, .hLine', '.cell').on('click', function () {\n\t    if (d3.event.defaultPrevented) {\n\t      return;\n\t    }\n\t    clearTimeout(bRectClickTimeout);\n\n\t    /* Click event is executed after 100ms unless the double click event\n\t     below clears the click event timeout.*/\n\t    bRectClickTimeout = setTimeout(function () {\n\t      clearHighlighting(graph.links);\n\t      clearNodeSelection();\n\n\t      /* TODO: Temporarily enabled. */\n\t      if (doiAutoUpdate) {\n\t        recomputeDOI();\n\t      }\n\t    }, 200);\n\t  });\n\n\t  d3.selectAll('.brect, .link, .hLink, .vLine, .hLine, .cell').on('dblclick', function () {\n\t    if (d3.event.defaultPrevented) {\n\t      return;\n\t    }\n\t    clearTimeout(bRectClickTimeout);\n\n\t    /* Double click event is executed when this event is triggered\n\t     before the click timeout has finished. */\n\t    fitGraphToWindow(1000);\n\t  });\n\n\t  /* Handle tooltips. */\n\t  handleTooltips();\n\t  /* TODO: Currently disabled. */\n\t  // handleDebugTooltips();\n\n\t  /* Collapse on bounding box click.*/\n\t  saBBox.on('click', function (d) {\n\t    if (!draggingActive) {\n\t      handleCollapseExpandNode(d.children.values()[0], 'c');\n\n\t      /* TODO: Temporarily disabled. */\n\t      /* Deselect. */\n\t      // clearNodeSelection();\n\n\t      /* Update node doi. */\n\t      // updateNodeDoi();\n\t    }\n\t  });\n\n\t  /* Collapse on bounding box click.*/\n\t  var aBBoxClickTimeout = void 0;\n\t  aBBox.on('click', function (d) {\n\t    if (d3.event.defaultPrevented) {\n\t      return;\n\t    }\n\t    clearTimeout(aBBoxClickTimeout);\n\n\t    aBBoxClickTimeout = setTimeout(function () {\n\t      if (!draggingActive) {\n\t        if (d.hidden) {\n\t          if (d.children.values().some(function (san) {\n\t            return san.hidden;\n\t          })) {\n\t            d.children.values().forEach(function (san) {\n\t              handleCollapseExpandNode(san.children.values()[0], 'c');\n\t            });\n\t          } else {\n\t            handleCollapseExpandNode(d.children.values()[0], 'c');\n\t          }\n\t        } else {\n\t          handleCollapseExpandNode(d, 'c');\n\t        }\n\t      }\n\t    }, 200);\n\t  });\n\n\t  aBBox.on('dblclick', function (d) {\n\t    if (d3.event.defaultPrevented) {\n\t      return;\n\t    }\n\t    clearTimeout(aBBoxClickTimeout);\n\n\t    if (!draggingActive) {\n\t      d.children.values().forEach(function (san) {\n\t        handleCollapseExpandNode(san.children.values()[0], 'c');\n\t      });\n\t      handleCollapseExpandNode(d.children.values()[0], 'c');\n\t      handleCollapseExpandNode(d, 'c');\n\t    }\n\t  });\n\n\t  /* Collapse to layer node. */\n\t  lBBox.on('click', function (d) {\n\t    if (d3.event.defaultPrevented) {\n\t      return;\n\t    }\n\n\t    if (!draggingActive) {\n\t      d.children.values().forEach(function (an) {\n\t        an.children.values().forEach(function (san) {\n\t          handleCollapseExpandNode(san.children.values()[0], 'c');\n\t        });\n\t        handleCollapseExpandNode(an.children.values()[0], 'c');\n\t      });\n\t      handleCollapseExpandNode(d.children.values()[0], 'c');\n\n\t      /* TODO: Temporarily disabled. */\n\t      /* Deselect. */\n\t      // clearNodeSelection();\n\t      /* Update node doi. */\n\t      // updateNodeDoi();\n\t    }\n\t  });\n\n\t  /* Handle path highlighting. */\n\t  d3.selectAll('.glAnchor').on('click', function (d) {\n\t    handlePathHighlighting(d, 'p');\n\t  }).on('mousedown', d3.event.stopPropagation);\n\n\t  d3.selectAll('.grAnchor').on('click', function (d) {\n\t    handlePathHighlighting(d, 's');\n\t  }).on('mousedown', d3.event.stopPropagation);\n\t}\n\n\t/**\n\t * Compute doi weight based on the motif diff.\n\t * @param lNodes Layer nodes.\n\t * @param aNodes Analysis nodes.\n\t */\n\tfunction initDoiLayerDiffComponent(lNodes, aNodes) {\n\t  var doiDiffMin = 0;\n\t  var doiDiffMax = d3.max(aNodes, function (an) {\n\t    return d3.max([Math.abs(an.motifDiff.numIns), Math.abs(an.motifDiff.numSubanalyses), Math.abs(an.motifDiff.numOuts)], function (d) {\n\t      return d;\n\t    });\n\t  });\n\n\t  doiDiffScale = d3.scale.linear().domain([doiDiffMin, doiDiffMax]).range([0.0, 1.0]);\n\n\t  /* Init analysis nodes with a factor in relation to the highes diff in\n\t   the whole graph. */\n\t  aNodes.forEach(function (an) {\n\t    an.doi.initLayerDiffComponent(doiDiffScale(Math.abs(an.motifDiff.numIns) + Math.abs(an.motifDiff.numOuts) + Math.abs(an.motifDiff.numSubanalyses)));\n\t    an.children.values().forEach(function (san) {\n\t      san.doi.initLayerDiffComponent(an.doi.doiLayerDiff);\n\t      san.children.values().forEach(function (cn) {\n\t        cn.doi.initLayerDiffComponent(an.doi.doiLayerDiff);\n\t      });\n\t    });\n\t  });\n\n\t  /* Init layer nodes with max value from child nodes. */\n\t  lNodes.values().forEach(function (ln) {\n\t    var anMax = d3.max(ln.children.values(), function (an) {\n\t      return an.doi.doiLayerDiff;\n\t    });\n\t    ln.doi.initLayerDiffComponent(anMax);\n\t  });\n\t}\n\n\t/**\n\t * Main render module function.\n\t * @param provVis The provenance visualization root object.\n\t */\n\tfunction runRenderPrivate(provVis) {\n\t  /* Save vis object to module scope. */\n\t  vis$1 = provVis;\n\t  cell = provVis.cell;\n\n\t  lNodesBAK = vis$1.graph.lNodes;\n\t  aNodesBAK = vis$1.graph.aNodes;\n\t  saNodesBAK = vis$1.graph.saNodes;\n\t  nodesBAK = vis$1.graph.nodes;\n\t  lLinksBAK = vis$1.graph.lLinks;\n\t  aLinksBAK = vis$1.graph.aLinks;\n\n\t  // width = vis.graph.l.width;\n\t  // depth = vis.graph.l.depth;\n\n\t  timeColorScale = createAnalysistimeColorScale(vis$1.graph.aNodes, ['white', 'black']);\n\t  initDoiTimeComponent(vis$1.graph.aNodes, vis$1);\n\n\t  /* Init all nodes filtered. */\n\t  initDoiFilterComponent(vis$1.graph.lNodes);\n\t  filterAction = 'blend';\n\n\t  /* Init all nodes with the motif diff. */\n\t  initDoiLayerDiffComponent(vis$1.graph.lNodes, vis$1.graph.aNodes);\n\n\t  /* Draw analysis links. */\n\t  vis$1.canvas.append('g').classed('aHLinks', true);\n\t  vis$1.canvas.append('g').classed('aLinks', true);\n\t  updateAnalysisLinks(vis$1.graph);\n\n\t  /* Draw layer nodes and links. */\n\t  dagreLayerLayout(vis$1.graph, vis$1.cell, updateNodeAndLink);\n\t  vis$1.canvas.append('g').classed('lLinks', true);\n\t  vis$1.canvas.append('g').classed('layers', true);\n\t  updateLayerLinks(vis$1.graph.lLinks);\n\t  updateLayerNodes(vis$1.graph.lNodes);\n\n\t  /* Draw analysis nodes. */\n\t  vis$1.canvas.append('g').classed('analyses', true);\n\t  updateAnalysisNodes();\n\n\t  /* Draw subanalysis nodes. */\n\t  drawSubanalysisNodes();\n\n\t  /* Draw nodes. */\n\t  drawNodes();\n\n\t  /* Concat aNode, saNode and node. */\n\t  domNodeset = concatDomClassElements(['lNode', 'aNode', 'saNode', 'node']);\n\n\t  /* Add dragging behavior to nodes. */\n\t  applyDragBehavior(layer, dragStart, dragging, dragEnd);\n\t  applyDragBehavior(analysis, dragStart, dragging, dragEnd);\n\n\t  /* Initiate doi. */\n\t  vis$1.graph.aNodes.forEach(function (an) {\n\t    handleCollapseExpandNode(an, 'c', 'auto');\n\t  });\n\t  updateNodeFilter();\n\t  updateLinkFilter();\n\t  updateNodeDoi();\n\n\t  /* Draw timeline view. */\n\t  drawTimelineView(vis$1);\n\n\t  /* Draw doi view. */\n\t  drawDoiView();\n\n\t  /* Draw colorcoding view. */\n\t  drawColorcodingView();\n\n\t  /* Event listeners. */\n\t  handleEvents(vis$1.graph);\n\n\t  /* Set initial graph position. */\n\t  fitGraphToWindow(0);\n\t}\n\n\t/**\n\t * On attribute filter change, the provenance visualization will be updated.\n\t * @param vis The provenance visualization root object.\n\t * @param solrResponse Query response object holding information about\n\t * attribute filter changed.\n\t */\n\tfunction runRenderUpdatePrivate(_vis_, solrResponse) {\n\t  var selNodes = [];\n\n\t  filterMethod = 'facet';\n\n\t  if (solrResponse instanceof SolrResponse) {\n\t    _vis_.graph.lNodes = lNodesBAK;\n\t    _vis_.graph.aNodes = aNodesBAK;\n\t    _vis_.graph.saNodes = saNodesBAK;\n\t    _vis_.graph.nodes = nodesBAK;\n\t    _vis_.graph.aLinks = aLinksBAK;\n\t    _vis_.graph.lLinks = lLinksBAK;\n\n\t    /* Copy filtered nodes. */\n\t    solrResponse.getDocumentList().forEach(function (d) {\n\t      selNodes.push(_vis_.graph.nodeMap.get(d.uuid));\n\t    });\n\n\t    /* Update subanalysis and workflow filter attributes. */\n\t    _vis_.graph.nodes.forEach(function (n) {\n\t      if (selNodes.map(function (d) {\n\t        return d.parent;\n\t      }).indexOf(n.parent) === -1) {\n\t        n.parent.children.values().forEach(function (cn) {\n\t          cn.filtered = false;\n\t        });\n\t        n.parent.filtered = false;\n\t        n.parent.links.values().forEach(function (l) {\n\t          l.filtered = false;\n\t        });\n\t      } else {\n\t        (function () {\n\t          /* Filter pred path. */\n\t          var filterPredPath = function filterPredPath(curN) {\n\t            curN.filtered = true;\n\t            curN.predLinks.values().forEach(function (l) {\n\t              l.filtered = true;\n\t              if (l.source.parent === curN.parent) {\n\t                filterPredPath(l.source);\n\t              }\n\t            });\n\t          };\n\t          filterPredPath(n);\n\n\t          n.parent.filtered = true;\n\t          n.parent.links.values().forEach(function (l) {\n\t            l.filtered = true;\n\t          });\n\t        })();\n\t      }\n\n\t      /* Filtered attribute changed. */\n\t      n.parent.children.values().forEach(function (cn) {\n\t        cn.doi.filteredChanged();\n\t      });\n\t      n.parent.doi.filteredChanged();\n\t    });\n\n\t    /* Update analysis filter attributes. */\n\t    _vis_.graph.aNodes.forEach(function (an) {\n\t      if (an.children.values().some(function (san) {\n\t        return san.filtered;\n\t      })) {\n\t        an.filtered = true;\n\t      } else {\n\t        an.filtered = false;\n\t      }\n\t      an.doi.filteredChanged();\n\t    });\n\n\t    /* Update layer filter attributes. */\n\t    _vis_.graph.lNodes.values().forEach(function (ln) {\n\t      if (ln.children.values().some(function (an) {\n\t        return an.filtered;\n\t      })) {\n\t        ln.filtered = true;\n\t      } else {\n\t        ln.filtered = false;\n\t      }\n\t      ln.doi.filteredChanged();\n\t    });\n\n\t    /* Update analysis link filter attributes. */\n\t    _vis_.graph.aLinks.forEach(function (al) {\n\t      al.filtered = false;\n\t    });\n\t    _vis_.graph.aLinks.filter(function (al) {\n\t      return al.source.parent.parent.filtered && al.target.parent.parent.filtered;\n\t    }).forEach(function (al) {\n\t      al.filtered = true;\n\t    });\n\n\t    _vis_.graph.lLinks.values().forEach(function (ll) {\n\t      ll.filtered = false;\n\t    });\n\n\t    _vis_.graph.lLinks.values().filter(function (ll) {\n\t      return ll.source.filtered && ll.target.filtered;\n\t    }).forEach(function (ll) {\n\t      ll.filtered = true;\n\t    });\n\n\t    /* On filter action 'hide', splice and recompute graph. */\n\t    if (filterAction === 'hide') {\n\t      (function () {\n\t        /* Update filtered nodesets. */\n\t        var cpyLNodes = d3.map();\n\t        _vis_.graph.lNodes.entries().forEach(function (ln) {\n\t          if (ln.value.filtered) {\n\t            cpyLNodes.set(ln.key, ln.value);\n\t          }\n\t        });\n\t        _vis_.graph.lNodes = cpyLNodes;\n\t        _vis_.graph.aNodes = _vis_.graph.aNodes.filter(function (an) {\n\t          return an.filtered;\n\t        });\n\t        _vis_.graph.saNodes = _vis_.graph.saNodes.filter(function (san) {\n\t          return san.filtered;\n\t        });\n\t        _vis_.graph.nodes = _vis_.graph.nodes.filter(function (n) {\n\t          return n.filtered;\n\t        });\n\n\t        /* Update filtered linksets. */\n\t        _vis_.graph.aLinks = _vis_.graph.aLinks.filter(function (al) {\n\t          return al.filtered;\n\t        });\n\n\t        /* Update layer links. */\n\t        var cpyLLinks = d3.map();\n\t        _vis_.graph.lLinks.entries().forEach(function (ll) {\n\t          if (ll.value.filtered) {\n\t            cpyLLinks.set(ll.key, ll.value);\n\t          }\n\t        });\n\t        _vis_.graph.lLinks = cpyLLinks;\n\t      })();\n\t    }\n\n\t    dagreDynamicLayerLayout(_vis_.graph);\n\t    if (fitToWindow) {\n\t      fitGraphToWindow(nodeLinkTransitionTime);\n\t    }\n\n\t    updateNodeFilter();\n\t    updateLinkFilter();\n\t    updateAnalysisLinks(_vis_.graph);\n\t    updateLayerLinks(_vis_.graph.lLinks);\n\n\t    _vis_.graph.aNodes.forEach(function (an) {\n\t      updateLink(an);\n\t    });\n\t    _vis_.graph.lNodes.values().forEach(function (ln) {\n\t      updateLink(ln);\n\t    });\n\n\t    /* TODO: Currently enabled. */\n\t    if (doiAutoUpdate) {\n\t      recomputeDOI();\n\t    }\n\t  }\n\t  lastSolrResponse = solrResponse;\n\t}\n\n\t/**\n\t * Publish module function.\n\t */\n\tfunction run$4(_vis_) {\n\t  runRenderPrivate(_vis_);\n\t}\n\n\tfunction update$1(_vis_, solrResponse) {\n\t  runRenderUpdatePrivate(_vis_, solrResponse);\n\t}\n\n\t/**\n\t * The refinery provenance graph visualization.\n\t *\n\t * @author sluger Stefan Luger https://github.com/sluger\n\t * @exports runProvVis The published function to run the visualization.\n\t */\n\n\tvar vis = Object.create(null);\n\n\t/* TODO: Rewrite in angular template. */\n\t/**\n\t * Timeline view only showing analysis within a time-gradient background.\n\t * @param divId Div id.\n\t */\n\tfunction createTimelineView(divId) {\n\t  /* New timeline view content. */\n\t  var timelineContainer = d3.select('#' + divId);\n\n\t  $('<p/>', {\n\t    id: 'tlTitle',\n\t    html: 'Analysis Timeline'\n\t  }).appendTo(timelineContainer);\n\n\t  $('<p/>', {\n\t    id: 'tlThresholdStart',\n\t    class: 'tlThreshold'\n\t  }).appendTo(timelineContainer);\n\n\t  $('<p/>', {\n\t    id: 'tlCanvas'\n\t  }).appendTo(timelineContainer);\n\n\t  d3.select('#tlCanvas').append('svg').attr('height', 80).attr('width', 275).style({\n\t    'margin-top': '0px',\n\t    'margin-bottom': '0px',\n\t    padding: '0px'\n\t  }).attr('pointer-events', 'all');\n\n\t  $('<p/>', {\n\t    id: 'tlThresholdEnd',\n\t    class: 'tlThreshold'\n\t  }).appendTo(timelineContainer);\n\t}\n\n\t/* TODO: Rewrite in angular template. */\n\t/**\n\t * DOI view.\n\t * @param divId Div id.\n\t */\n\tfunction createDOIView(divId) {\n\t  /* New DOI view content. */\n\t  var doiContainer = d3.select('#' + divId);\n\n\t  $('<p/>', {\n\t    id: 'doiTitle',\n\t    html: 'Degree-Of-Interest'\n\t  }).appendTo(doiContainer);\n\n\t  $('<div/>', {\n\t    id: 'doiVis',\n\t    style: 'width: 100%; height: 300px;'\n\t  }).appendTo(doiContainer);\n\n\t  $('<div/>', {\n\t    id: 'doiCanvas',\n\t    style: 'width: 70px; float: left;'\n\t  }).appendTo('#doiVis');\n\n\t  d3.select('#doiCanvas').append('svg').attr('height', 300).attr('width', 100).style({\n\t    'margin-top': '0px',\n\t    'margin-left': '0px',\n\t    padding: '0px'\n\t  }).attr('pointer-events', 'all').append('g').append('g').attr('transform', 'translate(0,0)').append('g');\n\n\t  $('<button/>', {\n\t    id: 'prov-doi-view-apply',\n\t    class: 'btn btn-primary',\n\t    type: 'button',\n\t    html: 'Apply',\n\t    style: 'position: absolute; left: 0px; top: 340px;'\n\t  }).appendTo(doiContainer);\n\n\t  $('<label/>', {\n\t    id: 'prov-doi-trigger',\n\t    class: 'prov-doi-view-show-checkbox',\n\t    style: 'display: flex; position: absolute; left: 75px; top: 340px; ' + 'margin-top: 5px;',\n\t    html: '<input id=\"prov-doi-view-trigger-input\" type=\"checkbox\" ' + 'style=\"margin-right: 3px;\">Auto Update'\n\t  }).appendTo(doiContainer);\n\n\t  $('<label/>', {\n\t    id: 'prov-doi-view-show',\n\t    class: 'prov-doi-view-show-checkbox',\n\t    style: 'display: flex; position: absolute; left: 180px; top: 340px; ' + 'margin-top: 5px;',\n\t    html: '<input id=\"prov-doi-view-show-input\" type=\"checkbox\" ' + 'style=\"margin-right: 3px;\">Show DOI'\n\t  }).appendTo(doiContainer);\n\t}\n\n\t/**\n\t * Layer reload view.\n\t * @param divId Div id.\n\t */\n\tfunction createChangeLayersView(divId) {\n\t  /* New DOI view content. */\n\t  var layerContainer = d3.select('#' + divId);\n\n\t  $('<p/>', {\n\t    id: 'changeLayerTitle',\n\t    html: 'Change Layering'\n\t  }).appendTo(layerContainer);\n\n\t  $('<div/>', {\n\t    id: 'prov-layering-method',\n\t    class: 'btn-group',\n\t    'data-toggle': 'buttons-radio'\n\t  }).appendTo(layerContainer);\n\n\t  $('<button/>', {\n\t    id: 'prov-layering-strict',\n\t    class: 'btn btn-primary',\n\t    type: 'button',\n\t    value: 'strict',\n\t    html: 'Hard'\n\t  }).appendTo('#prov-layering-method');\n\n\t  $('<button/>', {\n\t    id: 'prov-layering-weak',\n\t    class: 'active btn btn-primary',\n\t    type: 'button',\n\t    value: 'weak',\n\t    html: 'Soft'\n\t  }).appendTo('#prov-layering-method');\n\t}\n\n\t/**\n\t * Display a spinning loader icon div while the provenance\n\t * visualization is loading.\n\t */\n\tfunction showProvvisLoaderIcon() {\n\t  $('#provvis-loader').css('display', 'inline-block');\n\t}\n\n\t/**+\n\t * Hide the loader icon again.\n\t */\n\tfunction hideProvvisLoaderIcon() {\n\t  $('#provvis-loader').css('display', 'none');\n\t}\n\n\t/**\n\t * Refinery injection for the provenance visualization.\n\t * @param studyUuid The serialized unique identifier referencing a study.\n\t * @param studyAnalyses Analyses objects from the refinery scope.\n\t * @param solrResponse Facet filter information on node attributes.\n\t */\n\tfunction runProvVisPrivate(studyUuid, studyAnalyses, solrResponse) {\n\t  showProvvisLoaderIcon();\n\n\t  /* Only allow one instance of ProvVis. */\n\t  if (vis instanceof ProvVis === false) {\n\t    (function () {\n\t      var url = '/api/v1/node?study__uuid=' + studyUuid + '&format=json&limit=0';\n\t      var analysesData = studyAnalyses.filter(function (a) {\n\t        return a.status === 'SUCCESS';\n\t      });\n\n\t      /* Parse json. */\n\t      d3.json(url, function (error, data) {\n\t        /* Declare d3 specific properties. */\n\t        var zoom = Object.create(null);\n\t        var canvas = Object.create(null);\n\t        var rect = Object.create(null);\n\n\t        /* Initialize margin conventions */\n\t        var margin = {\n\t          top: 20,\n\t          right: 10,\n\t          bottom: 20,\n\t          left: 10\n\t        };\n\n\t        /* Set drawing constants. */\n\t        var r = 7;\n\t        var color = d3.scale.category20();\n\n\t        /* Declare graph. */\n\t        var graph = Object.create(null);\n\n\t        /* Timeline view div. */\n\t        createTimelineView('provenance-timeline-view');\n\n\t        /* DOI view div. */\n\t        createDOIView('provenance-doi-view');\n\n\t        /* Layer view div. */\n\t        createChangeLayersView('provenance-layer-change-view');\n\n\t        /* Init node cell dimensions. */\n\t        var cell = {\n\t          width: r * 5,\n\t          height: r * 3\n\t        };\n\n\t        /* Initialize canvas dimensions. */\n\t        var width = $('div#provenance-visualization').width() - 10;\n\t        var height = $('div#solr-table-view').height() - 25;\n\n\t        /* TODO: Temp fix for sidebar height. */\n\t        $('#provenance-sidebar').css('height', height);\n\t        /* TODO: Temp fix for sidebar max height. */\n\t        $('#provvis-sidebar-content').css('max-height', height - 13);\n\n\t        var scaleFactor = 0.75;\n\n\t        var layerMethod = 'weak';\n\t        /* weak | strict */\n\n\t        /* Create vis and add graph. */\n\t        vis = new ProvVis('provenance-visualization', zoom, data, url, canvas, rect, margin, width, height, r, color, graph, cell, layerMethod);\n\n\t        /* Geometric zoom. */\n\t        var redraw = function redraw() {\n\t          /* Translation and scaling. */\n\t          vis.canvas.attr('transform', 'translate(' + d3.event.translate + ')' + ' scale(' + d3.event.scale + ')');\n\n\t          /* Semantic zoom. */\n\t          if (d3.event.scale < 1) {\n\t            d3.selectAll('.BBox').classed('hiddenNode', true);\n\t            d3.selectAll('.lDiff, .aDiff').classed('hiddenNode', true);\n\t          } else {\n\t            d3.selectAll('.BBox').classed('hiddenNode', false);\n\t            d3.selectAll('.lDiff, .aDiff').classed('hiddenNode', false);\n\t          }\n\n\t          if (d3.event.scale < 1.7) {\n\t            vis.canvas.selectAll('.anLabel, .sanLabel, .lnLabel, ' + '.nodeAttrLabel, .stored-node-type-icon, .an-node-type-icon, ' + '.san-node-type-icon, .l-node-type-icon, .lBBoxLabel, ' + '.aBBoxLabel, .nodeDoiLabel').classed('hiddenLabel', true);\n\t            d3.selectAll('.glAnchor, .grAnchor').classed('hiddenNode', true);\n\t          } else {\n\t            vis.canvas.selectAll('.anLabel, .sanLabel, .lnLabel, ' + '.nodeAttrLabel, .stored-node-type-icon, .an-node-type-icon, ' + '.san-node-type-icon, .l-node-type-icon, .lBBoxLabel, ' + '.aBBoxLabel, .nodeDoiLabel').classed('hiddenLabel', false);\n\t            d3.selectAll('.glAnchor, .grAnchor').classed('hiddenNode', false);\n\t          }\n\n\t          /* Fix for rectangle getting translated too - doesn't work after\n\t           * window resize.\n\t           */\n\t          vis.rect.attr('transform', 'translate(' + -(d3.event.translate[0] + vis.margin.left) / d3.event.scale + ',' + -(d3.event.translate[1] + vis.margin.top) / d3.event.scale + ')' + ' scale(' + +1 / d3.event.scale + ')');\n\n\t          /* Fix to exclude zoom scale from text labels. */\n\t          vis.canvas.selectAll('.lBBoxLabel').attr('transform', 'translate(' + 1 * scaleFactor * vis.radius + ',' + 0.5 * scaleFactor * vis.radius + ')' + 'scale(' + +1 / d3.event.scale + ')');\n\n\t          vis.canvas.selectAll('.aBBoxLabel').attr('transform', 'translate(' + 1 * scaleFactor * vis.radius + ',' + 0 * scaleFactor * vis.radius + ')' + 'scale(' + +1 / d3.event.scale + ')');\n\n\t          vis.canvas.selectAll('.nodeDoiLabel').attr('transform', 'translate(' + 0 + ',' + 1.6 * scaleFactor * vis.radius + ')' + 'scale(' + +1 / d3.event.scale + ')');\n\n\t          vis.canvas.selectAll('.nodeAttrLabel').attr('transform', 'translate(' + -1.5 * scaleFactor * vis.radius + ',' + -1.5 * scaleFactor * vis.radius + ')' + 'scale(' + +1 / d3.event.scale + ')');\n\n\t          /* Trim nodeAttrLabel */\n\t          /* Get current node label pixel width. */\n\t          var maxLabelPixelWidth = (cell.width - 2 * scaleFactor * vis.radius) * d3.event.scale;\n\n\t          /* Get label text. */\n\t          d3.selectAll('.node').select('.nodeAttrLabel').each(function (d) {\n\t            var attrText = d.label === '' ? d.name : d.label;\n\t            if (d.nodeType === 'stored') {\n\t              var selAttrName = '';\n\t              $('#prov-ctrl-visible-attribute-list > li').each(function () {\n\t                if ($(this).find('input[type=\\'radio\\']').prop('checked')) {\n\t                  selAttrName = $(this).find('label').text();\n\t                }\n\t              });\n\t              attrText = d.attributes.get(selAttrName);\n\t            }\n\n\t            /* Set label text. */\n\t            if (typeof attrText !== 'undefined') {\n\t              d3.select(this).text(attrText);\n\t              var trimRatio = parseInt(attrText.length * (maxLabelPixelWidth / this.getComputedTextLength()), 10);\n\t              if (trimRatio < attrText.length) {\n\t                d3.select(this).text(attrText.substr(0, trimRatio - 3) + '...');\n\t              }\n\t            }\n\t          });\n\t        };\n\n\t        /* Main canvas drawing area. */\n\t        vis.canvas = d3.select('#provenance-canvas').append('svg').attr('width', width).attr('height', height).attr('pointer-events', 'all').classed('canvas', true).append('g').call(vis.zoom = d3.behavior.zoom().on('zoom', redraw)).on('dblclick.zoom', null).append('g');\n\n\t        /* Helper rectangle to support pan and zoom. */\n\t        vis.rect = vis.canvas.append('svg:rect').attr('width', width).attr('height', height).classed('brect', true);\n\n\t        /* Production mode exception handling. */\n\t        // try {\n\t        //   /* Extract graph data. */\n\t        //   vis.graph = init(data, analysesData, solrResponse);\n\t        //   try {\n\t        //     /* Compute layout. */\n\t        //     vis.graph.bclgNodes = layout(vis.graph, vis.cell);\n\t        //     try {\n\t        //       /* Discover and and inject motifs. */\n\t        //       motifs(vis.graph, layerMethod);\n\t        //       try {\n\t        //         /* Render graph. */\n\t        //         render.run(vis);\n\t        //       }\n\t        //       catch (err) {\n\t        //         $('#provenance-canvas > svg').remove();\n\t        //         document.getElementById('provenance-canvas').innerHTML +=\n\t        //             'Render Module Error: ' + err.message + '<br>';\n\t        //       }\n\t        //     }\n\t        //     catch (err) {\n\t        //       $('#provenance-canvas > svg').remove();\n\t        //       document.getElementById('provenance-canvas').innerHTML +=\n\t        //           'Motif Module Error: ' + err.message + '<br>';\n\t        //     }\n\t        //   }\n\t        //   catch (err) {\n\t        //     $('#provenance-canvas > svg').remove();\n\t        //     document.getElementById('provenance-canvas').innerHTML +=\n\t        //         'Layout Module Error: ' + err.message + '<br>';\n\t        //   }\n\t        // }\n\t        // catch (err) {\n\t        //   $('#provenance-canvas > svg').remove();\n\t        //   document.getElementById('provenance-canvas').innerHTML =\n\t        //       'Init Module Error: ' + err.message + '<br>';\n\t        // } finally {\n\t        //   hideProvvisLoaderIcon();\n\t        // }\n\n\t        /* Uncomment in development mode. */\n\t        vis.graph = run$1(data, analysesData, solrResponse);\n\t        vis.graph.bclgNodes = run$2(vis.graph, vis.cell);\n\t        run$3(vis.graph, layerMethod);\n\t        run$4(vis);\n\t        hideProvvisLoaderIcon();\n\n\t        try {\n\t          /* TODO: Refine to only redraw affected canvas components. */\n\t          /* Switch filter action. */\n\t          $('#prov-layering-method > button').click(function () {\n\t            layerMethod = $(this).prop('value');\n\n\t            showProvvisLoaderIcon();\n\n\t            $('.aHLinks').remove();\n\t            $('.aLinks').remove();\n\t            $('.lLinks').remove();\n\t            $('.lLink').remove();\n\t            $('.layers').remove();\n\t            $('.analyses').remove();\n\n\t            $('#provenance-timeline-view').children().remove();\n\t            $('#provenance-doi-view').children().remove();\n\n\t            createTimelineView('provenance-timeline-view');\n\n\t            DoiFactors.set('filtered', 0.2, true);\n\t            DoiFactors.set('selected', 0.2, true);\n\t            DoiFactors.set('highlighted', 0.2, true);\n\t            DoiFactors.set('time', 0.2, true);\n\t            DoiFactors.set('diff', 0.2, true);\n\n\t            createDOIView('provenance-doi-view');\n\n\t            /* Discover and and inject motifs. */\n\t            run$3(vis.graph, layerMethod);\n\n\t            /* Render graph. */\n\t            run$4(vis);\n\n\t            hideProvvisLoaderIcon();\n\t          });\n\t        } catch (err) {\n\t          document.getElementById('provenance-canvas').innerHTML += 'Layering Error: ' + err.message + '<br>';\n\t        }\n\t      });\n\t    })();\n\t  }\n\t}\n\n\t/**\n\t * On attribute filter change, the provenance visualization will be updated.\n\t * @param solrResponse Query response object holding information\n\t * about attribute filter changed.\n\t */\n\tfunction runProvVisUpdatePrivate(solrResponse) {\n\t  update$1(vis, solrResponse);\n\t}\n\n\t/**\n\t * Visualization instance getter.\n\t * @returns {null} The provvis instance.\n\t */\n\tfunction getProvVisPrivate() {\n\t  return vis;\n\t}\n\n\t/**\n\t * Publishable module functions.\n\t */\n\tfunction run(studyUuid, studyAnalyses, solrResponse) {\n\t  runProvVisPrivate(studyUuid, studyAnalyses, solrResponse);\n\t}\n\n\tfunction update(solrResponse) {\n\t  runProvVisUpdatePrivate(solrResponse);\n\t}\n\n\tfunction get() {\n\t  return getProvVisPrivate();\n\t}\n\n\tvar index = {\n\t  version: version,\n\t  run: run,\n\t  update: update,\n\t  get: get\n\t};\n\n\treturn index;\n\n}($,d3,SolrResponse,dagre));"],"sourceRoot":"/source/"}